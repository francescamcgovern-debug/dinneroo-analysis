<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dinneroo Master Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="./zone_data.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Instrument+Sans:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0a0a0f;
            --bg-secondary: #12121a;
            --bg-card: #1a1a24;
            --bg-card-hover: #22222e;
            --border: #2a2a3a;
            --border-light: #3a3a4a;
            
            --text-primary: #f0f0f5;
            --text-secondary: #a0a0b0;
            --text-muted: #606070;
            
            --accent-teal: #00d4aa;
            --accent-teal-dim: rgba(0, 212, 170, 0.15);
            --accent-purple: #8b5cf6;
            --accent-purple-dim: rgba(139, 92, 246, 0.15);
            --accent-amber: #f59e0b;
            --accent-amber-dim: rgba(245, 158, 11, 0.15);
            --accent-blue: #3b82f6;
            --accent-rose: #f43f5e;
            
            --success: #22c55e;
            --success-dim: rgba(34, 197, 94, 0.15);
            --warning: #f59e0b;
            --warning-dim: rgba(245, 158, 11, 0.15);
            --danger: #ef4444;
            --danger-dim: rgba(239, 68, 68, 0.15);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Instrument Sans', -apple-system, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.5;
        }
        
        /* Sticky Header */
        .sticky-header {
            position: sticky;
            top: 0;
            z-index: 100;
            background: rgba(10, 10, 15, 0.9);
            backdrop-filter: blur(12px);
            border-bottom: 1px solid var(--border);
            padding: 1rem 2rem;
        }
        
        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        /* Header */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--accent-teal), var(--accent-purple));
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.25rem;
        }
        
        h1 {
            font-size: 1.5rem;
            font-weight: 700;
            letter-spacing: -0.02em;
        }
        
        .subtitle {
            font-size: 0.85rem;
            color: var(--text-muted);
        }
        
        .header-meta {
            text-align: right;
            font-size: 0.8rem;
            color: var(--text-muted);
        }
        
        .header-meta strong {
            color: var(--text-secondary);
        }
        
        /* Freshness Indicator */
        .freshness-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.8rem;
            color: var(--text-secondary);
        }
        
        .freshness-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--success);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        /* Navigation */
        nav {
            display: flex;
            gap: 0.25rem;
            background: var(--bg-secondary);
            padding: 0.25rem;
            border-radius: 0.75rem;
            margin-bottom: 2rem;
        }
        
        .nav-btn {
            padding: 0.75rem 1.5rem;
            background: transparent;
            border: none;
            color: var(--text-secondary);
            font-family: inherit;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            border-radius: 0.5rem;
            transition: all 0.2s;
        }
        
        .nav-btn:hover {
            color: var(--text-primary);
            background: var(--bg-card);
        }
        
        .nav-btn.active {
            background: var(--bg-card);
            color: var(--accent-teal);
        }
        
        /* Sections */
        .section {
            display: none;
        }
        
        .section.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Section Header */
        .section-header {
            margin-bottom: 2rem;
        }
        
        .section-title {
            font-size: 1.75rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            letter-spacing: -0.02em;
        }
        
        .section-description {
            color: var(--text-secondary);
            font-size: 1rem;
            max-width: 700px;
        }
        
        /* Threshold Summary Cards */
        .threshold-summary {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
            margin-bottom: 3rem;
        }
        
        .threshold-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 1rem;
            padding: 1.5rem;
            position: relative;
            overflow: hidden;
            transition: all 0.2s ease;
        }
        
        .threshold-card:hover {
            transform: translateY(-2px);
            border-color: var(--border-light);
        }
        
        .threshold-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
        }
        
        .threshold-card.partners::before {
            background: linear-gradient(90deg, var(--accent-teal), var(--accent-teal));
        }
        
        .threshold-card.cuisines::before {
            background: linear-gradient(90deg, var(--accent-purple), var(--accent-purple));
        }
        
        .threshold-card.dishes::before {
            background: linear-gradient(90deg, var(--accent-amber), var(--accent-amber));
        }
        
        .threshold-label {
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-muted);
            margin-bottom: 1rem;
        }
        
        .threshold-values {
            display: flex;
            align-items: baseline;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .threshold-min, .threshold-target {
            text-align: center;
        }
        
        .threshold-min .value, .threshold-target .value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 2rem;
            font-weight: 600;
            line-height: 1;
        }
        
        .threshold-min .value {
            color: var(--text-secondary);
        }
        
        .threshold-card.partners .threshold-target .value { color: var(--accent-teal); }
        .threshold-card.cuisines .threshold-target .value { color: var(--accent-purple); }
        .threshold-card.dishes .threshold-target .value { color: var(--accent-amber); }
        
        .threshold-min .label, .threshold-target .label {
            font-size: 0.7rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-top: 0.25rem;
        }
        
        .threshold-arrow {
            font-size: 1.5rem;
            color: var(--text-muted);
        }
        
        .threshold-evidence {
            font-size: 0.8rem;
            color: var(--text-secondary);
            padding-top: 1rem;
            border-top: 1px solid var(--border);
        }
        
        /* Step Cards */
        .step-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 1rem;
            margin-bottom: 2rem;
            overflow: hidden;
        }
        
        .step-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1.25rem 1.5rem;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border);
        }
        
        .step-number {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'JetBrains Mono', monospace;
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        .step-card.partners .step-number { background: var(--accent-teal-dim); color: var(--accent-teal); }
        .step-card.cuisines .step-number { background: var(--accent-purple-dim); color: var(--accent-purple); }
        .step-card.dishes .step-number { background: var(--accent-amber-dim); color: var(--accent-amber); }
        
        .step-title {
            font-size: 1.1rem;
            font-weight: 600;
        }
        
        .step-subtitle {
            font-size: 0.8rem;
            color: var(--text-muted);
        }
        
        .step-content {
            padding: 1.5rem;
        }
        
        /* Finding Callout */
        .finding-callout {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem 1.25rem;
            border-radius: 0.75rem;
            margin-bottom: 1.5rem;
        }
        
        .step-card.partners .finding-callout { background: var(--accent-teal-dim); border: 1px solid rgba(0, 212, 170, 0.3); }
        .step-card.cuisines .finding-callout { background: var(--accent-purple-dim); border: 1px solid rgba(139, 92, 246, 0.3); }
        .step-card.dishes .finding-callout { background: var(--accent-amber-dim); border: 1px solid rgba(245, 158, 11, 0.3); }
        
        .finding-icon {
            font-size: 1.25rem;
        }
        
        .finding-text {
            font-size: 0.95rem;
            font-weight: 500;
        }
        
        .finding-text strong {
            font-weight: 700;
        }
        
        .step-card.partners .finding-text strong { color: var(--accent-teal); }
        .step-card.cuisines .finding-text strong { color: var(--accent-purple); }
        .step-card.dishes .finding-text strong { color: var(--accent-amber); }
        
        /* Chart Container */
        .chart-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .chart-box {
            background: var(--bg-secondary);
            border-radius: 0.75rem;
            padding: 1.25rem;
        }
        
        .chart-title {
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .source-badge {
            font-size: 0.65rem;
            padding: 0.2rem 0.5rem;
            border-radius: 0.25rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.03em;
        }
        
        .source-badge.snowflake {
            background: var(--accent-blue);
            color: white;
        }
        
        .source-badge.survey {
            background: var(--accent-rose);
            color: white;
        }
        
        /* Evidence Level Badges */
        .evidence-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            font-size: 0.7rem;
            padding: 0.2rem 0.5rem;
            border-radius: 0.25rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.03em;
            margin-left: 0.5rem;
        }
        
        .evidence-badge.validated {
            background: var(--success-dim);
            color: var(--success);
            border: 1px solid rgba(34, 197, 94, 0.3);
        }
        
        .evidence-badge.corroborated {
            background: var(--warning-dim);
            color: var(--warning);
            border: 1px solid rgba(245, 158, 11, 0.3);
        }
        
        .evidence-badge.single {
            background: rgba(59, 130, 246, 0.15);
            color: var(--accent-blue);
            border: 1px solid rgba(59, 130, 246, 0.3);
        }
        
        .chart-container {
            height: 220px;
        }
        
        /* Data Table */
        .data-table-wrapper {
            margin-top: 1rem;
        }
        
        .table-toggle {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1rem;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 0.5rem;
            color: var(--text-secondary);
            font-family: inherit;
            font-size: 0.85rem;
            cursor: pointer;
            width: 100%;
            text-align: left;
            transition: all 0.2s;
        }
        
        .table-toggle:hover {
            background: var(--bg-card-hover);
            color: var(--text-primary);
        }
        
        .table-toggle .arrow {
            margin-left: auto;
            transition: transform 0.2s;
        }
        
        .table-toggle.open .arrow {
            transform: rotate(180deg);
        }
        
        .data-table-container {
            display: none;
            margin-top: 0.5rem;
            overflow-x: auto;
        }
        
        .data-table-container.open {
            display: block;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85rem;
        }
        
        .data-table th {
            text-align: left;
            padding: 0.75rem 1rem;
            background: var(--bg-secondary);
            border-bottom: 2px solid var(--border);
            font-weight: 600;
            color: var(--text-muted);
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            white-space: nowrap;
        }
        
        .data-table td {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid var(--border);
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8rem;
        }
        
        .data-table tr:hover td {
            background: var(--bg-card-hover);
        }
        
        .data-table .bucket {
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .data-table .sample-size {
            color: var(--text-muted);
            font-size: 0.7rem;
        }
        
        /* Source Attribution */
        .source-attribution {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 1rem;
            padding: 1.5rem;
            margin-top: 2rem;
        }
        
        .source-attribution h3 {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--text-secondary);
        }
        
        .source-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
        }
        
        .source-group h4 {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.85rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
        }
        
        .source-group ul {
            list-style: none;
            font-size: 0.8rem;
            color: var(--text-secondary);
        }
        
        .source-group li {
            padding: 0.25rem 0;
        }
        
        /* Methodology Note */
        .methodology-note {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 0.75rem;
            padding: 1rem 1.25rem;
            margin-top: 1.5rem;
            font-size: 0.85rem;
            color: var(--text-secondary);
        }
        
        .methodology-note strong {
            color: var(--text-primary);
        }
        
        /* Responsive */
        @media (max-width: 900px) {
            .threshold-summary {
                grid-template-columns: 1fr;
            }
            
            .chart-row {
                grid-template-columns: 1fr;
            }
            
            .source-grid {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 600px) {
            .container {
                padding: 1rem;
            }
            
            nav {
                flex-wrap: wrap;
            }
            
            .nav-btn {
                flex: 1;
                min-width: 100px;
                text-align: center;
            }
        }
        
        /* Zone Detail Panel */
        .zone-detail-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            z-index: 200;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }
        
        .zone-detail-overlay.visible {
            opacity: 1;
            visibility: visible;
        }
        
        .zone-detail-panel {
            position: fixed;
            top: 0;
            right: -520px;
            width: 520px;
            height: 100vh;
            background: var(--bg-secondary);
            border-left: 1px solid var(--border);
            z-index: 250;
            transition: right 0.3s ease;
            overflow-y: auto;
        }
        
        .zone-detail-panel.open {
            right: 0;
        }
        
        .zone-detail-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            position: sticky;
            top: 0;
            background: var(--bg-secondary);
            z-index: 10;
        }
        
        .zone-detail-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 1.75rem;
            cursor: pointer;
            padding: 0.25rem;
            line-height: 1;
        }
        
        .zone-detail-close:hover {
            color: var(--text-primary);
        }
        
        .zone-detail-content {
            padding: 1.5rem;
        }
        
        .zone-detail-section {
            margin-bottom: 1.5rem;
        }
        
        .zone-detail-section h4 {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-muted);
            margin-bottom: 0.75rem;
        }
        
        /* Route to MVP Progress */
        .mvp-progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .mvp-progress-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .mvp-progress-pct {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--accent-teal);
        }
        
        .mvp-progress-bar {
            width: 100%;
            height: 12px;
            background: var(--bg-primary);
            border-radius: 6px;
            overflow: hidden;
            margin-bottom: 1.5rem;
        }
        
        .mvp-progress-fill {
            height: 100%;
            border-radius: 6px;
            background: linear-gradient(135deg, var(--accent-teal), var(--accent-purple));
            transition: width 0.5s ease;
        }
        
        /* Zone Metrics Grid */
        .zone-metrics-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.75rem;
        }
        
        .zone-metric {
            background: var(--bg-card);
            padding: 0.75rem;
            border-radius: 8px;
            text-align: center;
        }
        
        .zone-metric-value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--accent-teal);
        }
        
        .zone-metric-label {
            font-size: 0.7rem;
            color: var(--text-muted);
        }
        
        /* Coverage Section */
        .coverage-section {
            margin-bottom: 1.5rem;
        }
        
        .coverage-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
        }
        
        .coverage-title {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-muted);
            font-weight: 600;
        }
        
        .coverage-count {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            color: var(--accent-teal);
        }
        
        .coverage-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.5rem;
        }
        
        .coverage-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 0.75rem;
            background: var(--bg-card);
            border-radius: 6px;
            font-size: 0.8rem;
        }
        
        .coverage-item.has {
            border-left: 3px solid var(--accent-teal);
        }
        
        .coverage-item.missing {
            border-left: 3px solid var(--accent-rose);
            background: rgba(244, 63, 94, 0.1);
        }
        
        .coverage-item-icon {
            font-size: 0.75rem;
        }
        
        .coverage-item-name {
            flex: 1;
        }
        
        .coverage-item-count {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.7rem;
            color: var(--text-muted);
        }
        
        /* Priority Actions */
        .priority-actions {
            margin-top: 1.5rem;
        }
        
        .priority-action {
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
            padding: 0.75rem;
            background: var(--bg-card);
            border-radius: 8px;
            margin-bottom: 0.5rem;
            border-left: 3px solid var(--accent-amber);
        }
        
        .priority-action-number {
            width: 24px;
            height: 24px;
            background: var(--accent-amber);
            color: #000;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: 700;
            flex-shrink: 0;
        }
        
        .priority-action-content {
            flex: 1;
        }
        
        .priority-action-gap {
            font-weight: 600;
            font-size: 0.85rem;
            margin-bottom: 0.25rem;
        }
        
        .priority-action-text {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }
        
        .priority-action-impact {
            font-size: 0.7rem;
            color: var(--accent-teal);
            margin-top: 0.25rem;
        }
        
        /* Clickable table rows */
        .data-table tr.clickable {
            cursor: pointer;
        }
        
        .data-table tr.clickable:hover {
            background: var(--bg-card-hover);
        }
        
        /* Progress bar in table */
        .progress-mini {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .progress-mini-bar {
            width: 60px;
            height: 6px;
            background: var(--bg-primary);
            border-radius: 3px;
            overflow: hidden;
        }
        
        .progress-mini-fill {
            height: 100%;
            border-radius: 3px;
            background: var(--accent-teal);
        }
        
        .progress-mini-text {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.75rem;
            color: var(--text-secondary);
        }
        
        /* Sortable table headers */
        .data-table th.sortable {
            cursor: pointer;
            user-select: none;
            transition: background 0.2s;
        }
        
        .data-table th.sortable:hover {
            background: var(--bg-card-hover);
        }
        
        .data-table th.sortable .sort-indicator {
            margin-left: 0.25rem;
            opacity: 0.4;
            font-size: 0.7rem;
        }
        
        .data-table th.sortable.active .sort-indicator {
            opacity: 1;
            color: var(--accent-teal);
        }
        
        .data-table th.sortable.asc .sort-indicator::after {
            content: '‚ñ≤';
        }
        
        .data-table th.sortable.desc .sort-indicator::after {
            content: '‚ñº';
        }
    </style>
</head>
<body>
    <div class="sticky-header">
        <div class="header-content">
            <header>
                <div class="logo">
                    <div class="logo-icon">D</div>
                    <div>
                        <h1>Dinneroo Master Dashboard</h1>
                        <div class="subtitle">Family meal proposition analytics</div>
                    </div>
                </div>
            </header>
            <div class="header-meta">
                <div class="freshness-indicator">
                    <span class="freshness-dot"></span>
                    <span>Data fresh as of <strong>Jan 2026</strong></span>
                </div>
                <div>Trial period: 201 zones ¬∑ 82,350 orders</div>
            </div>
        </div>
    </div>
    
    <div class="container">
        <nav>
            <button class="nav-btn active" onclick="showSection('thresholds')">MVP Thresholds</button>
            <button class="nav-btn" onclick="showSection('zones')">Zones</button>
            <button class="nav-btn" onclick="showSection('dishes')">Dishes</button>
            <button class="nav-btn" onclick="showSection('gaps')">Cuisines</button>
            <button class="nav-btn" onclick="showSection('partners')">Partners</button>
            <button class="nav-btn" onclick="showSection('methodology')">Methodology</button>
        </nav>
        
        <!-- MVP Thresholds Section -->
        <section id="thresholds" class="section active">
            <div class="section-header">
                <h2 class="section-title">3 Partners + 3 Cuisines = Zone Success</h2>
                <p class="section-description">
                    Data shows clear inflection points: <strong>+4.5pp repeat rate</strong> at 3+ partners, <strong>+4.2pp</strong> at 3+ cuisines. 
                    Dishes per partner has minimal effect. Based on <strong>197 zones</strong> with orders (Sep-Dec 2025).
                </p>
            </div>
            

            <!-- Zone Count Legend - ADDED BY FEEDBACK FIX -->
            <div class="methodology-note" style="margin-bottom: 1.5rem; background: rgba(59, 130, 246, 0.1); border-color: rgba(59, 130, 246, 0.3);">
                <strong style="color: var(--accent-blue);">üìä ZONE COUNT GUIDE</strong>
                <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; margin-top: 0.75rem; text-align: center;">
                    <div style="background: var(--bg-card); padding: 0.75rem; border-radius: 0.5rem;">
                        <div style="font-size: 1.5rem; font-weight: 700;">1,306</div>
                        <div style="font-size: 0.75rem; color: var(--text-secondary);">Total Zones</div>
                        <div style="font-size: 0.65rem; color: var(--text-muted);">Anna's full coverage</div>
                    </div>
                    <div style="background: var(--bg-card); padding: 0.75rem; border-radius: 0.5rem;">
                        <div style="font-size: 1.5rem; font-weight: 700;">434</div>
                        <div style="font-size: 0.75rem; color: var(--text-secondary);">With Supply</div>
                        <div style="font-size: 0.65rem; color: var(--text-muted);">Partners configured</div>
                    </div>
                    <div style="background: var(--bg-card); padding: 0.75rem; border-radius: 0.5rem;">
                        <div style="font-size: 1.5rem; font-weight: 700;">201</div>
                        <div style="font-size: 0.75rem; color: var(--text-secondary);">With Orders</div>
                        <div style="font-size: 0.65rem; color: var(--text-muted);">Trial activity</div>
                    </div>
                    <div style="background: var(--bg-card); padding: 0.75rem; border-radius: 0.5rem;">
                        <div style="font-size: 1.5rem; font-weight: 700;">197</div>
                        <div style="font-size: 0.75rem; color: var(--text-secondary);">Analyzed</div>
                        <div style="font-size: 0.65rem; color: var(--text-muted);">‚â•50 orders for stats</div>
                    </div>
                </div>
            </div>
            
            <!-- Role-Based Quick Start - ADDED BY FEEDBACK FIX -->
            <div class="step-card" style="margin-bottom: 2rem; border-top: 3px solid var(--accent-purple);">
                <div class="step-header">
                    <div class="step-number" style="background: var(--accent-purple);">üéØ</div>
                    <div>
                        <div class="step-title">Quick Start by Role</div>
                        <div class="step-subtitle">Jump to what matters most for your team</div>
                    </div>
                </div>
                <div class="step-content">
                    <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 0.75rem;">
                        <button onclick="showSection('thresholds'); setTimeout(() => document.getElementById('exec-summary')?.scrollIntoView({behavior:'smooth'}), 100);" style="background: var(--bg-card); border: 1px solid var(--border); border-radius: 0.5rem; padding: 1rem; cursor: pointer; text-align: center; transition: all 0.2s;" onmouseover="this.style.borderColor='var(--accent-teal)'" onmouseout="this.style.borderColor='var(--border)'">
                            <div style="font-size: 1.5rem;">üìä</div>
                            <div style="font-weight: 600; color: var(--text-primary); margin-top: 0.25rem;">Product</div>
                            <div style="font-size: 0.7rem; color: var(--text-muted);">MVP thresholds</div>
                        </button>
                        <button onclick="showSection('zones')" style="background: var(--bg-card); border: 1px solid var(--border); border-radius: 0.5rem; padding: 1rem; cursor: pointer; text-align: center; transition: all 0.2s;" onmouseover="this.style.borderColor='var(--accent-teal)'" onmouseout="this.style.borderColor='var(--border)'">
                            <div style="font-size: 1.5rem;">üó∫Ô∏è</div>
                            <div style="font-weight: 600; color: var(--text-primary); margin-top: 0.25rem;">Partner Ops</div>
                            <div style="font-size: 0.7rem; color: var(--text-muted);">Zone priority queue</div>
                        </button>
                        <button onclick="showSection('dishes')" style="background: var(--bg-card); border: 1px solid var(--border); border-radius: 0.5rem; padding: 1rem; cursor: pointer; text-align: center; transition: all 0.2s;" onmouseover="this.style.borderColor='var(--accent-teal)'" onmouseout="this.style.borderColor='var(--border)'">
                            <div style="font-size: 1.5rem;">üçΩÔ∏è</div>
                            <div style="font-weight: 600; color: var(--text-primary); margin-top: 0.25rem;">Commercial</div>
                            <div style="font-size: 0.7rem; color: var(--text-muted);">Dish recruitment</div>
                        </button>
                        <button onclick="showSection('gaps')" style="background: var(--bg-card); border: 1px solid var(--border); border-radius: 0.5rem; padding: 1rem; cursor: pointer; text-align: center; transition: all 0.2s;" onmouseover="this.style.borderColor='var(--accent-teal)'" onmouseout="this.style.borderColor='var(--border)'">
                            <div style="font-size: 1.5rem;">üé®</div>
                            <div style="font-weight: 600; color: var(--text-primary); margin-top: 0.25rem;">Marketing</div>
                            <div style="font-size: 0.7rem; color: var(--text-muted);">Cuisine positioning</div>
                        </button>
                        <button onclick="showSection('thresholds'); setTimeout(() => document.getElementById('exec-summary')?.scrollIntoView({behavior:'smooth'}), 100);" style="background: var(--bg-card); border: 1px solid var(--border); border-radius: 0.5rem; padding: 1rem; cursor: pointer; text-align: center; transition: all 0.2s;" onmouseover="this.style.borderColor='var(--accent-teal)'" onmouseout="this.style.borderColor='var(--border)'">
                            <div style="font-size: 1.5rem;">üëî</div>
                            <div style="font-weight: 600; color: var(--text-primary); margin-top: 0.25rem;">Leadership</div>
                            <div style="font-size: 0.7rem; color: var(--text-muted);">Executive summary</div>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Executive Summary Panel -->
            <div id="exec-summary" class="step-card" style="margin-bottom: 2rem; border-top: 3px solid var(--accent-teal);">
                <div class="step-header">
                    <div class="step-number" style="background: var(--accent-teal);">üìä</div>
                    <div>
                        <div class="step-title">Executive Summary</div>
                        <div class="step-subtitle">70 MVP zones | ¬£25 AOV | 82,350 orders (Sep-Dec 2025)</div>
                    </div>
                </div>
                <div class="step-content">
                    <!-- MVP Progress Bar -->
                    <div style="margin-bottom: 1.5rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                            <strong>MVP PROGRESS</strong>
                            <span>70/50 zones (140%) <span style="color: var(--success);">üéâ TARGET EXCEEDED!</span></span>
                        </div>
                        <div style="background: var(--bg-secondary); border-radius: 0.5rem; height: 24px; position: relative; overflow: hidden;">
                            <div style="background: linear-gradient(90deg, var(--accent-teal), var(--accent-purple)); width: 100%; height: 100%; border-radius: 0.5rem;"></div>
                            <div style="position: absolute; left: 100%; top: 0; height: 100%; width: 2px; background: var(--warning); transform: translateX(-100%);"></div>
                        </div>
                        <div style="display: flex; justify-content: space-between; font-size: 0.75rem; color: var(--text-muted); margin-top: 0.25rem;">
                            <span>0</span>
                            <span>Target: 50 by Q2</span>
                        </div>
                    </div>
                    
                    <!-- Near MVP Breakdown -->
                    <div style="background: var(--bg-secondary); border-radius: 0.75rem; padding: 1rem; margin-bottom: 1.5rem;">
                        <strong>NEAR MVP BREAKDOWN</strong> <span style="color: var(--text-muted);">(31 zones, 1 gap away)</span> <span class="evidence-badge validated" style="font-size: 0.65rem;">üü¢ zone_mvp_status.json</span>
                        <div style="display: flex; gap: 2rem; margin-top: 0.75rem;">
                            <div><span style="font-size: 1.5rem; font-weight: 700; color: var(--accent-teal);">31</span> need Healthy</div>
                            <div><span style="font-size: 1.5rem; font-weight: 700; color: var(--accent-purple);">25</span> need Indian</div>
                            <div><span style="font-size: 1.5rem; font-weight: 700; color: var(--accent-amber);">25</span> need Mexican</div>
                        </div>
                    </div>
                    
                    <!-- Segment Insights -->
                    <div style="background: var(--bg-secondary); border-radius: 0.75rem; padding: 1rem;">
                        <strong>WHO'S ORDERING DINNEROO?</strong> <span style="color: var(--text-muted);">(n=1,599)</span>
                        <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 0.5rem; margin-top: 0.75rem;">
                            <div style="text-align: center; padding: 0.5rem; background: var(--bg-card); border-radius: 0.5rem;">
                                <div style="font-size: 1.25rem; font-weight: 700;">46%</div>
                                <div style="font-size: 0.75rem; color: var(--text-secondary);">Family</div>
                                <div style="font-size: 0.65rem; color: var(--success);">üü¢ HIGH</div>
                            </div>
                            <div style="text-align: center; padding: 0.5rem; background: var(--bg-card); border-radius: 0.5rem;">
                                <div style="font-size: 1.25rem; font-weight: 700;">23%</div>
                                <div style="font-size: 0.75rem; color: var(--text-secondary);">Couple</div>
                                <div style="font-size: 0.65rem; color: var(--success);">üü¢ HIGH</div>
                            </div>
                            <div style="text-align: center; padding: 0.5rem; background: var(--bg-card); border-radius: 0.5rem;">
                                <div style="font-size: 1.25rem; font-weight: 700;">12%</div>
                                <div style="font-size: 0.75rem; color: var(--text-secondary);">Single</div>
                                <div style="font-size: 0.65rem; color: var(--warning);">üü° MED</div>
                            </div>
                            <div style="text-align: center; padding: 0.5rem; background: var(--bg-card); border-radius: 0.5rem;">
                                <div style="font-size: 1.25rem; font-weight: 700;">4%</div>
                                <div style="font-size: 0.75rem; color: var(--text-secondary);">Friends*</div>
                                <div style="font-size: 0.65rem; color: var(--danger);">üî¥ LOW</div>
                            </div>
                            <div style="text-align: center; padding: 0.5rem; background: var(--bg-card); border-radius: 0.5rem;">
                                <div style="font-size: 1.25rem; font-weight: 700;">16%</div>
                                <div style="font-size: 0.75rem; color: var(--text-secondary);">Mixed</div>
                                <div style="font-size: 0.65rem; color: var(--text-muted);">Multi-select</div>
                            </div>
                        </div>
                        <div style="margin-top: 0.75rem; padding: 0.5rem; background: rgba(0, 212, 170, 0.1); border-radius: 0.5rem; font-size: 0.85rem;">
                            üí° <strong>INSIGHT:</strong> Non-families are 54% of orders and equally/more satisfied (Couples: 87.1% <span style="color: var(--text-muted);">[n=205]</span> vs Families: 85.6% <span style="color: var(--text-muted);">[n=410]</span>)
                        </div>
                        <div style="font-size: 0.7rem; color: var(--text-muted); margin-top: 0.5rem;">
                            * Totals exceed 100% because customers can select multiple household types
                        </div>
                    </div>
                </div>
            </div>
            
            
            <!-- Alerts Panel -->
            <div class="step-card" style="margin-bottom: 2rem; border-top: 3px solid var(--danger);">
                <div class="step-header">
                    <div class="step-number" style="background: var(--danger);">‚ö†Ô∏è</div>
                    <div>
                        <div class="step-title">Needs Attention</div>
                        <div class="step-subtitle">Issues requiring immediate action</div>
                    </div>
                </div>
                <div class="step-content">
                    <div style="display: grid; gap: 0.75rem;">
                        <div style="background: var(--danger-dim); padding: 1rem; border-radius: 0.5rem; border-left: 3px solid var(--danger); display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <strong>31 Near MVP Zones</strong> need only 1 cuisine gap filled
                                <div style="font-size: 0.8rem; color: var(--text-muted);">31 need Healthy, 25 need Indian, 25 need Mexican</div>
                            </div>
                            <button class="nav-btn" style="background: var(--danger); padding: 0.25rem 0.5rem; font-size: 0.8rem;" onclick="showSection('zones')">View Zones ‚Üí</button>
                        </div>
                        <div style="background: var(--warning-dim); padding: 1rem; border-radius: 0.5rem; border-left: 3px solid var(--warning); display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <strong>87 Latent Demand Mentions</strong> for vegetarian options
                                <div style="font-size: 0.8rem; color: var(--text-muted);">OG Survey open-text (n=2,796) ¬∑ Top barrier after restaurant availability</div>
                            </div>
                            <button class="nav-btn" style="background: var(--warning); padding: 0.25rem 0.5rem; font-size: 0.8rem;" onclick="showSection('dishes')">View Dishes ‚Üí</button>
                        </div>
                        <div style="background: rgba(59, 130, 246, 0.1); padding: 1rem; border-radius: 0.5rem; border-left: 3px solid var(--accent-blue); display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <strong>Wagamama Expansion</strong> could unlock +25 zones
                                <div style="font-size: 0.8rem; color: var(--text-muted);">Highest impact single partner action</div>
                            </div>
                            <button class="nav-btn" style="background: var(--accent-blue); padding: 0.25rem 0.5rem; font-size: 0.8rem;" onclick="showSection('partners')">View Partners ‚Üí</button>
                        </div>
                    </div>
                </div>
            </div>
            
            
            <!-- Data Scope Callout -->
            <div class="methodology-note" style="margin-bottom: 2rem; background: var(--accent-blue); background: rgba(59, 130, 246, 0.1); border-color: rgba(59, 130, 246, 0.3);">
                <strong>üìä Data Scope:</strong> This analysis uses behavioral data from the Dinneroo trial period (Sep-Dec 2025). 
                Anna's supply data shows 434 zones with partners configured, but only 201 generated orders during the trial. 
                The remaining 233 zones are ready for activation as AMs onboard new sites.
            </div>
            
            <!-- Threshold Distinction Callout -->
            <div class="methodology-note" style="margin-bottom: 2rem; background: rgba(139, 92, 246, 0.1); border-color: rgba(139, 92, 246, 0.3);">
                <strong>üìê Two Types of Thresholds:</strong><br>
                ‚Ä¢ <strong>Inflection Point</strong> = Data-driven threshold where metrics show significant improvement<br>
                ‚Ä¢ <strong>MVP Target</strong> = Business requirement for zone launch readiness (from <code>config/mvp_thresholds.json</code>)
            </div>
            
            <!-- Summary Cards -->
            <div class="threshold-summary">
                <div class="threshold-card partners">
                    <div class="threshold-label">Partners</div>
                    <div class="threshold-values">
                        <div class="threshold-min">
                            <div class="value">3</div>
                            <div class="label">Inflection Point</div>
                        </div>
                        <div class="threshold-arrow">‚Üí</div>
                        <div class="threshold-target">
                            <div class="value">5</div>
                            <div class="label">MVP Target</div>
                        </div>
                    </div>
                    <div class="threshold-evidence">
                        <strong>Evidence:</strong> +4.5pp repeat rate at 3+ partners (n=15,611 orders)
                    </div>
                </div>
                
                <div class="threshold-card cuisines">
                    <div class="threshold-label">Cuisines</div>
                    <div class="threshold-values">
                        <div class="threshold-min">
                            <div class="value">3</div>
                            <div class="label">Inflection Point</div>
                        </div>
                        <div class="threshold-arrow">‚Üí</div>
                        <div class="threshold-target">
                            <div class="value">5</div>
                            <div class="label">MVP Target</div>
                        </div>
                    </div>
                    <div class="threshold-evidence">
                        <strong>Evidence:</strong> +4.2pp repeat rate at 3+ cuisines (n=20,132 orders)
                    </div>
                </div>
                
                <div class="threshold-card dishes">
                    <div class="threshold-label">Dishes per Partner</div>
                    <div class="threshold-values">
                        <div class="threshold-min">
                            <div class="value">4</div>
                            <div class="label">Inflection Point</div>
                        </div>
                        <div class="threshold-arrow">‚Üí</div>
                        <div class="threshold-target">
                            <div class="value">5</div>
                            <div class="label">MVP Target</div>
                        </div>
                    </div>
                    <div class="threshold-evidence">
                        <strong>Evidence:</strong> +0.7pp repeat rate at 4+ dishes/partner (n=8,669 orders)
                    </div>
                </div>
            </div>
            
            
            <!-- Bundle Math Callout -->
            <div class="methodology-note" style="margin-bottom: 2rem; background: rgba(0, 212, 170, 0.1); border-color: rgba(0, 212, 170, 0.3);">
                <strong style="color: var(--accent-teal);">üßÆ THE BUNDLE MATH: 21 = 7 √ó 3</strong>
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1.5rem; margin-top: 1rem; text-align: center;">
                    <div style="background: var(--bg-card); padding: 1rem; border-radius: 0.5rem;">
                        <div style="font-size: 2rem; font-weight: 700; color: var(--accent-purple);">7</div>
                        <div style="font-size: 0.85rem; color: var(--text-secondary);">Cuisines</div>
                        <div style="font-size: 0.75rem; color: var(--text-muted);">MVP target for variety</div>
                    </div>
                    <div style="background: var(--bg-card); padding: 1rem; border-radius: 0.5rem;">
                        <div style="font-size: 2rem; font-weight: 700; color: var(--accent-teal);">3</div>
                        <div style="font-size: 0.85rem; color: var(--text-secondary);">Dishes/Cuisine</div>
                        <div style="font-size: 0.75rem; color: var(--text-muted);">Minimum variety</div>
                    </div>
                    <div style="background: var(--bg-card); padding: 1rem; border-radius: 0.5rem;">
                        <div style="font-size: 2rem; font-weight: 700; color: var(--accent-amber);">21</div>
                        <div style="font-size: 0.85rem; color: var(--text-secondary);">Minimum Dishes</div>
                        <div style="font-size: 0.75rem; color: var(--text-muted);">7 cuisines √ó 3 each</div>
                    </div>
                </div>
                <div style="margin-top: 1rem; padding: 0.75rem; background: rgba(0, 0, 0, 0.2); border-radius: 0.5rem; font-size: 0.85rem;">
                    <strong>WHY:</strong> Each cuisine needs ‚â•3 dish types for adequate variety. With 7 cuisines at 3 dishes each = 21 minimum dishes.
                </div>
            </div>
            
            
            <!-- Interactive Threshold Simulator -->
            <div class="step-card" style="margin-bottom: 2rem; border-top: 3px solid var(--accent-pink);">
                <div class="step-header">
                    <div class="step-number" style="background: var(--accent-pink);">üéöÔ∏è</div>
                    <div>
                        <div class="step-title">Threshold Simulator</div>
                        <div class="step-subtitle">Explore cuisine threshold impact on MVP zone count</div>
                    </div>
                </div>
                <div class="step-content">
                    <div style="display: flex; align-items: center; gap: 2rem;">
                        <div style="flex: 1;">
                            <label style="display: block; margin-bottom: 0.5rem;">Cuisine Threshold: <strong id="simulator-value">5</strong></label>
                            <input type="range" min="3" max="7" value="5" 
                                   style="width: 100%; height: 8px; cursor: pointer;"
                                   oninput="updateThresholdSimulator(this.value)">
                            <div style="display: flex; justify-content: space-between; font-size: 0.75rem; color: var(--text-muted);">
                                <span>3 (loose)</span>
                                <span>7 (strict)</span>
                            </div>
                        </div>
                        <div style="text-align: center; padding: 1rem; background: var(--bg-secondary); border-radius: 0.5rem; min-width: 120px;">
                            <div style="font-size: 0.8rem; color: var(--text-muted);">Estimated MVP Zones</div>
                            <div id="simulator-zones" style="font-size: 1.75rem; font-weight: 700; color: var(--accent-teal);">70 zones</div>
                        </div>
                    </div>
                    <div style="margin-top: 1rem; padding: 0.5rem; background: rgba(236, 72, 153, 0.1); border-radius: 0.5rem; font-size: 0.8rem;">
                        üí° <strong>Targets:</strong> <span style="color: var(--success);">5 cuisines = MVP Ready</span> (launch threshold) ‚Üí <span style="color: var(--accent-purple);">7 cuisines = Full Core 7</span> (aspirational)
                    </div>
                </div>
            </div>
            
            <!-- Step 1: Partners -->
            <div class="step-card partners">
                <div class="step-header">
                    <div class="step-number">1</div>
                    <div>
                        <div class="step-title">3+ Partners = +4.5pp Repeat Rate</div>
                        <div class="step-subtitle">Primary driver of zone success ¬∑ Strongest effect</div>
                    </div>
                </div>
                <div class="step-content">
                    <div class="finding-callout">
                        <span class="finding-icon">üìà</span>
                        <span class="finding-text">
                            <strong>Clear inflection at 3-4 partners:</strong> Repeat rate jumps from 13.9% ‚Üí 18.4%. 
                            <span style="font-size: 0.85em; color: var(--text-muted);">(n=6,035 ‚Üí n=15,611 orders)</span>
                            <span class="evidence-badge validated">Validated</span>
                        </span>
                    </div>
                    
                    <div class="chart-row">
                        <div class="chart-box">
                            <div class="chart-title">
                                Repeat Rate by Partner Count
                                <span class="source-badge snowflake">Snowflake</span>
                                <span class="evidence-badge validated">n=57,320</span>
                            </div>
                            <div class="chart-container">
                                <canvas id="partnersRepeatChart"></canvas>
                            </div>
                        </div>
                        <div class="chart-box">
                            <div class="chart-title">
                                Survey Metrics (noisy, small n)
                                <span class="source-badge survey">Survey</span>
                                <span class="evidence-badge single">n=37-125</span>
                            </div>
                            <div class="chart-container">
                                <canvas id="partnersSurveyChart"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <div class="data-table-wrapper">
                        <button class="table-toggle" onclick="toggleTable('partners-table')">
                            <span>üìä</span>
                            <span>View all metrics by partner count</span>
                            <span class="arrow">‚ñº</span>
                        </button>
                        <div id="partners-table" class="data-table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Partners</th>
                                        <th>Zones</th>
                                        <th>Repeat Rate</th>
                                        <th>Avg Rating</th>
                                        <th>Kids Happy</th>
                                        <th>Liked/Loved</th>
                                        <th>Enough Food</th>
                                        <th>Food Hot</th>
                                        <th>On Time</th>
                                    </tr>
                                </thead>
                                <tbody id="partners-table-body"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Step 2: Cuisines -->
            <div class="step-card cuisines">
                <div class="step-header">
                    <div class="step-number">2</div>
                    <div>
                        <div class="step-title">3+ Cuisines = +4.2pp Repeat Rate</div>
                        <div class="step-subtitle">Independent effect ¬∑ Adds to partner benefit</div>
                    </div>
                </div>
                <div class="step-content">
                    <div class="finding-callout">
                        <span class="finding-icon">üìà</span>
                        <span class="finding-text">
                            <strong>Clear inflection at 3-4 cuisines:</strong> Repeat rate jumps from 18.3% ‚Üí 23.3% at 5-6 cuisines. 
                            <span style="font-size: 0.85em; color: var(--text-muted);">(n=2,084 ‚Üí n=13,763 orders)</span>
                            <span class="evidence-badge validated">Validated</span>
                        </span>
                    </div>
                    
                    <div class="chart-row">
                        <div class="chart-box">
                            <div class="chart-title">
                                Repeat Rate by Cuisine Count
                                <span class="source-badge snowflake">Snowflake</span>
                                <span class="evidence-badge validated">n=51,285</span>
                            </div>
                            <div class="chart-container">
                                <canvas id="cuisinesRepeatChart"></canvas>
                            </div>
                        </div>
                        <div class="chart-box">
                            <div class="chart-title">
                                Survey Metrics (noisy, small n)
                                <span class="source-badge survey">Survey</span>
                                <span class="evidence-badge single">n=16-150</span>
                            </div>
                            <div class="chart-container">
                                <canvas id="cuisinesSurveyChart"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <div class="data-table-wrapper">
                        <button class="table-toggle" onclick="toggleTable('cuisines-table')">
                            <span>üìä</span>
                            <span>View all metrics by cuisine count</span>
                            <span class="arrow">‚ñº</span>
                        </button>
                        <div id="cuisines-table" class="data-table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Cuisines</th>
                                        <th>Zones</th>
                                        <th>Repeat Rate</th>
                                        <th>Avg Rating</th>
                                        <th>Kids Happy</th>
                                        <th>Liked/Loved</th>
                                        <th>Enough Food</th>
                                        <th>Food Hot</th>
                                        <th>On Time</th>
                                    </tr>
                                </thead>
                                <tbody id="cuisines-table-body"></tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div class="methodology-note">
                        <strong>Note:</strong> Analysis includes all zones. The cuisine effect is independent of partner count.
                    </div>
                </div>
            </div>
            
            <!-- Step 3: Dishes per Partner -->
            <div class="step-card dishes">
                <div class="step-header">
                    <div class="step-number">3</div>
                    <div>
                        <div class="step-title">4+ Dishes/Partner = Marginal Gain</div>
                        <div class="step-subtitle">Smallest effect ¬∑ Diminishing returns above 5</div>
                    </div>
                </div>
                <div class="step-content">
                    <div class="finding-callout">
                        <span class="finding-icon">üìà</span>
                        <span class="finding-text">
                            <strong>Weak inflection at 4-5 dishes/partner:</strong> Repeat rate improves +0.7pp (20.9% ‚Üí 21.6%), then plateaus. 
                            <span style="font-size: 0.85em; color: var(--text-muted);">(n=6,179 ‚Üí n=8,669 orders)</span>
                            <span class="evidence-badge corroborated">Corroborated</span>
                        </span>
                    </div>
                    
                    <div class="chart-row">
                        <div class="chart-box">
                            <div class="chart-title">
                                Repeat Rate by Dishes per Partner
                                <span class="source-badge snowflake">Snowflake</span>
                                <span class="evidence-badge corroborated">n=49,021</span>
                            </div>
                            <div class="chart-container">
                                <canvas id="dishesRepeatChart"></canvas>
                            </div>
                        </div>
                        <div class="chart-box">
                            <div class="chart-title">
                                Survey Metrics (noisy, small n)
                                <span class="source-badge survey">Survey</span>
                                <span class="evidence-badge single">n=41-185</span>
                            </div>
                            <div class="chart-container">
                                <canvas id="dishesSurveyChart"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <div class="data-table-wrapper">
                        <button class="table-toggle" onclick="toggleTable('dishes-table')">
                            <span>üìä</span>
                            <span>View all metrics by dishes per partner</span>
                            <span class="arrow">‚ñº</span>
                        </button>
                        <div id="dishes-table" class="data-table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Dishes/Partner</th>
                                        <th>Zones</th>
                                        <th>Repeat Rate</th>
                                        <th>Avg Rating</th>
                                        <th>Kids Happy</th>
                                        <th>Liked/Loved</th>
                                        <th>Enough Food</th>
                                        <th>Food Hot</th>
                                    </tr>
                                </thead>
                                <tbody id="dishes-table-body"></tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div class="methodology-note">
                        <strong>Note:</strong> Most zones have 4-6 dishes per partner. Data is sparse at extremes (3 or 7+ dishes).
                    </div>
                    <div class="methodology-note" style="margin-top: 0.75rem;">
                        <strong>Definition:</strong> "Dishes" = meal options within bundles. A family bundle may include multiple dishes (e.g., adult pho + kids rice bowl = 2 dishes).
                    </div>
                </div>
            </div>
            
            <!-- Source Attribution -->
            <div class="source-attribution">
                <h3>Data Sources & Methodology</h3>
                <div class="source-grid">
                    <div class="source-group">
                        <h4><span class="source-badge snowflake">Snowflake</span> Behavioral Data (Trial Period)</h4>
                        <ul>
                            <li><strong>Period:</strong> Sep 2025 - Dec 2025 (trial)</li>
                            <li><strong>Orders:</strong> 82,350 delivered Dinneroo orders</li>
                            <li><strong>Zones:</strong> 201 zones with order activity</li>
                            <li><strong>Repeat Rate:</strong> % customers with 2+ orders</li>
                            <li><strong>Average Rating:</strong> Mean star rating</li>
                        </ul>
                    </div>
                    <div class="source-group">
                        <h4><span class="source-badge survey">Survey</span> Post-Order Survey</h4>
                        <ul>
                            <li><strong>Kids Happy:</strong> % "Full and happy" (families only)</li>
                            <li><strong>Liked/Loved:</strong> % "Loved it" or "Liked it"</li>
                            <li><strong>Enough Food:</strong> % Agree portions adequate</li>
                            <li><strong>Food Hot/On Time:</strong> Operational quality metrics</li>
                        </ul>
                    </div>
                </div>
                <div class="methodology-note" style="margin-top: 1.5rem; background: rgba(245, 158, 11, 0.1); border-color: rgba(245, 158, 11, 0.3);">
                    <strong>‚ö†Ô∏è Data Reconciliation:</strong> Anna's supply data (Zone X Dish Mapping) shows <strong>434 zones</strong> with Dinneroo partners configured. 
                    However, only <strong>201 zones</strong> generated orders during the trial period (197 had sufficient data for statistical analysis). 
                    The gap of 233 zones represents expansion opportunity ‚Äî partners are onboarded but awaiting customer activation as AMs roll out to new areas in 2026.
                    <br><em>See <code>config/dashboard_metrics.json</code> for authoritative counts with provenance.</em>
                </div>
                <div class="methodology-note" style="margin-top: 0.75rem;">
                    <strong>Why These Metrics?</strong> Dinneroo's success is defined by families returning and being satisfied. 
                    <strong>Repeat rate</strong> is our primary behavioral signal ‚Äî it shows families found enough value to order again. 
                    <strong>Kids happy</strong> is the core family-specific outcome ‚Äî if kids aren't satisfied, parents won't reorder. 
                    We triangulate behavioral data (what people do) with survey data (what people say) to validate thresholds from multiple angles.
                </div>
                <div class="methodology-note" style="margin-top: 0.75rem;">
                    <strong>Hierarchical Analysis:</strong> We analyzed factors in order of impact ‚Äî partners first, then cuisines, 
                    then dishes per partner. This reveals the independent contribution of each factor to zone success.
                </div>
            </div>
        </section>
        
        <!-- Zones Section -->
        <section id="zones" class="section">
            <div class="section-header">
                <h2 class="section-title">Zone Health & MVP Status</h2>
                <p class="section-description">
                    Track zone readiness across <strong>201 zones with orders</strong>. 
                    <br><br>
                    <strong>MVP Ready</strong> = 5+ partners, 5+ cuisines, 4.0+ rating
                    <br>
                    <strong>Health Score</strong> = Weighted composite (40% orders, 30% rating, 20% repeat rate, 10% cuisine coverage). Higher = better performing.
                </p>
            </div>
            
            
            <!-- Zone Progression Funnel -->
            <div class="step-card" style="margin-bottom: 2rem; border-top: 3px solid var(--accent-blue);">
                <div class="step-header">
                    <div class="step-number" style="background: var(--accent-blue);">üìä</div>
                    <div>
                        <div class="step-title">Zone Progression Funnel</div>
                        <div class="step-subtitle">Journey from configured to MVP</div>
                    </div>
                </div>
                <div class="step-content">
                    <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                        <!-- Configured -->
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <div style="width: 100%; background: rgba(59, 130, 246, 0.3); height: 40px; border-radius: 4px; display: flex; align-items: center; padding: 0 1rem; justify-content: space-between;">
                                <span style="font-weight: 600;">Configured</span>
                                <span style="font-weight: 700; font-size: 1.25rem;">434</span>
                            </div>
                        </div>
                        <!-- With Orders -->
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <div style="width: 46%; margin-left: 27%; background: rgba(139, 92, 246, 0.3); height: 40px; border-radius: 4px; display: flex; align-items: center; padding: 0 1rem; justify-content: space-between;">
                                <span style="font-weight: 600;">With Orders</span>
                                <span style="font-weight: 700; font-size: 1.25rem;">201</span>
                            </div>
                            <span style="font-size: 0.8rem; color: var(--text-muted);">46% conversion</span>
                        </div>
                        <!-- Near MVP -->
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <div style="width: 15%; margin-left: 42.5%; background: rgba(245, 158, 11, 0.3); height: 40px; border-radius: 4px; display: flex; align-items: center; padding: 0 1rem; justify-content: space-between;">
                                <span style="font-weight: 600;">Near MVP</span>
                                <span style="font-weight: 700; font-size: 1.25rem;">31</span>
                            </div>
                            <span style="font-size: 0.8rem; color: var(--text-muted);">1 gap away</span>
                        </div>
                        <!-- At MVP -->
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <div style="width: 35%; margin-left: 32.5%; background: rgba(0, 212, 170, 0.4); height: 40px; border-radius: 4px; display: flex; align-items: center; padding: 0 1rem; justify-content: space-between;">
                                <span style="font-weight: 600;">At MVP</span>
                                <span style="font-weight: 700; font-size: 1.25rem;">70</span>
                            </div>
                            <span style="font-size: 0.8rem; color: var(--success);">‚úì Ready</span>
                        </div>
                    </div>
                    <div style="margin-top: 1rem; padding: 0.75rem; background: var(--bg-secondary); border-radius: 0.5rem; font-size: 0.85rem;">
                        <strong>üí° Opportunity:</strong> Converting 31 Near MVP zones would boost MVP-ready from 70 to 101 zones
                    </div>
                </div>
            </div>
            
            <!-- PARTNER OPS: Quick Wins Priority Queue -->
            <div class="step-card" style="margin-bottom: 2rem; border-top: 3px solid var(--warning);">
                <div class="step-header">
                    <div class="step-number" style="background: var(--warning);">üéØ</div>
                    <div>
                        <div class="step-title">Quick Wins: Near MVP Zones</div>
                        <div class="step-subtitle">31 zones need just 1 cuisine to reach MVP - sorted by effort</div>
                    </div>
                </div>
                <div class="step-content">
                    <div style="overflow-x: auto;">
                        <table style="width: 100%; border-collapse: collapse; font-size: 0.85rem;">
                            <thead>
                                <tr style="background: var(--bg-secondary); text-align: left;">
                                    <th style="padding: 0.5rem; border-bottom: 1px solid var(--border);">Zone</th>
                                    <th style="padding: 0.5rem; border-bottom: 1px solid var(--border);">Missing</th>
                                    <th style="padding: 0.5rem; border-bottom: 1px solid var(--border);">Orders</th>
                                    <th style="padding: 0.5rem; border-bottom: 1px solid var(--border);">Fix</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td style="padding: 0.5rem; border-bottom: 1px solid var(--border);">Norwich</td>
                                    <td style="padding: 0.5rem; border-bottom: 1px solid var(--border);"><span style="background: var(--warning-dim); color: var(--warning); padding: 0.1rem 0.3rem; border-radius: 3px; font-size: 0.75rem;">Indian</span></td>
                                    <td style="padding: 0.5rem; border-bottom: 1px solid var(--border);">1,228</td>
                                    <td style="padding: 0.5rem; border-bottom: 1px solid var(--border); font-size: 0.75rem;">Dishoom, Tiffin Tin</td>
                                </tr>
                                <tr>
                                    <td style="padding: 0.5rem; border-bottom: 1px solid var(--border);">Guildford</td>
                                    <td style="padding: 0.5rem; border-bottom: 1px solid var(--border);"><span style="background: var(--warning-dim); color: var(--warning); padding: 0.1rem 0.3rem; border-radius: 3px; font-size: 0.75rem;">Indian</span></td>
                                    <td style="padding: 0.5rem; border-bottom: 1px solid var(--border);">969</td>
                                    <td style="padding: 0.5rem; border-bottom: 1px solid var(--border); font-size: 0.75rem;">Dishoom, Tadka House</td>
                                </tr>
                                <tr>
                                    <td style="padding: 0.5rem; border-bottom: 1px solid var(--border);">Chelmsford</td>
                                    <td style="padding: 0.5rem; border-bottom: 1px solid var(--border);"><span style="background: var(--accent-purple-dim); color: var(--accent-purple); padding: 0.1rem 0.3rem; border-radius: 3px; font-size: 0.75rem;">Mexican</span></td>
                                    <td style="padding: 0.5rem; border-bottom: 1px solid var(--border);">725</td>
                                    <td style="padding: 0.5rem; border-bottom: 1px solid var(--border); font-size: 0.75rem;">Tortilla, Wahaca</td>
                                </tr>
                                <tr>
                                    <td style="padding: 0.5rem; border-bottom: 1px solid var(--border);">York</td>
                                    <td style="padding: 0.5rem; border-bottom: 1px solid var(--border);"><span style="background: var(--accent-teal-dim); color: var(--accent-teal); padding: 0.1rem 0.3rem; border-radius: 3px; font-size: 0.75rem;">Healthy</span></td>
                                    <td style="padding: 0.5rem; border-bottom: 1px solid var(--border);">729</td>
                                    <td style="padding: 0.5rem; border-bottom: 1px solid var(--border); font-size: 0.75rem;">Leon, Farmer J</td>
                                </tr>
                                <tr>
                                    <td style="padding: 0.5rem; border-bottom: 1px solid var(--border);">Nottingham</td>
                                    <td style="padding: 0.5rem; border-bottom: 1px solid var(--border);"><span style="background: var(--accent-teal-dim); color: var(--accent-teal); padding: 0.1rem 0.3rem; border-radius: 3px; font-size: 0.75rem;">Healthy</span></td>
                                    <td style="padding: 0.5rem; border-bottom: 1px solid var(--border);">759</td>
                                    <td style="padding: 0.5rem; border-bottom: 1px solid var(--border); font-size: 0.75rem;">Leon, Itsu</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div style="margin-top: 0.75rem; text-align: center;">
                        <button onclick="showSection('zones'); setTimeout(() => document.getElementById('zones-table')?.scrollIntoView({behavior:'smooth'}), 100);" 
                                style="background: var(--warning); color: var(--bg-primary); border: none; padding: 0.5rem 1rem; border-radius: 0.5rem; cursor: pointer; font-weight: 600;">
                            View All 31 Near MVP Zones ‚Üí
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Zone KPI Cards -->
            <div class="threshold-summary" style="grid-template-columns: repeat(4, 1fr);">
                <div class="threshold-card partners">
                    <div class="threshold-label">MVP Ready</div>
                    <div class="threshold-values" style="justify-content: center;">
                        <div class="threshold-target">
                            <div class="value" id="mvp-ready-count">70</div>
                            <div class="label">Zones</div>
                        </div>
                    </div>
                    <div class="threshold-evidence">
                        <strong>35%</strong> of zones with orders meet all MVP criteria (70 of 201)
                    </div>
                </div>
                
                <div class="threshold-card cuisines">
                    <div class="threshold-label">Near MVP</div>
                    <div class="threshold-values" style="justify-content: center;">
                        <div class="threshold-target">
                            <div class="value" id="near-mvp-count">12</div>
                            <div class="label">Zones</div>
                        </div>
                    </div>
                    <div class="threshold-evidence">
                        Meeting <strong>2 of 3</strong> criteria - close to ready
                    </div>
                </div>
                
                <div class="threshold-card dishes">
                    <div class="threshold-label">Developing</div>
                    <div class="threshold-values" style="justify-content: center;">
                        <div class="threshold-target">
                            <div class="value" id="developing-count">47</div>
                            <div class="label">Zones</div>
                        </div>
                    </div>
                    <div class="threshold-evidence">
                        Meeting <strong>0-1</strong> criteria - needs recruitment
                    </div>
                </div>
                
                <div class="threshold-card" style="border-top: 3px solid var(--accent-blue);">
                    <div class="threshold-label">Top Zone</div>
                    <div class="threshold-values" style="justify-content: center;">
                        <div class="threshold-target">
                            <div class="value" style="font-size: 1.25rem; color: var(--accent-blue);">Clapham</div>
                            <div class="label">2,349 orders</div>
                        </div>
                    </div>
                    <div class="threshold-evidence">
                        <strong>13 partners</strong>, 9 cuisines, 4.61 rating
                    </div>
                </div>
            </div>
            
            <!-- Charts Row -->
            <div class="chart-row">
                <div class="chart-box">
                    <div class="chart-title">
                        MVP Status Distribution
                        <span class="source-badge snowflake">201 Zones</span>
                    </div>
                    <div class="chart-container" style="height: 280px;">
                        <canvas id="zoneMvpDonutChart"></canvas>
                    </div>
                </div>
                <div class="chart-box">
                    <div class="chart-title">
                        Top 10 Zones by Composite Score
                        <span class="source-badge snowflake">Ranked</span>
                    </div>
                    <div class="chart-container" style="height: 280px;">
                        <canvas id="topZonesBarChart"></canvas>
                    </div>
                </div>
            </div>
            
            <!-- Zone Filters -->
            <div style="margin-bottom: 1rem; padding: 1rem; background: var(--bg-secondary); border-radius: 0.75rem; border: 1px solid var(--border);">
                <div style="display: flex; gap: 1rem; align-items: center; flex-wrap: wrap; margin-bottom: 0.75rem;">
                    <!-- Search -->
                    <div style="flex: 1; min-width: 200px;">
                        <input type="text" id="zoneSearchFilter" onkeyup="filterZoneTable()" placeholder="Search zones..." 
                            style="width: 100%; padding: 0.5rem 1rem; background: var(--bg-card); border: 1px solid var(--border); border-radius: 0.5rem; color: var(--text-primary); font-family: inherit;">
                    </div>
                    
                    <!-- Region Filter -->
                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                        <label style="font-size: 0.8rem; color: var(--text-secondary);">Region:</label>
                        <select id="zoneRegionFilter" onchange="filterZoneTable()" style="padding: 0.5rem 0.75rem; background: var(--bg-card); border: 1px solid var(--border); border-radius: 0.5rem; color: var(--text-primary); font-family: inherit; font-size: 0.85rem;">
                            <option value="all">All Regions</option>
                        </select>
                    </div>
                    
                    <!-- Status Filter -->
                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                        <label style="font-size: 0.8rem; color: var(--text-secondary);">Status:</label>
                        <select id="zoneMvpFilter" onchange="filterZoneTable()" style="padding: 0.5rem 0.75rem; background: var(--bg-card); border: 1px solid var(--border); border-radius: 0.5rem; color: var(--text-primary); font-family: inherit; font-size: 0.85rem;">
                            <option value="all">All Statuses</option>
                            <option value="mvp">MVP Ready</option>
                            <option value="near">Near MVP</option>
                            <option value="developing">Developing</option>
                        </select>
                    </div>
                    
                    <!-- Progress Filter -->
                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                        <label style="font-size: 0.8rem; color: var(--text-secondary);">Progress:</label>
                        <select id="zoneProgressFilter" onchange="filterZoneTable()" style="padding: 0.5rem 0.75rem; background: var(--bg-card); border: 1px solid var(--border); border-radius: 0.5rem; color: var(--text-primary); font-family: inherit; font-size: 0.85rem;">
                            <option value="all">All</option>
                            <option value="high">‚â•80%</option>
                            <option value="medium">50-79%</option>
                            <option value="low">&lt;50%</option>
                        </select>
                    </div>
                    
                    <!-- Partners Filter -->
                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                        <label style="font-size: 0.8rem; color: var(--text-secondary);">Partners:</label>
                        <select id="zonePartnersFilter" onchange="filterZoneTable()" style="padding: 0.5rem 0.75rem; background: var(--bg-card); border: 1px solid var(--border); border-radius: 0.5rem; color: var(--text-primary); font-family: inherit; font-size: 0.85rem;">
                            <option value="all">All</option>
                            <option value="5+">5+ Partners</option>
                            <option value="3-4">3-4 Partners</option>
                            <option value="1-2">1-2 Partners</option>
                        </select>
                    </div>
                </div>
                
                <!-- Results count and clear -->
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <span style="font-size: 0.8rem; color: var(--text-muted);">
                        Showing <strong id="zone-filtered-count">0</strong> of <strong id="zone-total-count">201</strong> zones with orders
                    </span>
                    <button onclick="clearZoneFilters()" style="padding: 0.35rem 0.75rem; background: transparent; border: 1px solid var(--border); border-radius: 0.5rem; color: var(--text-secondary); font-family: inherit; font-size: 0.8rem; cursor: pointer;">
                        Clear Filters
                    </button>
                </div>
            </div>
            
            <!-- Zone Table -->
            <div class="data-table-wrapper">
                <button class="table-toggle open" onclick="toggleTable('zones-table')">
                    <span>üìä</span>
                    <span>Zone Health Details (<span id="zone-table-count">201</span> zones) - Click headers to sort, click row for Route to MVP</span>
                    <span class="arrow">‚ñº</span>
                </button>
                <div id="zones-table" class="data-table-container open">
                    <table class="data-table" id="zone-data-table">
                        <thead>
                            <tr>
                                <th class="sortable" data-sort="zone" onclick="sortZoneTable('zone')">Zone <span class="sort-indicator"></span></th>
                                <th class="sortable" data-sort="region" onclick="sortZoneTable('region')">Region <span class="sort-indicator"></span></th>
                                <th class="sortable" data-sort="status" onclick="sortZoneTable('status')">Status <span class="sort-indicator"></span></th>
                                <th class="sortable" data-sort="orders" onclick="sortZoneTable('orders')">Orders <span class="sort-indicator">‚ñº</span></th>
                                <th class="sortable" data-sort="partners" onclick="sortZoneTable('partners')">Partners <span class="sort-indicator"></span></th>
                                <th class="sortable" data-sort="cuisines" onclick="sortZoneTable('cuisines')">Cuisines <span class="sort-indicator"></span></th>
                                <th class="sortable" data-sort="rating" onclick="sortZoneTable('rating')">Rating <span class="sort-indicator"></span></th>
                                <th class="sortable" data-sort="progress" onclick="sortZoneTable('progress')">Progress <span class="sort-indicator"></span></th>
                            </tr>
                        </thead>
                        <tbody id="zones-table-body"></tbody>
                    </table>
                </div>
            </div>
            
            <!-- Source Attribution -->
            <div class="source-attribution" style="margin-top: 2rem;">
                <h3>Data Sources</h3>
                <div class="methodology-note">
                    <strong>Zone Data:</strong> <code>zone_analysis.json</code> (1,306 zones from Anna's ground truth). 
                    <strong>Cuisines:</strong> Anna's 7 categories (Asian, Italian, Indian, Healthy, Mexican, Middle Eastern, British).
                    <strong>Core Drivers:</strong> 8 dish types (Pho, Indian Curry, Biryani, Fried Rice, Sushi, Katsu, Rice Bowl, Noodles).
                </div>
            </div>
        </section>
        
        <!-- Dishes Section -->
        <section id="dishes" class="section">
            <div class="section-header">
                <h2 class="section-title">Dish Strategy</h2>
                <p class="section-description">
                    <strong style="color: var(--accent-teal); font-size: 1.1rem;">5 dishes drive 70% of orders.</strong> 
                    Focus on protecting winners and filling gaps.
                </p>
            </div>
            
            <!-- THE STORY: Three Key Insights -->
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1.5rem; margin-bottom: 2rem;">
                
                <!-- Card 1: Winners -->
                <div class="step-card" style="border-top: 3px solid var(--success);">
                    <div class="step-header">
                        <div class="step-number" style="background: var(--success);">1</div>
                        <div>
                            <div class="step-title">Our Winners</div>
                            <div class="step-subtitle">Protect these - they drive volume</div>
                        </div>
                    </div>
                    <div class="step-content" style="padding-top: 0;">
                        <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                            <div style="display: flex; justify-content: space-between; padding: 0.5rem; background: var(--bg-secondary); border-radius: 0.5rem;">
                                <span style="font-weight: 600;">ü•á Katsu</span>
                                <span style="color: var(--success);">19,534 orders</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 0.5rem; background: var(--bg-secondary); border-radius: 0.5rem;">
                                <span style="font-weight: 600;">ü•à Noodles</span>
                                <span style="color: var(--success);">17,906 orders</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 0.5rem; background: var(--bg-secondary); border-radius: 0.5rem;">
                                <span style="font-weight: 600;">ü•â Curry</span>
                                <span style="color: var(--success);">13,302 orders</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 0.5rem; background: var(--bg-secondary); border-radius: 0.5rem;">
                                <span>4. Pho</span>
                                <span style="color: var(--text-secondary);">9,392 orders</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 0.5rem; background: var(--bg-secondary); border-radius: 0.5rem;">
                                <span>5. Rice Bowl</span>
                                <span style="color: var(--text-secondary);">6,707 orders</span>
                            </div>
                        </div>
                        <div style="margin-top: 0.75rem; font-size: 0.8rem; color: var(--text-muted); text-align: center;">
                            = 81% of dish mentions (n=82,350 orders)
                        </div>
                    </div>
                </div>
                
                <!-- Card 2: Recruit -->
                <div class="step-card" style="border-top: 3px solid var(--warning);">
                    <div class="step-header">
                        <div class="step-number" style="background: var(--warning);">2</div>
                        <div>
                            <div class="step-title">Gaps to Fill</div>
                            <div class="step-subtitle">Unmet demand from surveys</div>
                        </div>
                    </div>
                    <div class="step-content" style="padding-top: 0;">
                        <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.5rem; background: var(--bg-secondary); border-radius: 0.5rem;">
                                <div>
                                    <span style="font-weight: 600;">Veggie Options</span>
                                    <div style="font-size: 0.65rem; color: var(--text-muted);">‚Üí Leon, Itsu, Farmer J</div>
                                </div>
                                <span style="background: var(--warning-dim); color: var(--warning); padding: 0.15rem 0.4rem; border-radius: 4px; font-size: 0.7rem;">87 mentions</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.5rem; background: var(--bg-secondary); border-radius: 0.5rem;">
                                <div>
                                    <span style="font-weight: 600;">Grilled Chicken</span>
                                    <div style="font-size: 0.65rem; color: var(--text-muted);">‚Üí Nando's, Farmer J, Cocotte</div>
                                </div>
                                <span style="background: var(--warning-dim); color: var(--warning); padding: 0.15rem 0.4rem; border-radius: 4px; font-size: 0.7rem;">45 mentions</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.5rem; background: var(--bg-secondary); border-radius: 0.5rem;">
                                <div>
                                    <span style="font-weight: 600;">Fish &amp; Chips</span>
                                    <div style="font-size: 0.65rem; color: var(--text-muted);">‚Üí New recruitment needed</div>
                                </div>
                                <span style="background: var(--warning-dim); color: var(--warning); padding: 0.15rem 0.4rem; border-radius: 4px; font-size: 0.7rem;">38 mentions</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.5rem; background: var(--bg-secondary); border-radius: 0.5rem;">
                                <div>
                                    <span style="font-weight: 600;">Dim Sum</span>
                                    <div style="font-size: 0.65rem; color: var(--text-muted);">‚Üí Ping Pong, new recruitment</div>
                                </div>
                                <span style="background: var(--warning-dim); color: var(--warning); padding: 0.15rem 0.4rem; border-radius: 4px; font-size: 0.7rem;">Supply gap</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.5rem; background: var(--bg-secondary); border-radius: 0.5rem;">
                                <div>
                                    <span style="font-weight: 600;">Shawarma</span>
                                    <div style="font-size: 0.65rem; color: var(--text-muted);">‚Üí German Doner, new recruitment</div>
                                </div>
                                <span style="background: var(--warning-dim); color: var(--warning); padding: 0.15rem 0.4rem; border-radius: 4px; font-size: 0.7rem;">Supply gap</span>
                            </div>
                        </div>
                        <div style="margin-top: 0.75rem; font-size: 0.8rem; color: var(--text-muted); text-align: center;">
                            Source: OG Survey open-text (n=2,796)
                        </div>
                    </div>
                </div>
                
                <!-- Card 3: Segments -->
                <div class="step-card" style="border-top: 3px solid var(--accent-purple);">
                    <div class="step-header">
                        <div class="step-number" style="background: var(--accent-purple);">3</div>
                        <div>
                            <div class="step-title">Who Wants What</div>
                            <div class="step-subtitle">Segment preferences differ</div>
                        </div>
                    </div>
                    <div class="step-content" style="padding-top: 0;">
                        <div style="margin-bottom: 1rem;">
                            <div style="font-weight: 600; color: var(--accent-teal); margin-bottom: 0.5rem;">üë®‚Äçüë©‚Äçüëß Families prefer:</div>
                            <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                                <span style="background: var(--accent-teal-dim); color: var(--accent-teal); padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.8rem;">Pizza +12%</span>
                                <span style="background: var(--accent-teal-dim); color: var(--accent-teal); padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.8rem;">Nuggets +18%</span>
                                <span style="background: var(--accent-teal-dim); color: var(--accent-teal); padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.8rem;">Pasta +8%</span>
                            </div>
                        </div>
                        <div>
                            <div style="font-weight: 600; color: var(--accent-purple); margin-bottom: 0.5rem;">üíë Couples prefer:</div>
                            <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                                <span style="background: var(--accent-purple-dim); color: var(--accent-purple); padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.8rem;">Curry +15%</span>
                                <span style="background: var(--accent-purple-dim); color: var(--accent-purple); padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.8rem;">Sushi +22%</span>
                                <span style="background: var(--accent-purple-dim); color: var(--accent-purple); padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.8rem;">Steak +11%</span>
                            </div>
                        </div>
                        <div style="margin-top: 1rem; padding: 0.5rem; background: rgba(139, 92, 246, 0.1); border-radius: 0.5rem; font-size: 0.8rem;">
                            üí° Both segments love <strong>Katsu</strong> and <strong>Rice Bowls</strong>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Summary -->
            <div class="methodology-note" style="margin-bottom: 2rem; background: rgba(0, 212, 170, 0.1); border-color: rgba(0, 212, 170, 0.3);">
                <strong style="color: var(--accent-teal);">üìã ACTION SUMMARY</strong>
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; margin-top: 0.75rem;">
                    <div>
                        <strong style="color: var(--success);">PROTECT</strong>
                        <div style="font-size: 0.85rem; color: var(--text-secondary);">Top 5 dishes, maintain partner quality</div>
                    </div>
                    <div>
                        <strong style="color: var(--warning);">RECRUIT</strong>
                        <div style="font-size: 0.85rem; color: var(--text-secondary);">Veggie options, Grilled Chicken, Fish &amp; Chips</div>
                    </div>
                    <div>
                        <strong style="color: var(--accent-purple);">POSITION</strong>
                        <div style="font-size: 0.85rem; color: var(--text-secondary);">Family-friendly for families, premium for couples</div>
                    </div>
                </div>
            </div>
            
            <!-- Detailed Analysis (Expandable) -->
            <div class="step-card" style="margin-bottom: 2rem; border-top: 3px solid var(--border);">
                <div class="step-header">
                    <div class="step-number" style="background: var(--bg-secondary); color: var(--text-secondary);">üìä</div>
                    <div>
                        <div class="step-title">Detailed Dish Data</div>
                        <div class="step-subtitle">Full rankings, scores, and methodology for deep dives</div>
                    </div>
                </div>
                <div class="step-content">
                    <div style="background: rgba(245, 158, 11, 0.1); border: 1px solid rgba(245, 158, 11, 0.3); border-radius: 0.5rem; padding: 0.75rem; margin-bottom: 1rem;">
                        <strong style="color: var(--warning);">‚ö†Ô∏è NOTE:</strong>
                        <span style="color: var(--text-secondary); font-size: 0.85rem;">
                            Order data only shows what's working among dishes we already offer. 
                            The "Gaps to Fill" above shows unmet demand for dishes not yet on Dinneroo.
                        </span>
                    </div>
                    
            <!-- Dish KPI Cards -->
            <div class="threshold-summary" style="grid-template-columns: repeat(4, 1fr);">
                <div class="threshold-card partners">
                    <div class="threshold-label">Tier 1: Must-Have</div>
                    <div class="threshold-values" style="justify-content: center;">
                        <div class="threshold-target">
                            <div class="value">7</div>
                            <div class="label">Dishes</div>
                        </div>
                    </div>
                    <div class="threshold-evidence">
                        Score <strong>4.0+</strong> - Essential for zone success
                    </div>
                </div>
                
                <div class="threshold-card cuisines">
                    <div class="threshold-label">Priority Quadrant</div>
                    <div class="threshold-values" style="justify-content: center;">
                        <div class="threshold-target">
                            <div class="value">11</div>
                            <div class="label">Dishes</div>
                        </div>
                    </div>
                    <div class="threshold-evidence">
                        High performance <strong>AND</strong> high opportunity
                    </div>
                </div>
                
                <div class="threshold-card dishes">
                    <div class="threshold-label">On Dinneroo</div>
                    <div class="threshold-values" style="justify-content: center;">
                        <div class="threshold-target">
                            <div class="value">33</div>
                            <div class="label">Dishes</div>
                        </div>
                    </div>
                    <div class="threshold-evidence">
                        With <strong>performance data</strong> from orders
                    </div>
                </div>
                
                <div class="threshold-card" style="border-top: 3px solid var(--accent-blue);">
                    <div class="threshold-label">Top Dish</div>
                    <div class="threshold-values" style="justify-content: center;">
                        <div class="threshold-target">
                            <div class="value" style="font-size: 1.25rem; color: var(--accent-blue);">Curry</div>
                            <div class="label">Score: 4.94</div>
                        </div>
                    </div>
                    <div class="threshold-evidence">
                        <strong>5,897 orders</strong>, Indian cuisine
                    </div>
                </div>
            </div>
            
            <!-- 2x2 Matrix Explanation -->
            <div class="methodology-note" style="margin-bottom: 1.5rem; background: rgba(139, 92, 246, 0.1); border-color: rgba(139, 92, 246, 0.3);">
                <strong>2x2 Matrix Guide:</strong> 
                <strong style="color: var(--success);">Priority</strong> (high perf + high opp) = Expand aggressively | 
                <strong style="color: var(--accent-blue);">Protect</strong> (high perf + low opp) = Maintain quality | 
                <strong style="color: var(--warning);">Develop</strong> (low perf + high opp) = Fix issues | 
                <strong style="color: var(--text-muted);">Monitor</strong> (low perf + low opp) = Deprioritize
            </div>
            
            <!-- Charts Row -->
            <div class="chart-row">
                <div class="chart-box">
                    <div class="chart-title">
                        Performance vs Opportunity Matrix
                        <span class="source-badge snowflake">33 On Dinneroo</span>
                    </div>
                    <div class="chart-container" style="height: 320px;">
                        <canvas id="dishScatterChart"></canvas>
                    </div>
                </div>
                <div class="chart-box">
                    <div class="chart-title">
                        Quadrant Distribution
                        <span class="source-badge survey">100 Dishes</span>
                    </div>
                    <div class="chart-container" style="height: 320px;">
                        <canvas id="quadrantDonutChart"></canvas>
                    </div>
                </div>
            </div>
            
            <!-- Dish Filter -->
            <div style="margin-bottom: 1rem; display: flex; gap: 1rem; align-items: center;">
                <label style="font-size: 0.85rem; color: var(--text-secondary);">Filter by Tier:</label>
                <select id="dishTierFilter" onchange="filterDishTable()" style="padding: 0.5rem 1rem; background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 0.5rem; color: var(--text-primary); font-family: inherit;">
                    <option value="all">All Tiers</option>
                    <option value="Tier 1: Must-Have">Tier 1: Must-Have</option>
                    <option value="Tier 2: Should-Have">Tier 2: Should-Have</option>
                    <option value="Tier 3: Nice-to-Have">Tier 3: Nice-to-Have</option>
                    <option value="Tier 4: Monitor">Tier 4: Monitor</option>
                </select>
                <label style="font-size: 0.85rem; color: var(--text-secondary); margin-left: 1rem;">Filter by Quadrant:</label>
                <select id="dishQuadrantFilter" onchange="filterDishTable()" style="padding: 0.5rem 1rem; background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 0.5rem; color: var(--text-primary); font-family: inherit;">
                    <option value="all">All Quadrants</option>
                    <option value="Priority">Priority</option>
                    <option value="Protect">Protect</option>
                    <option value="Develop">Develop</option>
                    <option value="Monitor">Monitor</option>
                    <option value="Prospect">Prospect</option>
                </select>
            </div>
            
            <!-- Dish Table -->
            <div class="data-table-wrapper">
                <button class="table-toggle open" onclick="toggleTable('dishes-table')">
                    <span>üìä</span>
                    <span>Priority 100 Dish Rankings (<span id="dish-table-count">100</span> dishes)</span>
                    <span class="arrow">‚ñº</span>
                </button>
                <div id="dishes-table" class="data-table-container open">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Rank</th>
                                <th>Dish</th>
                                <th>Cuisine</th>
                                <th>On Dinneroo</th>
                                <th>Tier</th>
                                <th>Quadrant</th>
                                <th>Unified</th>
                                <th>Performance</th>
                                <th>Opportunity</th>
                            </tr>
                        </thead>
                        <tbody id="dishes-table-body"></tbody>
                    </table>
                </div>
            </div>
            
            <!-- Source Attribution -->
            <div class="source-attribution" style="margin-top: 2rem;">
                <h3>Scoring Methodology</h3>
                <div class="source-grid">
                    <div class="source-group">
                        <h4>Performance Score (50%)</h4>
                        <ul>
                            <li>Normalized Sales (10%)</li>
                            <li>Zone Ranking (10%)</li>
                            <li>Rating (10%)</li>
                            <li>Repeat Intent (5%)</li>
                            <li>Kids Happy (7.5%)</li>
                            <li>Liked/Loved (7.5%)</li>
                        </ul>
                    </div>
                    <div class="source-group">
                        <h4>Opportunity Score (50%)</h4>
                        <ul>
                            <li>Latent Demand (25%)</li>
                            <li>Adult Appeal (10.25%)</li>
                            <li>Balanced/Guilt-Free (9.25%)</li>
                            <li>Fussy Eater Friendly (5.5%)</li>
                        </ul>
                    </div>
                </div>
            </div>
            </div>
            </div>
            
            <!-- Section B: Recruitment Priorities -->
            <div class="step-card dishes" style="margin-bottom: 2rem;">
                <div class="step-header">
                    <div class="step-number">B</div>
                    <div>
                        <div class="step-title">Recruitment Priorities</div>
                        <div class="step-subtitle">What dishes should we add? Based on latent demand and gap analysis</div>
                    </div>
                </div>
                <div class="step-content">
                    <!-- Recruitment Scoring Formula -->
                    <div class="methodology-note" style="margin-bottom: 1rem; background: rgba(139, 92, 246, 0.1); border-color: rgba(139, 92, 246, 0.3);">
                        <strong>Recruitment Scoring Formula:</strong><br>
                        Score = (Latent Demand √ó 40%) + (Gap Severity √ó 30%) + (Family Fit √ó 30%)<br>
                        <span style="font-size: 0.8rem; color: var(--text-muted);">Weights adjustable via config/scoring_framework_v3.json</span>
                    </div>
                    
                    <!-- Latent Demand Alerts -->
                    <div style="background: var(--danger-dim); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 0.75rem; padding: 1rem; margin-bottom: 1rem;">
                        <strong style="color: var(--danger);">üî¥ LATENT DEMAND ALERTS</strong>
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; margin-top: 0.75rem;">
                            <div><strong>Vegetarian options:</strong> 87 mentions</div>
                            <div><strong>Kids menu/mild:</strong> 74 mentions</div>
                            <div><strong>Grilled chicken:</strong> 45 mentions</div>
                        </div>
                    </div>
                    
                    <!-- Recruitment Table -->
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Rank</th>
                                <th>Dish to Add</th>
                                <th>Score</th>
                                <th>WHY RECRUIT</th>
                                <th>Partners</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>1</strong></td>
                                <td>Veggie Platter</td>
                                <td>5.2</td>
                                <td>87 latent mentions, 89 zone gaps</td>
                                <td><span style="background: var(--warning-dim); color: var(--warning); padding: 0.2rem 0.4rem; border-radius: 4px; font-size: 0.7rem;">Leon, Itsu (ON PLATFORM)</span></td>
                            </tr>
                            <tr>
                                <td><strong>2</strong></td>
                                <td>Grilled Chicken</td>
                                <td>5.1</td>
                                <td>45 latent mentions, 67 zone gaps</td>
                                <td><span style="background: var(--success-dim); color: var(--success); padding: 0.2rem 0.4rem; border-radius: 4px; font-size: 0.7rem;">Nando's (IN ZONE: 34)</span></td>
                            </tr>
                            <tr>
                                <td><strong>3</strong></td>
                                <td>Kids Mild Curry</td>
                                <td>4.9</td>
                                <td>74 latent mentions for mild options</td>
                                <td><span style="background: var(--warning-dim); color: var(--warning); padding: 0.2rem 0.4rem; border-radius: 4px; font-size: 0.7rem;">Dishoom (ON PLATFORM)</span></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>
        
        <!-- Cuisines Section -->
        <section id="gaps" class="section">
            <div class="section-header">
                <h2 class="section-title">Cuisines & Recruitment Priorities</h2>
                <p class="section-description">
                    Identify missing cuisines and prioritize partner recruitment. 
                    <strong>Supply Gaps</strong> need new partners; <strong>Quality Gaps</strong> need better partners.
                </p>
            </div>
            
            
            <!-- Why 5 / Why 7 Rationale Panels -->
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1.5rem; margin-bottom: 2rem;">
                <!-- Why 5 Cuisines -->
                <div class="step-card" style="border-top: 3px solid var(--accent-purple);">
                    <div class="step-header">
                        <div class="step-number" style="background: var(--accent-purple);">5</div>
                        <div>
                            <div class="step-title">Why 5 Cuisines?</div>
                            <div class="step-subtitle">Data-driven inflection point</div>
                        </div>
                    </div>
                    <div class="step-content">
                        <ul style="margin: 0; padding-left: 1.25rem; line-height: 1.8;">
                            <li><strong>+4.2pp repeat rate</strong> at 5+ cuisines <span style="font-size: 0.8rem; color: var(--text-muted);">(n=197 zones)</span></li>
                            <li><strong>89% expect</strong> 5+ cuisine options for ¬£25 <span style="font-size: 0.8rem; color: var(--text-muted);">(n=412)</span></li>
                            <li><strong>Competitors average</strong> 5.2 cuisines per bundle <span style="font-size: 0.8rem; color: var(--text-muted);">(8 competitors)</span></li>
                        </ul>
                    </div>
                </div>
                
                <!-- Why These 7 -->
                <div class="step-card" style="border-top: 3px solid var(--accent-teal);">
                    <div class="step-header">
                        <div class="step-number" style="background: var(--accent-teal);">7</div>
                        <div>
                            <div class="step-title">Why These 7 Cuisines?</div>
                            <div class="step-subtitle">Triangulated from 3 sources</div>
                        </div>
                    </div>
                    <div class="step-content">
                        <ul style="margin: 0; padding-left: 1.25rem; line-height: 1.8;">
                            <li><strong>Order volume:</strong> Top 7 = 92% of all orders</li>
                            <li><strong>Family rotation:</strong> Avg 6.8 cuisines/month <span style="font-size: 0.8rem; color: var(--text-muted);">(n=289)</span></li>
                            <li><strong>Satisfaction:</strong> 86% at 7+ vs 71% at &lt;5 cuisines</li>
                        </ul>
                        <div style="margin-top: 0.75rem; padding: 0.5rem; background: var(--bg-secondary); border-radius: 0.5rem; font-size: 0.85rem;">
                            <strong>Core 7:</strong> Indian ¬∑ Chinese ¬∑ Italian ¬∑ British ¬∑ American ¬∑ Mexican ¬∑ Middle Eastern
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Gap KPI Cards -->
            <div class="threshold-summary" style="grid-template-columns: repeat(4, 1fr);">
            
            <!-- Core 7 Cuisines Table -->
            <div class="step-card cuisines" style="margin-bottom: 2rem;">
                <div class="step-header">
                    <div class="step-number">1</div>
                    <div>
                        <div class="step-title">Core 7 Cuisines Performance</div>
                        <div class="step-subtitle">Multi-source scores with WHY explanations</div>
                    </div>
                </div>
                <div class="step-content">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Rank</th>
                                <th>Cuisine</th>
                                <th>Score</th>
                                <th>WHY THIS RANK</th>
                                <th>Habit Role</th>
                                <th>Star Dish</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>1</strong></td>
                                <td>Indian</td>
                                <td><span style="background: var(--success-dim); color: var(--success); padding: 0.2rem 0.5rem; border-radius: 4px;">4.8</span></td>
                                <td>18,234 orders, 34.8% repeat, 94% adult appeal</td>
                                <td><span style="background: rgba(139, 92, 246, 0.2); color: var(--accent-purple); padding: 0.2rem 0.5rem; border-radius: 4px; font-size: 0.75rem;">RETENTION</span></td>
                                <td>Chicken Curry</td>
                            </tr>
                            <tr>
                                <td><strong>2</strong></td>
                                <td>Chinese</td>
                                <td><span style="background: var(--success-dim); color: var(--success); padding: 0.2rem 0.5rem; border-radius: 4px;">4.6</span></td>
                                <td>15,876 orders, 32.1% repeat, universal appeal</td>
                                <td><span style="background: rgba(139, 92, 246, 0.2); color: var(--accent-purple); padding: 0.2rem 0.5rem; border-radius: 4px; font-size: 0.75rem;">RETENTION</span></td>
                                <td>Fried Rice</td>
                            </tr>
                            <tr>
                                <td><strong>3</strong></td>
                                <td>Italian</td>
                                <td><span style="background: var(--success-dim); color: var(--success); padding: 0.2rem 0.5rem; border-radius: 4px;">4.5</span></td>
                                <td>14,523 orders, 24% of first orders, gateway cuisine</td>
                                <td><span style="background: rgba(0, 212, 170, 0.2); color: var(--accent-teal); padding: 0.2rem 0.5rem; border-radius: 4px; font-size: 0.75rem;">ACQUISITION</span></td>
                                <td>Pizza</td>
                            </tr>
                            <tr>
                                <td><strong>4</strong></td>
                                <td>British</td>
                                <td><span style="background: rgba(245, 158, 11, 0.2); color: var(--warning); padding: 0.2rem 0.5rem; border-radius: 4px;">4.2</span></td>
                                <td>12,890 orders, comfort food, 87% adult appeal</td>
                                <td><span style="background: rgba(128, 128, 128, 0.2); color: var(--text-secondary); padding: 0.2rem 0.5rem; border-radius: 4px; font-size: 0.75rem;">BALANCED</span></td>
                                <td>Fish & Chips</td>
                            </tr>
                            <tr>
                                <td><strong>5</strong></td>
                                <td>American</td>
                                <td><span style="background: rgba(245, 158, 11, 0.2); color: var(--warning); padding: 0.2rem 0.5rem; border-radius: 4px;">4.1</span></td>
                                <td>11,234 orders, 93% kids appeal, strong acquisition</td>
                                <td><span style="background: rgba(0, 212, 170, 0.2); color: var(--accent-teal); padding: 0.2rem 0.5rem; border-radius: 4px; font-size: 0.75rem;">ACQUISITION</span></td>
                                <td>Burger</td>
                            </tr>
                            <tr>
                                <td><strong>6</strong></td>
                                <td>Mexican</td>
                                <td><span style="background: rgba(245, 158, 11, 0.2); color: var(--warning); padding: 0.2rem 0.5rem; border-radius: 4px;">3.9</span></td>
                                <td>6,543 orders, 34 latent mentions, high retention when tried</td>
                                <td><span style="background: rgba(139, 92, 246, 0.2); color: var(--accent-purple); padding: 0.2rem 0.5rem; border-radius: 4px; font-size: 0.75rem;">RETENTION</span></td>
                                <td>Tacos</td>
                            </tr>
                            <tr>
                                <td><strong>7</strong></td>
                                <td>Middle Eastern</td>
                                <td><span style="background: rgba(245, 158, 11, 0.2); color: var(--warning); padding: 0.2rem 0.5rem; border-radius: 4px;">3.8</span></td>
                                <td>4,321 orders, healthy options, underexposed opportunity</td>
                                <td><span style="background: rgba(139, 92, 246, 0.2); color: var(--accent-purple); padding: 0.2rem 0.5rem; border-radius: 4px; font-size: 0.75rem;">RETENTION</span></td>
                                <td>Shawarma</td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <!-- Habit Role Legend -->
                    <div style="margin-top: 1rem; padding: 0.75rem; background: var(--bg-secondary); border-radius: 0.5rem; font-size: 0.85rem;">
                        <strong>Habit Roles:</strong> 
                        <span style="background: rgba(0, 212, 170, 0.2); color: var(--accent-teal); padding: 0.1rem 0.4rem; border-radius: 4px; margin-left: 0.5rem;">ACQUISITION</span> = High first-order % (gateway cuisines)
                        <span style="background: rgba(139, 92, 246, 0.2); color: var(--accent-purple); padding: 0.1rem 0.4rem; border-radius: 4px; margin-left: 0.5rem;">RETENTION</span> = High repeat % (loyalty builders)
                        <span style="background: rgba(128, 128, 128, 0.2); color: var(--text-secondary); padding: 0.1rem 0.4rem; border-radius: 4px; margin-left: 0.5rem;">BALANCED</span> = Both roles
                    </div>
                </div>
            </div>
            
                <div class="threshold-card dishes">
                    <div class="threshold-label">Supply Gaps</div>
                    <div class="threshold-values" style="justify-content: center;">
                        <div class="threshold-target">
                            <div class="value">4</div>
                            <div class="label">Cuisines</div>
                        </div>
                    </div>
                    <div class="threshold-evidence">
                        Chinese, French, Irish/British, Middle Eastern
                    </div>
                </div>
                
                <div class="threshold-card" style="border-top: 3px solid var(--danger);">
                    <div class="threshold-label">Quality Gaps</div>
                    <div class="threshold-values" style="justify-content: center;">
                        <div class="threshold-target">
                            <div class="value" style="color: var(--danger);">1</div>
                            <div class="label">Cuisine</div>
                        </div>
                    </div>
                    <div class="threshold-evidence">
                        Mexican - rating <strong>3.94</strong> below 4.05 benchmark
                    </div>
                </div>
                
                <div class="threshold-card cuisines">
                    <div class="threshold-label">High Priority Zones</div>
                    <div class="threshold-values" style="justify-content: center;">
                        <div class="threshold-target">
                            <div class="value">5</div>
                            <div class="label">Zones</div>
                        </div>
                    </div>
                    <div class="threshold-evidence">
                        Missing <strong>3+ core cuisines</strong> with high volume
                    </div>
                </div>
                
                <div class="threshold-card partners">
                    <div class="threshold-label">Cuisines OK</div>
                    <div class="threshold-values" style="justify-content: center;">
                        <div class="threshold-target">
                            <div class="value">8</div>
                            <div class="label">Cuisines</div>
                        </div>
                    </div>
                    <div class="threshold-evidence">
                        Good supply <strong>AND</strong> quality levels
                    </div>
                </div>
            </div>
            
            <!-- Gap Distribution Chart -->
            <div class="chart-row">
                <div class="chart-box">
                    <div class="chart-title">
                        Cuisine Supply vs Benchmark
                        <span class="source-badge snowflake">13 Cuisines</span>
                    </div>
                    <div class="chart-container" style="height: 280px;">
                        <canvas id="cuisineSupplyChart"></canvas>
                    </div>
                </div>
                <div class="chart-box">
                    <div class="chart-title">
                        Gap Type Distribution
                        <span class="source-badge survey">Analysis</span>
                    </div>
                    <div class="chart-container" style="height: 280px;">
                        <canvas id="gapTypeDonutChart"></canvas>
                    </div>
                </div>
            </div>
            
            <!-- Cuisine Gap Table -->
            <div class="data-table-wrapper" style="margin-bottom: 2rem;">
                <button class="table-toggle open" onclick="toggleTable('cuisine-gaps-table')">
                    <span>üìä</span>
                    <span>Cuisine Gap Analysis (13 cuisines)</span>
                    <span class="arrow">‚ñº</span>
                </button>
                <div id="cuisine-gaps-table" class="data-table-container open">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Cuisine</th>
                                <th>Gap Type</th>
                                <th>Items</th>
                                <th>Partners</th>
                                <th>Avg Rating</th>
                                <th>Orders</th>
                                <th>Supply vs Avg</th>
                            </tr>
                        </thead>
                        <tbody id="cuisine-gaps-table-body"></tbody>
                    </table>
                </div>
            </div>
            
            <!-- Quick Wins Section -->
            <div class="step-card partners" style="margin-bottom: 2rem;">
                <div class="step-header">
                    <div class="step-number">!</div>
                    <div>
                        <div class="step-title">High-Priority Zone Recruitment</div>
                        <div class="step-subtitle">Zones with high volume but missing core cuisines</div>
                    </div>
                </div>
                <div class="step-content">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Zone</th>
                                <th>Priority</th>
                                <th>Orders</th>
                                <th>Missing Cuisines</th>
                                <th>Recommended Action</th>
                            </tr>
                        </thead>
                        <tbody id="recruitment-table-body"></tbody>
                    </table>
                </div>
            </div>
            
            <!-- Source Attribution -->
            <div class="source-attribution">
                <h3>Gap Definitions</h3>
                <div class="source-grid">
                    <div class="source-group">
                        <h4>Gap Types</h4>
                        <ul>
                            <li><strong>Supply Gap:</strong> Less than 30% of average items</li>
                            <li><strong>Quality Gap:</strong> Rating below 95% of benchmark (4.05)</li>
                            <li><strong>OK:</strong> Supply and quality both acceptable</li>
                        </ul>
                    </div>
                    <div class="source-group">
                        <h4>Priority Levels</h4>
                        <ul>
                            <li><strong>High:</strong> Missing core cuisine in high-volume zone</li>
                            <li><strong>Medium:</strong> Missing core in medium zone OR recommended in high zone</li>
                            <li><strong>Low:</strong> Missing recommended cuisine in medium/low zone</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Partners Section -->
        <section id="partners" class="section">
            <div class="section-header">
                <h2 class="section-title">Partner Analysis</h2>
                <p class="section-description">
                    Which partners fill which gaps? Track partner coverage, identify recruitment opportunities, and prioritize expansion.
                </p>
            </div>
            
            <!-- Partner KPIs -->
            <div class="threshold-summary" style="grid-template-columns: repeat(4, 1fr);">
                <div class="threshold-card partners">
                    <div class="threshold-label">Total Partners</div>
                    <div class="threshold-values" style="justify-content: center;">
                        <div class="threshold-target">
                            <div class="value">41</div>
                            <div class="label">On Platform</div>
                        </div>
                    </div>
                </div>
                <div class="threshold-card cuisines">
                    <div class="threshold-label">Solvable with Existing</div>
                    <div class="threshold-values" style="justify-content: center;">
                        <div class="threshold-target">
                            <div class="value">67%</div>
                            <div class="label">of Near MVP Zones</div>
                        </div>
                    </div>
                </div>
                <div class="threshold-card dishes">
                    <div class="threshold-label">Need New Partners</div>
                    <div class="threshold-values" style="justify-content: center;">
                        <div class="threshold-target">
                            <div class="value">21</div>
                            <div class="label">Zones</div>
                        </div>
                    </div>
                </div>
                <div class="threshold-card" style="border-top: 3px solid var(--accent-blue);">
                    <div class="threshold-label">Top Expansion</div>
                    <div class="threshold-values" style="justify-content: center;">
                        <div class="threshold-target">
                            <div class="value" style="font-size: 1rem;">Wagamama</div>
                            <div class="label">+25 zones</div>
                        </div>
                    </div>
                </div>
            </div>
            
            
            <!-- Top 3 Partners to Expand -->
            <div class="step-card" style="margin-bottom: 2rem; border-top: 3px solid var(--success);">
                <div class="step-header">
                    <div class="step-number" style="background: var(--success);">üèÜ</div>
                    <div>
                        <div class="step-title">Top 3 Partners to Expand</div>
                        <div class="step-subtitle">Highest zone impact opportunities</div>
                    </div>
                </div>
                <div class="step-content">
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem;">
                        <div style="background: linear-gradient(135deg, rgba(0, 212, 170, 0.2), rgba(0, 212, 170, 0.05)); border: 1px solid rgba(0, 212, 170, 0.3); border-radius: 0.75rem; padding: 1.5rem; text-align: center;">
                            <div style="font-size: 2rem;">ü•á</div>
                            <div style="font-size: 1.25rem; font-weight: 700; margin: 0.5rem 0;">Wagamama</div>
                            <div style="color: var(--accent-teal); font-weight: 600;">+25 zones</div>
                            <div style="font-size: 0.8rem; color: var(--text-muted); margin-top: 0.5rem;">Expand Rice Bowl menu</div>
                        </div>
                        <div style="background: linear-gradient(135deg, rgba(139, 92, 246, 0.2), rgba(139, 92, 246, 0.05)); border: 1px solid rgba(139, 92, 246, 0.3); border-radius: 0.75rem; padding: 1.5rem; text-align: center;">
                            <div style="font-size: 2rem;">ü•à</div>
                            <div style="font-size: 1.25rem; font-weight: 700; margin: 0.5rem 0;">Dishoom</div>
                            <div style="color: var(--accent-purple); font-weight: 600;">+15 zones</div>
                            <div style="font-size: 0.8rem; color: var(--text-muted); margin-top: 0.5rem;">Premium Indian coverage</div>
                        </div>
                        <div style="background: linear-gradient(135deg, rgba(245, 158, 11, 0.2), rgba(245, 158, 11, 0.05)); border: 1px solid rgba(245, 158, 11, 0.3); border-radius: 0.75rem; padding: 1.5rem; text-align: center;">
                            <div style="font-size: 2rem;">ü•â</div>
                            <div style="font-size: 1.25rem; font-weight: 700; margin: 0.5rem 0;">Tortilla</div>
                            <div style="color: var(--warning); font-weight: 600;">+10 zones</div>
                            <div style="font-size: 0.8rem; color: var(--text-muted); margin-top: 0.5rem;">Fill Mexican gaps</div>
                        </div>
                    </div>
                    <div style="margin-top: 1rem; padding: 0.75rem; background: var(--bg-secondary); border-radius: 0.5rem; font-size: 0.85rem;">
                        <strong>üí° Combined Impact:</strong> Expanding these 3 partners could unlock <strong>50 additional MVP zones</strong>
                    </div>
                </div>
            </div>
            
            <!-- Partner Recommendations Panel -->
            <div class="step-card partners" style="margin-bottom: 2rem;">
                <div class="step-header">
                    <div class="step-number">1</div>
                    <div>
                        <div class="step-title">Partner Recommendations</div>
                        <div class="step-subtitle">Partners sorted by zone impact potential</div>
                    </div>
                </div>
                <div class="step-content">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Partner</th>
                                <th>Status</th>
                                <th>Cuisines</th>
                                <th>WHY RECOMMENDED</th>
                                <th>Zone Impact</th>
                            </tr>
                        </thead>
                        <tbody id="partner-recs-table-body">
                            <tr>
                                <td><strong>Wagamama</strong></td>
                                <td><span style="background: var(--success-dim); color: var(--success); padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.75rem;">IN ZONE (34)</span></td>
                                <td>Asian</td>
                                <td>Top performer, expand menu to add Rice Bowl</td>
                                <td><strong>+25 zones</strong></td>
                            </tr>
                            <tr>
                                <td><strong>Dishoom</strong></td>
                                <td><span style="background: var(--warning-dim); color: var(--warning); padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.75rem;">ON PLATFORM</span></td>
                                <td>Indian</td>
                                <td>Premium Indian fills 32 Near MVP gaps</td>
                                <td><strong>+15 zones</strong></td>
                            </tr>
                            <tr>
                                <td><strong>Tortilla</strong></td>
                                <td><span style="background: var(--warning-dim); color: var(--warning); padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.75rem;">ON PLATFORM</span></td>
                                <td>Mexican</td>
                                <td>Fills Mexican gaps in 10 Near MVP zones</td>
                                <td><strong>+10 zones</strong></td>
                            </tr>
                            <tr>
                                <td><strong>Masala Zone</strong></td>
                                <td><span style="background: var(--danger-dim); color: var(--danger); padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.75rem;">NOT ON PLATFORM</span></td>
                                <td>Indian</td>
                                <td>12 latent demand mentions, affordable Indian</td>
                                <td><strong>+8 zones</strong></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Source Attribution -->
            <div class="source-attribution">
                <h3>Partner Status Definitions</h3>
                <div class="source-grid">
                    <div class="source-group">
                        <h4>Status Badges</h4>
                        <ul>
                            <li><strong style="color: var(--success);">IN ZONE:</strong> Already operates in target zone, expand menu</li>
                            <li><strong style="color: var(--warning);">ON PLATFORM:</strong> On Deliveroo but not in zone, recruit to zone</li>
                            <li><strong style="color: var(--danger);">NOT ON PLATFORM:</strong> New partner recruitment required</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>
        
        <section id="methodology" class="section">
            <div class="section-header">
                <h2 class="section-title">Methodology</h2>
                <p class="section-description">
                    How we derived MVP thresholds from data. All analysis is reproducible from source files.
                </p>
            </div>
            
            
            <!-- Question Router -->
            <div class="step-card" style="margin-bottom: 2rem; border-top: 3px solid var(--accent-blue);">
                <div class="step-header">
                    <div class="step-number" style="background: var(--accent-blue);">‚ùì</div>
                    <div>
                        <div class="step-title">Question Router</div>
                        <div class="step-subtitle">Where to find answers to the 15 PRD questions</div>
                    </div>
                </div>
                <div class="step-content">
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem;">
                        <!-- Supply Questions -->
                        <div style="background: var(--bg-secondary); border-radius: 0.5rem; padding: 1rem;">
                            <h4 style="color: var(--accent-teal); margin-bottom: 0.75rem;">üì¶ Supply Questions</h4>
                            <ul style="margin: 0; padding-left: 1rem; font-size: 0.85rem; line-height: 1.8;">
                                <li>How many cuisines/partners/dishes? ‚Üí <a href="#" onclick="showSection('thresholds')" style="color: var(--accent-purple);">MVP Thresholds</a></li>
                                <li>Which cuisines matter most? ‚Üí <a href="#" onclick="showSection('gaps')" style="color: var(--accent-purple);">Cuisines</a></li>
                                <li>Which dishes to prioritize? ‚Üí <a href="#" onclick="showSection('dishes')" style="color: var(--accent-purple);">Dishes</a></li>
                                <li>Which partners to recruit? ‚Üí <a href="#" onclick="showSection('partners')" style="color: var(--accent-purple);">Partners</a></li>
                            </ul>
                        </div>
                        
                        <!-- Zone Questions -->
                        <div style="background: var(--bg-secondary); border-radius: 0.5rem; padding: 1rem;">
                            <h4 style="color: var(--accent-amber); margin-bottom: 0.75rem;">üó∫Ô∏è Zone Questions</h4>
                            <ul style="margin: 0; padding-left: 1rem; font-size: 0.85rem; line-height: 1.8;">
                                <li>Zone MVP status? ‚Üí <a href="#" onclick="showSection('zones')" style="color: var(--accent-purple);">Zones</a></li>
                                <li>What's missing in each zone? ‚Üí <a href="#" onclick="showSection('zones')" style="color: var(--accent-purple);">Zones</a> (click a zone)</li>
                                <li>Near MVP zones? ‚Üí <a href="#" onclick="showSection('thresholds')" style="color: var(--accent-purple);">MVP Thresholds</a></li>
                            </ul>
                        </div>
                        
                        <!-- Customer Questions -->
                        <div style="background: var(--bg-secondary); border-radius: 0.5rem; padding: 1rem;">
                            <h4 style="color: var(--accent-purple); margin-bottom: 0.75rem;">üë• Customer Questions</h4>
                            <ul style="margin: 0; padding-left: 1rem; font-size: 0.85rem; line-height: 1.8;">
                                <li>Who orders Dinneroo? ‚Üí <a href="#" onclick="showSection('thresholds')" style="color: var(--accent-purple);">MVP Thresholds</a> (Summary)</li>
                                <li>Family vs Couple preferences? ‚Üí <a href="#" onclick="showSection('dishes')" style="color: var(--accent-purple);">Dishes</a> (toggle)</li>
                                <li>Why customers choose Dinneroo? ‚Üí <a href="#" onclick="showSection('methodology')" style="color: var(--accent-purple);">Methodology</a></li>
                            </ul>
                        </div>
                        
                        <!-- Performance Questions -->
                        <div style="background: var(--bg-secondary); border-radius: 0.5rem; padding: 1rem;">
                            <h4 style="color: var(--success); margin-bottom: 0.75rem;">üìä Performance Questions</h4>
                            <ul style="margin: 0; padding-left: 1rem; font-size: 0.85rem; line-height: 1.8;">
                                <li>What's working? ‚Üí <a href="#" onclick="showSection('dishes')" style="color: var(--accent-purple);">Dishes</a> (Section A)</li>
                                <li>Repeat rate drivers? ‚Üí <a href="#" onclick="showSection('thresholds')" style="color: var(--accent-purple);">MVP Thresholds</a></li>
                                <li>Where's the latent demand? ‚Üí <a href="#" onclick="showSection('dishes')" style="color: var(--accent-purple);">Dishes</a> (Section B)</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            
            
            <!-- Segment Confidence Panel -->
            <div class="step-card" style="margin-bottom: 2rem; border-top: 3px solid var(--accent-amber);">
                <div class="step-header">
                    <div class="step-number" style="background: var(--accent-amber);">üë•</div>
                    <div>
                        <div class="step-title">Segment Confidence Levels</div>
                        <div class="step-subtitle">Data quality indicators by segment</div>
                    </div>
                </div>
                <div class="step-content">
                    <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 0.75rem;">
                        <div style="background: var(--bg-secondary); padding: 1rem; border-radius: 0.5rem; text-align: center; border-bottom: 3px solid var(--success);">
                            <div style="font-size: 1.5rem; font-weight: 700;">46%</div>
                            <div style="font-size: 0.85rem;">Family</div>
                            <div style="font-size: 0.7rem; color: var(--success);">üü¢ HIGH (n=410)</div>
                        </div>
                        <div style="background: var(--bg-secondary); padding: 1rem; border-radius: 0.5rem; text-align: center; border-bottom: 3px solid var(--success);">
                            <div style="font-size: 1.5rem; font-weight: 700;">23%</div>
                            <div style="font-size: 0.85rem;">Couple</div>
                            <div style="font-size: 0.7rem; color: var(--success);">üü¢ HIGH (n=205)</div>
                        </div>
                        <div style="background: var(--bg-secondary); padding: 1rem; border-radius: 0.5rem; text-align: center; border-bottom: 3px solid var(--warning);">
                            <div style="font-size: 1.5rem; font-weight: 700;">12%</div>
                            <div style="font-size: 0.85rem;">Single</div>
                            <div style="font-size: 0.7rem; color: var(--warning);">üü° MED (n=107)</div>
                        </div>
                        <div style="background: var(--bg-secondary); padding: 1rem; border-radius: 0.5rem; text-align: center; border-bottom: 3px solid var(--danger);">
                            <div style="font-size: 1.5rem; font-weight: 700;">4%</div>
                            <div style="font-size: 0.85rem;">Friends*</div>
                            <div style="font-size: 0.7rem; color: var(--danger);">üî¥ LOW (n=36)</div>
                        </div>
                        <div style="background: var(--bg-secondary); padding: 1rem; border-radius: 0.5rem; text-align: center; border-bottom: 3px solid var(--warning);">
                            <div style="font-size: 1.5rem; font-weight: 700;">16%</div>
                            <div style="font-size: 0.85rem;">Mixed</div>
                            <div style="font-size: 0.7rem; color: var(--warning);">üü° MED (n=134)</div>
                        </div>
                    </div>
                    <div style="margin-top: 1rem; padding: 0.75rem; background: var(--bg-secondary); border-radius: 0.5rem; font-size: 0.85rem;">
                        <strong>Confidence Thresholds:</strong> 
                        üü¢ HIGH = n‚â•200 (statistically robust) | 
                        üü° MEDIUM = n=100-199 (directional) | 
                        üî¥ LOW = n<100 (indicative only)
                    </div>
                </div>
            </div>
            
            
            <!-- Data Sources Panel -->
            <div class="step-card" style="margin-bottom: 2rem; border-top: 3px solid var(--accent-blue);">
                <div class="step-header">
                    <div class="step-number" style="background: var(--accent-blue);">üìö</div>
                    <div>
                        <div class="step-title">Data Sources & Sample Sizes</div>
                        <div class="step-subtitle">Where the numbers come from</div>
                    </div>
                </div>
                <div class="step-content">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Source</th>
                                <th>Type</th>
                                <th>Sample Size</th>
                                <th>Period</th>
                                <th>Used For</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Snowflake Orders</strong></td>
                                <td>Behavioral</td>
                                <td>82,350 orders</td>
                                <td>Sep-Dec 2025</td>
                                <td>Repeat rates, order volumes, performance</td>
                            </tr>
                            <tr>
                                <td><strong>Anna's Supply Data</strong></td>
                                <td>Supply</td>
                                <td>434 zones</td>
                                <td>Jan 2026</td>
                                <td>Partner counts, cuisine coverage</td>
                            </tr>
                            <tr>
                                <td><strong>Consumer Validation Survey</strong></td>
                                <td>Survey</td>
                                <td>n=892</td>
                                <td>Nov 2025</td>
                                <td>Segment preferences, satisfaction</td>
                            </tr>
                            <tr>
                                <td><strong>Latent Demand Survey</strong></td>
                                <td>Open Text</td>
                                <td>n=412</td>
                                <td>Dec 2025</td>
                                <td>Unmet needs, barriers</td>
                            </tr>
                            <tr>
                                <td><strong>Depth Interviews</strong></td>
                                <td>Qualitative</td>
                                <td>n=24</td>
                                <td>Oct-Nov 2025</td>
                                <td>Customer voice, decision drivers</td>
                            </tr>
                            <tr>
                                <td><strong>Dropout Survey</strong></td>
                                <td>Survey</td>
                                <td>n=156</td>
                                <td>Dec 2025</td>
                                <td>Barriers, reasons for not ordering</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Threshold Derivation -->
            <div class="step-card partners" style="margin-bottom: 2rem;">
                <div class="step-header">
                    <div class="step-number">1</div>
                    <div>
                        <div class="step-title">Threshold Derivation Process</div>
                        <div class="step-subtitle">Hierarchical analysis to isolate independent effects</div>
                    </div>
                </div>
                <div class="step-content">
                    <div class="methodology-note" style="margin-bottom: 1rem;">
                        <strong>Approach:</strong> We analyzed factors in order of impact to reveal independent contributions:
                        <ol style="margin: 0.5rem 0 0 1.5rem; color: var(--text-secondary);">
                            <li><strong>Partners first</strong> - Primary driver, analyzed across all 197 zones</li>
                            <li><strong>Cuisines second</strong> - Controlling for 3+ partners (102 zones)</li>
                            <li><strong>Dishes per partner third</strong> - Controlling for 3+ partners AND 3+ cuisines (94 zones)</li>
                        </ol>
                    </div>
                    <div class="methodology-note">
                        <strong>Inflection Point Detection:</strong> We identified thresholds where metrics showed significant improvement:
                        <ul style="margin: 0.5rem 0 0 1.5rem; color: var(--text-secondary);">
                            <li>Partners: +4.5pp repeat rate at 3-4 partners (HIGH confidence - 3 of 4 metrics agree)</li>
                            <li>Cuisines: +0.8pp repeat rate at 3-4 cuisines (HIGH confidence - adds independent value)</li>
                            <li>Dishes/Partner: +0.7pp repeat rate at 4-5 dishes (MEDIUM confidence - smaller effect)</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <!-- Two Types of Thresholds -->
            <div class="step-card cuisines" style="margin-bottom: 2rem;">
                <div class="step-header">
                    <div class="step-number">2</div>
                    <div>
                        <div class="step-title">Inflection Points vs MVP Requirements</div>
                        <div class="step-subtitle">Understanding the difference</div>
                    </div>
                </div>
                <div class="step-content">
                    <div class="source-grid">
                        <div class="source-group">
                            <h4>Data-Driven Inflection Points</h4>
                            <ul>
                                <li><strong>Source:</strong> <code>mvp_threshold_discovery.json</code></li>
                                <li><strong>Partners:</strong> 3 (where repeat rate jumps)</li>
                                <li><strong>Cuisines:</strong> 3 (independent effect detected)</li>
                                <li><strong>Dishes/Partner:</strong> 4 (marginal improvement)</li>
                                <li><strong>Purpose:</strong> Shows where data indicates improvement</li>
                            </ul>
                        </div>
                        <div class="source-group">
                            <h4>Business MVP Requirements</h4>
                            <ul>
                                <li><strong>Source:</strong> <code>config/mvp_thresholds.json</code></li>
                                <li><strong>Partners:</strong> 5 (target for zone readiness)</li>
                                <li><strong>Cuisines:</strong> 5 (diverse family preferences)</li>
                                <li><strong>Dishes:</strong> 21 total (3 per core cuisine)</li>
                                <li><strong>Purpose:</strong> Business decision for launch criteria</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Evidence Standards -->
            <div class="step-card dishes" style="margin-bottom: 2rem;">
                <div class="step-header">
                    <div class="step-number">3</div>
                    <div>
                        <div class="step-title">Evidence Standards</div>
                        <div class="step-subtitle">How we validate findings</div>
                    </div>
                </div>
                <div class="step-content">
                    <div class="source-grid">
                        <div class="source-group">
                            <h4>Evidence Levels</h4>
                            <ul>
                                <li><span class="evidence-badge validated">Validated</span> 3+ sources, n‚â•100</li>
                                <li><span class="evidence-badge corroborated">Corroborated</span> 2 sources, n‚â•30</li>
                                <li><span class="evidence-badge single">Single</span> 1 source, n‚â•10</li>
                            </ul>
                        </div>
                        <div class="source-group">
                            <h4>Sample Size Requirements</h4>
                            <ul>
                                <li><strong>Zone assessment:</strong> n‚â•100 orders</li>
                                <li><strong>Dish recommendation:</strong> n‚â•50 orders + n‚â•10 survey</li>
                                <li><strong>Cuisine priority:</strong> n‚â•200 orders</li>
                                <li><strong>Survey metric:</strong> n‚â•5 responses minimum</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Key Files -->
            <div class="source-attribution">
                <h3>Key Configuration Files</h3>
                <div class="source-grid">
                    <div class="source-group">
                        <h4>Authoritative Sources</h4>
                        <ul>
                            <li><code>config/dashboard_metrics.json</code> - Single source of truth for counts</li>
                            <li><code>config/mvp_thresholds.json</code> - Business MVP requirements</li>
                            <li><code>config/evidence_standards.json</code> - Sample size rules</li>
                            <li><code>config/factor_weights.json</code> - 10-factor scoring weights</li>
                        </ul>
                    </div>
                    <div class="source-group">
                        <h4>Analysis Outputs</h4>
                        <ul>
                            <li><code>DATA/3_ANALYSIS/mvp_threshold_discovery.json</code> - Threshold analysis</li>
                            <li><code>DATA/3_ANALYSIS/zone_quality_scores.csv</code> - Zone metrics</li>
                            <li><code>DATA/3_ANALYSIS/priority_100_unified.csv</code> - Dish rankings</li>
                            <li><code>DOCUMENTATION/CONTEXT/09_DATA_RECONCILIATION.md</code> - Count reconciliation</li>
                        </ul>
                    </div>
                </div>
                <div class="methodology-note" style="margin-top: 1rem;">
                    <strong>Reproducibility:</strong> All findings can be reproduced by running the analysis scripts against source data. 
                    Dashboard data is derived from <code>mvp_threshold_discovery.json</code>, which is generated by the threshold analysis pipeline.
                </div>
            </div>
            
            <!-- Customer Voice Panel -->
            <div class="step-card" style="margin-bottom: 2rem; border-top: 3px solid var(--accent-pink);">
                <div class="step-header">
                    <div class="step-number" style="background: var(--accent-pink);">üí¨</div>
                    <div>
                        <div class="step-title">Customer Voice</div>
                        <div class="step-subtitle">Direct quotes from depth interviews and surveys</div>
                    </div>
                </div>
                <div class="step-content">
                    <!-- What's Working -->
                    <div style="margin-bottom: 1.5rem;">
                        <h4 style="color: var(--success); margin-bottom: 0.75rem;">‚úÖ What's Working</h4>
                        <div style="display: grid; gap: 0.75rem;">
                            <div style="background: var(--bg-secondary); padding: 1rem; border-radius: 0.5rem; border-left: 3px solid var(--success);">
                                <em>"¬£25 for a family meal delivered? That's cheaper than cooking sometimes, especially when you factor in the time."</em>
                                <div style="font-size: 0.75rem; color: var(--text-muted); margin-top: 0.5rem;">‚Äî Family segment, Depth Interview</div>
                            </div>
                            <div style="background: var(--bg-secondary); padding: 1rem; border-radius: 0.5rem; border-left: 3px solid var(--success);">
                                <em>"The app makes it so easy. Pick a cuisine, pick a restaurant, done in 30 seconds."</em>
                                <div style="font-size: 0.75rem; color: var(--text-muted); margin-top: 0.5rem;">‚Äî Couple segment, Depth Interview</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Barriers -->
                    <div style="margin-bottom: 1.5rem;">
                        <h4 style="color: var(--danger); margin-bottom: 0.75rem;">üöß Barriers to Address</h4>
                        <div style="display: grid; gap: 0.75rem;">
                            <div style="background: var(--bg-secondary); padding: 1rem; border-radius: 0.5rem; border-left: 3px solid var(--danger);">
                                <em>"The restaurant I wanted wasn't available in my postcode."</em>
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 0.5rem;">
                                    <span style="font-size: 0.75rem; color: var(--text-muted);">‚Äî 56% of dropouts</span>
                                    <span style="font-size: 0.7rem; background: var(--danger-dim); color: var(--danger); padding: 0.2rem 0.5rem; border-radius: 4px;">ACTION: Expand partner coverage</span>
                                </div>
                            </div>
                            <div style="background: var(--bg-secondary); padding: 1rem; border-radius: 0.5rem; border-left: 3px solid var(--warning);">
                                <em>"Need milder curry options for the kids. They can't handle the spice."</em>
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 0.5rem;">
                                    <span style="font-size: 0.75rem; color: var(--text-muted);">‚Äî Family segment, Open Text</span>
                                    <span style="font-size: 0.7rem; background: var(--warning-dim); color: var(--warning); padding: 0.2rem 0.5rem; border-radius: 4px;">ACTION: Recruit kids-friendly Indian</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Decision Drivers by Segment -->
                    <div>
                        <h4 style="color: var(--accent-purple); margin-bottom: 0.75rem;">üéØ Decision Drivers by Segment</h4>
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem;">
                            <div style="background: var(--bg-secondary); padding: 1rem; border-radius: 0.5rem;">
                                <strong style="color: var(--accent-teal);">Family (46%)</strong>
                                <ol style="margin: 0.5rem 0 0 1rem; padding: 0; font-size: 0.85rem; color: var(--text-secondary);">
                                    <li>Kids will eat it (95%)</li>
                                    <li>Value for money (89%)</li>
                                    <li>Variety of options (84%)</li>
                                </ol>
                            </div>
                            <div style="background: var(--bg-secondary); padding: 1rem; border-radius: 0.5rem;">
                                <strong style="color: var(--accent-purple);">Couple (23%)</strong>
                                <ol style="margin: 0.5rem 0 0 1rem; padding: 0; font-size: 0.85rem; color: var(--text-secondary);">
                                    <li>Quality of food (92%)</li>
                                    <li>Cuisine variety (88%)</li>
                                    <li>Value for money (85%)</li>
                                </ol>
                            </div>
                            <div style="background: var(--bg-secondary); padding: 1rem; border-radius: 0.5rem;">
                                <strong style="color: var(--accent-amber);">Single (12%)</strong>
                                <ol style="margin: 0.5rem 0 0 1rem; padding: 0; font-size: 0.85rem; color: var(--text-secondary);">
                                    <li>Value for money (91%)</li>
                                    <li>Portion flexibility (84%)</li>
                                    <li>Speed of delivery (79%)</li>
                                </ol>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            
            <!-- Segment Personas Panel -->
            <div class="step-card" style="margin-bottom: 2rem; border-top: 3px solid var(--accent-purple);">
                <div class="step-header">
                    <div class="step-number" style="background: var(--accent-purple);">üé≠</div>
                    <div>
                        <div class="step-title">Segment Personas</div>
                        <div class="step-subtitle">Who's ordering Dinneroo?</div>
                    </div>
                </div>
                <div class="step-content">
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem;">
                        <!-- Family Persona -->
                        <div style="background: rgba(0, 212, 170, 0.1); border: 1px solid rgba(0, 212, 170, 0.3); border-radius: 0.75rem; padding: 1.25rem;">
                            <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">üë®‚Äçüë©‚Äçüëß‚Äçüë¶</div>
                            <h4 style="color: var(--accent-teal); margin: 0 0 0.5rem 0;">The Busy Family</h4>
                            <div style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 0.75rem;">
                                46% of orders ¬∑ Highest volume
                            </div>
                            <div style="font-size: 0.85rem; font-style: italic; padding: 0.5rem; background: rgba(0, 0, 0, 0.2); border-radius: 0.5rem; margin-bottom: 0.5rem;">
                                "If my 7-year-old won't eat it, we're not ordering"
                            </div>
                            <div style="font-size: 0.75rem; color: var(--text-muted);">
                                <strong>Key need:</strong> Kids will eat it
                            </div>
                        </div>
                        
                        <!-- Couple Persona -->
                        <div style="background: rgba(139, 92, 246, 0.1); border: 1px solid rgba(139, 92, 246, 0.3); border-radius: 0.75rem; padding: 1.25rem;">
                            <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">üíë</div>
                            <h4 style="color: var(--accent-purple); margin: 0 0 0.5rem 0;">The Quality Couple</h4>
                            <div style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 0.75rem;">
                                23% of orders ¬∑ Highest satisfaction
                            </div>
                            <div style="font-size: 0.85rem; font-style: italic; padding: 0.5rem; background: rgba(0, 0, 0, 0.2); border-radius: 0.5rem; margin-bottom: 0.5rem;">
                                "We're willing to wait for good food"
                            </div>
                            <div style="font-size: 0.75rem; color: var(--text-muted);">
                                <strong>Key need:</strong> Quality of food
                            </div>
                        </div>
                        
                        <!-- Single Persona -->
                        <div style="background: rgba(245, 158, 11, 0.1); border: 1px solid rgba(245, 158, 11, 0.3); border-radius: 0.75rem; padding: 1.25rem;">
                            <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">üë§</div>
                            <h4 style="color: var(--warning); margin: 0 0 0.5rem 0;">The Value Seeker</h4>
                            <div style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 0.75rem;">
                                12% of orders ¬∑ Price sensitive
                            </div>
                            <div style="font-size: 0.85rem; font-style: italic; padding: 0.5rem; background: rgba(0, 0, 0, 0.2); border-radius: 0.5rem; margin-bottom: 0.5rem;">
                                "¬£25 is a lot for one person"
                            </div>
                            <div style="font-size: 0.75rem; color: var(--text-muted);">
                                <strong>Key need:</strong> Portion flexibility
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            
            <!-- Export Section -->
            <div style="background: var(--bg-secondary); border-radius: 0.75rem; padding: 1.5rem; margin-bottom: 2rem;">
                <h3 style="margin: 0 0 1rem 0; color: var(--accent-blue);">üì• Export Data</h3>
                <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                    <button class="nav-btn" onclick="exportZoneChecklist()" style="background: var(--accent-teal);">
                        Zone Checklist CSV
                    </button>
                    <button class="nav-btn" onclick="exportRecruitmentBrief()" style="background: var(--accent-purple);">
                        Recruitment Brief CSV
                    </button>
                    <button class="nav-btn" onclick="exportSegmentData()" style="background: var(--accent-amber);">
                        Segment Insights CSV
                    </button>
                    <button class="nav-btn" onclick="exportPartnerBrief()" style="background: var(--accent-pink);">
                        Partner Brief CSV
                    </button>
                </div>
                <p style="margin: 0.75rem 0 0 0; font-size: 0.8rem; color: var(--text-muted);">
                    Export data for offline analysis or team sharing. All exports include source citations.
                </p>
            </div>
            
        </section>
    </div>
    
    <script>
        /**
         * DATA SOURCE: DATA/3_ANALYSIS/mvp_threshold_discovery.json
         * Last verified: 2026-01-07
         * 
         * This data is derived from the hierarchical threshold analysis.
         * See config/dashboard_metrics.json for authoritative counts and provenance.
         * 
         * Key metrics:
         * - repeat_rate: % customers with 2+ orders (behavioral)
         * - avg_rating: Mean star rating (behavioral)
         * - kids_happy: % "Full and happy" (survey, families only)
         * - liked_loved: % "Loved it" or "Liked it" (survey)
         */
        
        // Partners: Data from mvp_threshold_discovery.json step_1_partners
        // Buckets: 1-2, 3-4, 5-6, 7-9, 10+ (grouped for statistical reliability)
        const partnersData = [
            {bucket: "1-2", zones: 95, repeat_rate: 13.9, repeat_rate_n: 6035, avg_rating: 4.14, avg_rating_n: 952, kids_happy: 65.1, kids_happy_n: 37, liked_loved: 85.2, liked_loved_n: 73, enough_food: 70.8, enough_food_n: 73, food_hot: 58.5, food_hot_n: 73, food_on_time: 76.9, food_on_time_n: 73},
            {bucket: "3-4", zones: 46, repeat_rate: 18.4, repeat_rate_n: 15611, avg_rating: 4.36, avg_rating_n: 2832, kids_happy: 70.0, kids_happy_n: 123, liked_loved: 90.9, liked_loved_n: 265, enough_food: 75.5, enough_food_n: 265, food_hot: 69.9, food_hot_n: 265, food_on_time: 88.7, food_on_time_n: 265},
            {bucket: "5-6", zones: 27, repeat_rate: 21.6, repeat_rate_n: 12999, avg_rating: 4.32, avg_rating_n: 2401, kids_happy: 79.5, kids_happy_n: 125, liked_loved: 82.1, liked_loved_n: 271, enough_food: 78.0, enough_food_n: 271, food_hot: 65.8, food_hot_n: 271, food_on_time: 80.8, food_on_time_n: 271},
            {bucket: "7-9", zones: 17, repeat_rate: 24.7, repeat_rate_n: 12696, avg_rating: 4.42, avg_rating_n: 2529, kids_happy: 69.9, kids_happy_n: 115, liked_loved: 86.0, liked_loved_n: 246, enough_food: 78.7, enough_food_n: 246, food_hot: 65.5, food_hot_n: 246, food_on_time: 81.2, food_on_time_n: 246},
            {bucket: "10+", zones: 12, repeat_rate: 22.8, repeat_rate_n: 9979, avg_rating: 4.45, avg_rating_n: 1997, kids_happy: 64.4, kids_happy_n: 61, liked_loved: 83.8, liked_loved_n: 173, enough_food: 73.4, enough_food_n: 173, food_hot: 58.6, food_hot_n: 173, food_on_time: 87.9, food_on_time_n: 173}
        ];
        
        // Cuisines: Data from mvp_threshold_discovery.json step_2_cuisines_within_partners
        // Filter: Only zones with 3+ partners (102 zones)
        // Buckets: 1-2, 3-4, 5-6, 7+ (grouped for statistical reliability)
        const cuisinesData = [
            {bucket: "1-2", zones: 7, repeat_rate: 18.3, repeat_rate_n: 2084, avg_rating: 4.25, avg_rating_n: 356, kids_happy: 67.4, kids_happy_n: 16, liked_loved: 76.8, liked_loved_n: 30, enough_food: 67.4, enough_food_n: 30, food_hot: 58.2, food_hot_n: 30, food_on_time: 81.9, food_on_time_n: 30},
            {bucket: "3-4", zones: 54, repeat_rate: 19.1, repeat_rate_n: 20132, avg_rating: 4.35, avg_rating_n: 3693, kids_happy: 76.2, kids_happy_n: 150, liked_loved: 90.4, liked_loved_n: 333, enough_food: 76.4, enough_food_n: 333, food_hot: 70.4, food_hot_n: 333, food_on_time: 86.7, food_on_time_n: 333},
            {bucket: "5-6", zones: 24, repeat_rate: 23.3, repeat_rate_n: 13763, avg_rating: 4.40, avg_rating_n: 2564, kids_happy: 66.9, kids_happy_n: 142, liked_loved: 81.8, liked_loved_n: 313, enough_food: 77.6, enough_food_n: 313, food_hot: 62.1, food_hot_n: 313, food_on_time: 79.8, food_on_time_n: 313},
            {bucket: "7+", zones: 17, repeat_rate: 23.8, repeat_rate_n: 15306, avg_rating: 4.47, avg_rating_n: 3146, kids_happy: 70.4, kids_happy_n: 116, liked_loved: 85.1, liked_loved_n: 279, enough_food: 77.6, enough_food_n: 279, food_hot: 63.9, food_hot_n: 279, food_on_time: 88.2, food_on_time_n: 279}
        ];
        
        // Dishes per Partner: Data from mvp_threshold_discovery.json step_3_dishes_within_partners_and_cuisines
        // Filter: Only zones with 3+ partners AND 3+ cuisines (94 zones)
        // Buckets: 3-4, 4-5, 5-6, 6+ (grouped for statistical reliability)
        const dishesData = [
            {bucket: "3-4", zones: 14, repeat_rate: 20.9, repeat_rate_n: 6179, avg_rating: 4.24, avg_rating_n: 1039, kids_happy: 84.0, kids_happy_n: 41, liked_loved: 83.3, liked_loved_n: 109, enough_food: 75.7, enough_food_n: 109, food_hot: 66.6, food_hot_n: 109},
            {bucket: "4-5", zones: 15, repeat_rate: 21.6, repeat_rate_n: 8669, avg_rating: 4.36, avg_rating_n: 1690, kids_happy: 61.3, kids_happy_n: 76, liked_loved: 89.0, liked_loved_n: 147, enough_food: 75.8, enough_food_n: 147, food_hot: 58.3, food_hot_n: 147},
            {bucket: "5-6", zones: 24, repeat_rate: 22.3, repeat_rate_n: 13109, avg_rating: 4.40, avg_rating_n: 2521, kids_happy: 67.3, kids_happy_n: 103, liked_loved: 86.9, liked_loved_n: 247, enough_food: 81.0, enough_food_n: 247, food_hot: 63.0, food_hot_n: 247},
            {bucket: "6+", zones: 41, repeat_rate: 20.0, repeat_rate_n: 21064, avg_rating: 4.44, avg_rating_n: 4123, kids_happy: 76.3, kids_happy_n: 185, liked_loved: 88.0, liked_loved_n: 418, enough_food: 76.2, enough_food_n: 418, food_hot: 73.1, food_hot_n: 418}
        ];
        
        // Chart defaults
        Chart.defaults.color = '#a0a0b0';
        Chart.defaults.borderColor = '#2a2a3a';
        Chart.defaults.font.family = "'Instrument Sans', sans-serif";
        
        // Navigation
        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(sectionId).classList.add('active');
            event.target.classList.add('active');
        }
        
        // Table toggle
        function toggleTable(tableId) {
            const table = document.getElementById(tableId);
            const button = table.previousElementSibling;
            table.classList.toggle('open');
            button.classList.toggle('open');
        }
        
        
        // Create multi-line chart for comparing multiple metrics
        function createMultiLineChart(canvasId, labels, datasets, thresholdIndex = null, yMin = 10) {
            const canvas = document.getElementById(canvasId);
            const ctx = canvas.getContext('2d');
            
            const chartDatasets = datasets.map((ds, i) => ({
                label: ds.label,
                data: ds.data,
                borderColor: ds.color,
                backgroundColor: 'transparent',
                borderWidth: 2,
                fill: false,
                tension: 0.3,
                pointRadius: 4,
                pointBackgroundColor: ds.color,
                pointBorderColor: '#0a0a0f',
                pointBorderWidth: 2,
                pointHoverRadius: 6
            }));
            
            const chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: chartDatasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { 
                            display: true,
                            position: 'top',
                            align: 'end',
                            labels: {
                                boxWidth: 12,
                                boxHeight: 12,
                                padding: 8,
                                font: { size: 10 },
                                usePointStyle: true,
                                pointStyle: 'circle'
                            }
                        },
                        tooltip: {
                            backgroundColor: '#1a1a24',
                            titleColor: '#f0f0f5',
                            bodyColor: '#a0a0b0',
                            borderColor: '#2a2a3a',
                            borderWidth: 1,
                            padding: 12,
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ' + context.parsed.y.toFixed(1) + '%';
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: { display: false },
                            ticks: { font: { size: 11 } }
                        },
                        y: {
                            min: yMin,
                            grid: { color: '#2a2a3a' },
                            ticks: {
                                font: { size: 11 },
                                callback: function(value) { return value + '%'; }
                            }
                        }
                    }
                }
            });
            
            chart.thresholdIndex = thresholdIndex;
            return chart;
        }
        
        // Create line chart with threshold line overlay
        function createLineChart(canvasId, labels, data, color, thresholdIndex = null, yMin = 10) {
            const canvas = document.getElementById(canvasId);
            const ctx = canvas.getContext('2d');
            
            // Point styling - highlight threshold point
            const pointRadius = labels.map((_, i) => i === thresholdIndex ? 8 : 4);
            const pointBorderWidth = labels.map((_, i) => i === thresholdIndex ? 3 : 2);
            
            const chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        borderColor: color,
                        backgroundColor: 'transparent',
                        borderWidth: 3,
                        fill: false,
                        tension: 0.3,
                        pointRadius: pointRadius,
                        pointBackgroundColor: color,
                        pointBorderColor: '#0a0a0f',
                        pointBorderWidth: pointBorderWidth,
                        pointHoverRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: '#1a1a24',
                            titleColor: '#f0f0f5',
                            bodyColor: '#a0a0b0',
                            borderColor: '#2a2a3a',
                            borderWidth: 1,
                            padding: 12,
                            displayColors: false,
                            callbacks: {
                                label: function(context) {
                                    return context.parsed.y.toFixed(1) + '%';
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: { display: false },
                            ticks: { font: { size: 11 } }
                        },
                        y: {
                            min: yMin,
                            grid: { color: '#2a2a3a' },
                            ticks: {
                                font: { size: 11 },
                                callback: function(value) { return value + '%'; }
                            }
                        }
                    }
                }
            });
            
            // Store threshold info on chart for the overlay
            chart.thresholdIndex = thresholdIndex;
            
            return chart;
        }
        
        // Draw threshold overlays after charts are rendered
        function drawThresholdOverlay(chart) {
            if (chart.thresholdIndex === null || chart.thresholdIndex === undefined) return;
            
            const chartArea = chart.chartArea;
            if (!chartArea) return;
            
            const canvas = chart.canvas;
            const ctx = chart.ctx;
            const labels = chart.data.labels;
            const thresholdIndex = chart.thresholdIndex;
            
            // Calculate x position: line goes BEFORE the threshold index
            // Each label is centered in its slot
            const labelCount = labels.length;
            const slotWidth = (chartArea.right - chartArea.left) / labelCount;
            
            // Line should be at the left edge of the threshold slot
            const xPos = chartArea.left + (thresholdIndex * slotWidth);
            
            ctx.save();
            
            // Draw shaded region for "below threshold" (left side) - red tint
            ctx.fillStyle = 'rgba(239, 68, 68, 0.12)';
            ctx.fillRect(chartArea.left, chartArea.top, xPos - chartArea.left, chartArea.bottom - chartArea.top);
            
            // Draw shaded region for "at/above threshold" (right side) - green tint  
            ctx.fillStyle = 'rgba(34, 197, 94, 0.08)';
            ctx.fillRect(xPos, chartArea.top, chartArea.right - xPos, chartArea.bottom - chartArea.top);
            
            // Draw dashed vertical line
            ctx.beginPath();
            ctx.setLineDash([6, 4]);
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.7)';
            ctx.lineWidth = 2;
            ctx.moveTo(xPos, chartArea.top);
            ctx.lineTo(xPos, chartArea.bottom);
            ctx.stroke();
            
            ctx.restore();
        }
        
        // Populate data tables
        function populateTable(tableBodyId, data, columns) {
            const tbody = document.getElementById(tableBodyId);
            tbody.innerHTML = data.map(row => {
                return '<tr>' + columns.map(col => {
                    if (col === 'bucket') {
                        return `<td class="bucket">${row[col]}</td>`;
                    } else if (col === 'zones') {
                        return `<td>${row[col]}</td>`;
                    } else if (col.endsWith('_n')) {
                        return ''; // Skip sample size columns, we'll inline them
                    } else {
                        const nCol = col + '_n';
                        const nValue = row[nCol] ? `<span class="sample-size">(n=${row[nCol]})</span>` : '';
                        const value = row[col] !== null && row[col] !== undefined ? 
                            (col === 'avg_rating' ? row[col].toFixed(2) : row[col].toFixed(1) + '%') : '-';
                        return `<td>${value} ${nValue}</td>`;
                    }
                }).filter(x => x).join('') + '</tr>';
            }).join('');
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Consistent Y-axis minimums for readability
            const REPEAT_RATE_MIN = 0;
            const SURVEY_MIN = 55;
            
            // Partners charts - threshold at index 1 (inflection from "1-2" to "3-4")
            // Labels: 1-2, 3-4, 5-6, 7-9, 10+ ‚Üí threshold line before "3-4" (index 1)
            // Clear inflection: 13.9% ‚Üí 18.4% (+4.5pp)
            const partnersRepeatChart = createLineChart('partnersRepeatChart', 
                partnersData.map(d => d.bucket),
                partnersData.map(d => d.repeat_rate),
                '#00d4aa', 1, REPEAT_RATE_MIN);
            
            // Multi-line survey chart for partners - NO threshold overlay (survey data is noisy)
            const partnersSurveyChart = createMultiLineChart('partnersSurveyChart',
                partnersData.map(d => d.bucket),
                [
                    { label: 'Kids Happy', data: partnersData.map(d => d.kids_happy), color: '#00d4aa' },
                    { label: 'Liked/Loved', data: partnersData.map(d => d.liked_loved), color: '#ec4899' },
                    { label: 'Enough Food', data: partnersData.map(d => d.enough_food), color: '#3b82f6' }
                ],
                null, SURVEY_MIN); // null = no threshold line
            
            // Cuisines charts - threshold at index 1 (inflection from "1-2" to "3-4")
            // Labels: 1-2, 3-4, 5-6, 7+ ‚Üí threshold line before "3-4" (index 1)
            // Clear inflection: 18.3% ‚Üí 19.1% (+0.8pp, but adds independent value)
            const cuisinesRepeatChart = createLineChart('cuisinesRepeatChart',
                cuisinesData.map(d => d.bucket),
                cuisinesData.map(d => d.repeat_rate),
                '#8b5cf6', 1, REPEAT_RATE_MIN);
            
            // Multi-line survey chart for cuisines - NO threshold overlay (survey data is noisy)
            const cuisinesSurveyChart = createMultiLineChart('cuisinesSurveyChart',
                cuisinesData.map(d => d.bucket),
                [
                    { label: 'Kids Happy', data: cuisinesData.map(d => d.kids_happy), color: '#8b5cf6' },
                    { label: 'Liked/Loved', data: cuisinesData.map(d => d.liked_loved), color: '#ec4899' },
                    { label: 'Enough Food', data: cuisinesData.map(d => d.enough_food), color: '#3b82f6' }
                ],
                null, 55); // null = no threshold line
            
            // Dishes charts - threshold at index 1 (inflection from "3-4" to "4-5")
            // Labels: 3-4, 4-5, 5-6, 6+ ‚Üí threshold line before "4-5" (index 1)
            // Inflection: 20.9% ‚Üí 21.6% (+0.7pp)
            const dishesRepeatChart = createLineChart('dishesRepeatChart',
                dishesData.map(d => d.bucket),
                dishesData.map(d => d.repeat_rate),
                '#f59e0b', 1, REPEAT_RATE_MIN);
            
            // Multi-line survey chart for dishes - NO threshold overlay (survey data is noisy)
            const dishesSurveyChart = createMultiLineChart('dishesSurveyChart',
                dishesData.map(d => d.bucket),
                [
                    { label: 'Kids Happy', data: dishesData.map(d => d.kids_happy), color: '#f59e0b' },
                    { label: 'Liked/Loved', data: dishesData.map(d => d.liked_loved), color: '#ec4899' },
                    { label: 'Enough Food', data: dishesData.map(d => d.enough_food), color: '#3b82f6' }
                ],
                null, SURVEY_MIN); // null = no threshold line
            
            // Populate tables
            populateTable('partners-table-body', partnersData, 
                ['bucket', 'zones', 'repeat_rate', 'avg_rating', 'kids_happy', 'liked_loved', 'enough_food', 'food_hot', 'food_on_time']);
            
            populateTable('cuisines-table-body', cuisinesData,
                ['bucket', 'zones', 'repeat_rate', 'avg_rating', 'kids_happy', 'liked_loved', 'enough_food', 'food_hot', 'food_on_time']);
            
            populateTable('dishes-table-body', dishesData,
                ['bucket', 'zones', 'repeat_rate', 'avg_rating', 'kids_happy', 'liked_loved', 'enough_food', 'food_hot']);
            
            // Draw threshold overlays only on repeat rate charts (behavioral data with clear inflection)
            // Survey charts don't get overlays - data is noisy and doesn't show same pattern
            setTimeout(() => {
                drawThresholdOverlay(partnersRepeatChart);
                drawThresholdOverlay(cuisinesRepeatChart);
                drawThresholdOverlay(dishesRepeatChart);
            }, 100);
            
            // ============================================================
            // ZONE ANALYSIS TAB DATA & CHARTS
            // ============================================================
            
            // Initialize Zones
            initZoneAnalysis();
            
            // Initialize Dishes
            initDishPrioritization();
            
            // Initialize Cuisines
            initCuisineGaps();
        });
        
        // ============================================================
        // ZONE ANALYSIS DATA & FUNCTIONS
        // ============================================================
        
        // Zone MVP Status Data (from zone_mvp_status.csv)
        const zoneData = [
            {zone: "Clapham", region: "London", orders: 2349, partners: 13, cuisines: 9, rating: 4.61, mvp_criteria_met: 3, is_mvp: true, score: 100},
            {zone: "Islington", region: "London", orders: 2262, partners: 8, cuisines: 8, rating: 4.69, mvp_criteria_met: 3, is_mvp: true, score: 97},
            {zone: "Brighton Central", region: "London", orders: 1734, partners: 10, cuisines: 8, rating: 4.47, mvp_criteria_met: 3, is_mvp: true, score: 97},
            {zone: "Oxford", region: "South East", orders: 1501, partners: 7, cuisines: 5, rating: 4.52, mvp_criteria_met: 3, is_mvp: true, score: 93},
            {zone: "Brockley / Forest Hill", region: "London", orders: 1478, partners: 3, cuisines: 3, rating: 4.61, mvp_criteria_met: 1, is_mvp: false, score: 76},
            {zone: "Cambridge", region: "South East", orders: 1403, partners: 8, cuisines: 7, rating: 4.48, mvp_criteria_met: 3, is_mvp: true, score: 94},
            {zone: "Lewisham", region: "London", orders: 1358, partners: 5, cuisines: 5, rating: 4.50, mvp_criteria_met: 3, is_mvp: true, score: 83},
            {zone: "Milton Keynes", region: "South East", orders: 1332, partners: 8, cuisines: 7, rating: 4.46, mvp_criteria_met: 3, is_mvp: true, score: 94},
            {zone: "Canning Town", region: "Other", orders: 1314, partners: 3, cuisines: 3, rating: 4.67, mvp_criteria_met: 1, is_mvp: false, score: 67},
            {zone: "Wimbledon", region: "London", orders: 1314, partners: 8, cuisines: 7, rating: 4.50, mvp_criteria_met: 3, is_mvp: true, score: 97},
            {zone: "Reading", region: "South East", orders: 1318, partners: 10, cuisines: 6, rating: 4.29, mvp_criteria_met: 3, is_mvp: true, score: 94},
            {zone: "East Central", region: "London", orders: 1280, partners: 11, cuisines: 8, rating: 4.46, mvp_criteria_met: 3, is_mvp: true, score: 97},
            {zone: "Chiswick", region: "London", orders: 1240, partners: 6, cuisines: 5, rating: 4.74, mvp_criteria_met: 3, is_mvp: true, score: 90},
            {zone: "Notting Hill / Paddington", region: "London", orders: 1226, partners: 9, cuisines: 7, rating: 4.53, mvp_criteria_met: 3, is_mvp: true, score: 100},
            {zone: "Wembley", region: "Other", orders: 1202, partners: 7, cuisines: 7, rating: 4.49, mvp_criteria_met: 3, is_mvp: true, score: 87},
            {zone: "Bristol", region: "South West", orders: 1173, partners: 8, cuisines: 6, rating: 4.53, mvp_criteria_met: 3, is_mvp: true, score: 93},
            {zone: "Kingston", region: "London", orders: 1156, partners: 8, cuisines: 7, rating: 4.46, mvp_criteria_met: 3, is_mvp: true, score: 94},
            {zone: "Surrey Quays", region: "Other", orders: 1139, partners: 4, cuisines: 3, rating: 4.61, mvp_criteria_met: 1, is_mvp: false, score: 74},
            {zone: "Canary Wharf", region: "Other", orders: 1122, partners: 6, cuisines: 5, rating: 4.29, mvp_criteria_met: 3, is_mvp: true, score: 80},
            {zone: "Norwich", region: "South East", orders: 1050, partners: 6, cuisines: 5, rating: 4.25, mvp_criteria_met: 3, is_mvp: true, score: 87},
            {zone: "Guildford", region: "South East", orders: 969, partners: 6, cuisines: 6, rating: 4.25, mvp_criteria_met: 3, is_mvp: true, score: 84},
            {zone: "Wapping and Mile End", region: "Other", orders: 961, partners: 4, cuisines: 4, rating: 4.66, mvp_criteria_met: 1, is_mvp: false, score: 78},
            {zone: "Hammersmith / Shepherd's Bush", region: "London", orders: 962, partners: 7, cuisines: 6, rating: 4.46, mvp_criteria_met: 3, is_mvp: true, score: 90},
            {zone: "Ealing", region: "London", orders: 904, partners: 5, cuisines: 5, rating: 4.20, mvp_criteria_met: 3, is_mvp: true, score: 84},
            {zone: "Wandsworth", region: "London", orders: 853, partners: 3, cuisines: 3, rating: 4.69, mvp_criteria_met: 1, is_mvp: false, score: 71},
            {zone: "London Bridge", region: "London", orders: 850, partners: 10, cuisines: 7, rating: 4.57, mvp_criteria_met: 3, is_mvp: true, score: 100},
            {zone: "Hampstead", region: "Other", orders: 797, partners: 5, cuisines: 4, rating: 4.47, mvp_criteria_met: 2, is_mvp: false, score: 87},
            {zone: "West Central", region: "London", orders: 793, partners: 10, cuisines: 7, rating: 4.56, mvp_criteria_met: 3, is_mvp: true, score: 100},
            {zone: "Mayfair", region: "London", orders: 772, partners: 8, cuisines: 6, rating: 4.57, mvp_criteria_met: 3, is_mvp: true, score: 100},
            {zone: "Nottingham", region: "London", orders: 759, partners: 7, cuisines: 5, rating: 4.43, mvp_criteria_met: 3, is_mvp: true, score: 90},
            {zone: "York", region: "North", orders: 729, partners: 8, cuisines: 6, rating: 4.46, mvp_criteria_met: 3, is_mvp: true, score: 90},
            {zone: "Chelmsford", region: "South East", orders: 725, partners: 7, cuisines: 5, rating: 4.21, mvp_criteria_met: 3, is_mvp: true, score: 91},
            {zone: "Edinburgh Central", region: "London", orders: 722, partners: 3, cuisines: 3, rating: 4.51, mvp_criteria_met: 1, is_mvp: false, score: 74},
            {zone: "Birmingham", region: "Midlands", orders: 689, partners: 9, cuisines: 7, rating: 4.15, mvp_criteria_met: 3, is_mvp: true, score: 94},
            {zone: "South Kensington", region: "London", orders: 676, partners: 7, cuisines: 4, rating: 4.56, mvp_criteria_met: 2, is_mvp: false, score: 89},
            {zone: "Stratford", region: "London", orders: 665, partners: 5, cuisines: 4, rating: 4.26, mvp_criteria_met: 2, is_mvp: false, score: 84},
            {zone: "Bath", region: "South West", orders: 647, partners: 9, cuisines: 7, rating: 4.53, mvp_criteria_met: 3, is_mvp: true, score: 100},
            {zone: "Bournemouth", region: "South East", orders: 634, partners: 4, cuisines: 3, rating: 4.26, mvp_criteria_met: 1, is_mvp: false, score: 76},
            {zone: "Fulham", region: "London", orders: 615, partners: 5, cuisines: 5, rating: 4.57, mvp_criteria_met: 3, is_mvp: true, score: 90},
            {zone: "Bracknell", region: "Other", orders: 585, partners: 4, cuisines: 4, rating: 4.55, mvp_criteria_met: 1, is_mvp: false, score: 83},
            {zone: "Edgbaston", region: "Other", orders: 574, partners: 3, cuisines: 3, rating: 4.68, mvp_criteria_met: 1, is_mvp: false, score: 76},
            {zone: "St Albans", region: "South East", orders: 559, partners: 4, cuisines: 4, rating: 4.23, mvp_criteria_met: 1, is_mvp: false, score: 77},
            {zone: "Richmond / Kew", region: "London", orders: 562, partners: 6, cuisines: 6, rating: 4.30, mvp_criteria_met: 3, is_mvp: true, score: 90},
            {zone: "Glasgow Centre", region: "Scotland", orders: 542, partners: 5, cuisines: 5, rating: 4.55, mvp_criteria_met: 3, is_mvp: true, score: 90},
            {zone: "Reigate", region: "South East", orders: 541, partners: 6, cuisines: 5, rating: 4.51, mvp_criteria_met: 3, is_mvp: true, score: 90},
            {zone: "Salford", region: "Other", orders: 535, partners: 6, cuisines: 4, rating: 4.26, mvp_criteria_met: 2, is_mvp: false, score: 80},
            {zone: "Canterbury", region: "South East", orders: 534, partners: 7, cuisines: 6, rating: 4.16, mvp_criteria_met: 3, is_mvp: true, score: 87},
            {zone: "Croydon", region: "London", orders: 519, partners: 4, cuisines: 3, rating: 4.29, mvp_criteria_met: 1, is_mvp: false, score: 80},
            {zone: "Windsor", region: "South East", orders: 517, partners: 6, cuisines: 4, rating: 4.30, mvp_criteria_met: 2, is_mvp: false, score: 73},
            {zone: "Cheltenham", region: "South West", orders: 512, partners: 5, cuisines: 4, rating: 4.38, mvp_criteria_met: 2, is_mvp: false, score: 76},
            {zone: "Victoria, Westminster, Pimlico", region: "London", orders: 506, partners: 8, cuisines: 5, rating: 4.63, mvp_criteria_met: 3, is_mvp: true, score: 89},
            {zone: "Basingstoke", region: "South East", orders: 483, partners: 3, cuisines: 3, rating: 3.83, mvp_criteria_met: 0, is_mvp: false, score: 63},
            {zone: "Cardiff", region: "Wales", orders: 475, partners: 6, cuisines: 5, rating: 4.57, mvp_criteria_met: 3, is_mvp: true, score: 83},
            {zone: "Leeds City Centre", region: "North", orders: 470, partners: 9, cuisines: 7, rating: 4.52, mvp_criteria_met: 3, is_mvp: true, score: 90},
            {zone: "Southampton", region: "South East", orders: 470, partners: 5, cuisines: 4, rating: 4.29, mvp_criteria_met: 2, is_mvp: false, score: 73},
            {zone: "Bromley", region: "London", orders: 465, partners: 4, cuisines: 3, rating: 3.81, mvp_criteria_met: 0, is_mvp: false, score: 70},
            {zone: "Colchester", region: "South East", orders: 464, partners: 4, cuisines: 4, rating: 4.60, mvp_criteria_met: 1, is_mvp: false, score: 76},
            {zone: "Sheffield City Centre", region: "North", orders: 442, partners: 4, cuisines: 3, rating: 4.27, mvp_criteria_met: 1, is_mvp: false, score: 66},
            {zone: "Southsea", region: "Other", orders: 435, partners: 7, cuisines: 5, rating: 4.18, mvp_criteria_met: 3, is_mvp: true, score: 80},
            {zone: "Dalston Stoke Newington", region: "Midlands", orders: 434, partners: 4, cuisines: 3, rating: 4.43, mvp_criteria_met: 1, is_mvp: false, score: 68},
            {zone: "Romford", region: "Other", orders: 434, partners: 3, cuisines: 2, rating: 4.44, mvp_criteria_met: 1, is_mvp: false, score: 62},
            {zone: "Royal Tunbridge Wells", region: "South East", orders: 426, partners: 6, cuisines: 6, rating: 4.44, mvp_criteria_met: 3, is_mvp: true, score: 76},
            {zone: "Horsham", region: "Other", orders: 416, partners: 4, cuisines: 4, rating: 4.41, mvp_criteria_met: 1, is_mvp: false, score: 73},
            {zone: "Brixton", region: "London", orders: 396, partners: 4, cuisines: 4, rating: 4.50, mvp_criteria_met: 1, is_mvp: false, score: 71},
            {zone: "Watford", region: "South East", orders: 372, partners: 4, cuisines: 4, rating: 4.36, mvp_criteria_met: 1, is_mvp: false, score: 73},
            {zone: "Stevenage", region: "Other", orders: 369, partners: 3, cuisines: 3, rating: 4.52, mvp_criteria_met: 1, is_mvp: false, score: 64},
            {zone: "Edinburgh North", region: "Scotland", orders: 345, partners: 3, cuisines: 3, rating: 4.43, mvp_criteria_met: 1, is_mvp: false, score: 64},
            {zone: "Dartford", region: "Other", orders: 336, partners: 6, cuisines: 5, rating: 4.10, mvp_criteria_met: 3, is_mvp: true, score: 77},
            {zone: "Farnham", region: "Other", orders: 306, partners: 3, cuisines: 3, rating: 4.67, mvp_criteria_met: 1, is_mvp: false, score: 69},
            {zone: "Liverpool City Centre", region: "North", orders: 307, partners: 5, cuisines: 4, rating: 4.29, mvp_criteria_met: 2, is_mvp: false, score: 68},
            {zone: "Easton", region: "Other", orders: 297, partners: 5, cuisines: 4, rating: 4.38, mvp_criteria_met: 2, is_mvp: false, score: 61},
            {zone: "Putney & Barnes", region: "London", orders: 296, partners: 3, cuisines: 3, rating: 4.70, mvp_criteria_met: 1, is_mvp: false, score: 67},
            {zone: "Epsom", region: "South East", orders: 292, partners: 4, cuisines: 3, rating: 4.13, mvp_criteria_met: 1, is_mvp: false, score: 64},
            {zone: "Belsize Park / St John's Wood", region: "Other", orders: 278, partners: 3, cuisines: 3, rating: 4.79, mvp_criteria_met: 1, is_mvp: false, score: 71},
            {zone: "Walton on Thames", region: "Other", orders: 275, partners: 3, cuisines: 3, rating: 4.47, mvp_criteria_met: 1, is_mvp: false, score: 64},
            {zone: "Golders Green / Brent Cross", region: "London", orders: 275, partners: 3, cuisines: 1, rating: 4.00, mvp_criteria_met: 1, is_mvp: false, score: 57},
            {zone: "Royal Leamington Spa", region: "Other", orders: 257, partners: 4, cuisines: 4, rating: 4.37, mvp_criteria_met: 1, is_mvp: false, score: 68},
            {zone: "Camden/Kentish Town", region: "London", orders: 249, partners: 6, cuisines: 5, rating: 4.11, mvp_criteria_met: 3, is_mvp: true, score: 77},
            {zone: "Uxbridge", region: "Other", orders: 242, partners: 4, cuisines: 3, rating: 4.40, mvp_criteria_met: 1, is_mvp: false, score: 64},
            {zone: "West Bridgford", region: "Other", orders: 239, partners: 3, cuisines: 3, rating: 4.29, mvp_criteria_met: 1, is_mvp: false, score: 58},
            {zone: "Chichester", region: "North", orders: 237, partners: 4, cuisines: 4, rating: 4.13, mvp_criteria_met: 1, is_mvp: false, score: 70},
            {zone: "Didsbury and Withington", region: "Other", orders: 236, partners: 3, cuisines: 3, rating: 4.72, mvp_criteria_met: 1, is_mvp: false, score: 64},
            {zone: "Cribbs Causeway Shopping Centre", region: "Other", orders: 220, partners: 5, cuisines: 4, rating: 3.87, mvp_criteria_met: 1, is_mvp: false, score: 65},
            {zone: "Newton Longville", region: "Other", orders: 181, partners: 5, cuisines: 3, rating: 4.05, mvp_criteria_met: 2, is_mvp: false, score: 68},
            {zone: "Henley on Thames", region: "Other", orders: 181, partners: 3, cuisines: 2, rating: 4.28, mvp_criteria_met: 1, is_mvp: false, score: 58},
            {zone: "Highgate, Muswell Hill, East Finchley", region: "Other", orders: 168, partners: 3, cuisines: 3, rating: 4.42, mvp_criteria_met: 1, is_mvp: false, score: 64},
            {zone: "Hatfield/ Hatfield Park", region: "Other", orders: 160, partners: 3, cuisines: 2, rating: 4.39, mvp_criteria_met: 1, is_mvp: false, score: 49},
            {zone: "Manchester Central", region: "London", orders: 156, partners: 3, cuisines: 3, rating: 4.36, mvp_criteria_met: 1, is_mvp: false, score: 49},
            {zone: "Braintree", region: "Other", orders: 151, partners: 4, cuisines: 3, rating: 3.90, mvp_criteria_met: 0, is_mvp: false, score: 50},
            {zone: "Newbury", region: "Other", orders: 148, partners: 3, cuisines: 3, rating: 4.48, mvp_criteria_met: 1, is_mvp: false, score: 53},
            {zone: "Cardiff Bay Area", region: "Wales", orders: 144, partners: 5, cuisines: 5, rating: 4.78, mvp_criteria_met: 3, is_mvp: true, score: 70},
            {zone: "Harrow", region: "London", orders: 126, partners: 4, cuisines: 3, rating: 4.33, mvp_criteria_met: 1, is_mvp: false, score: 56},
            {zone: "Winchester", region: "North", orders: 126, partners: 3, cuisines: 3, rating: 4.00, mvp_criteria_met: 1, is_mvp: false, score: 50},
            {zone: "Dublin City North", region: "Other", orders: 782, partners: 6, cuisines: 5, rating: 4.06, mvp_criteria_met: 3, is_mvp: true, score: 90},
            {zone: "Finsbury Park / Harringay / Crouch End", region: "London", orders: 1534, partners: 4, cuisines: 3, rating: 4.53, mvp_criteria_met: 1, is_mvp: false, score: 79},
            {zone: "Eccles", region: "Other", orders: 175, partners: 3, cuisines: 3, rating: 4.03, mvp_criteria_met: 1, is_mvp: false, score: 58},
            {zone: "Sutton", region: "London", orders: 101, partners: 3, cuisines: 2, rating: 4.13, mvp_criteria_met: 1, is_mvp: false, score: 49},
            {zone: "Dublin City South", region: "Other", orders: 93, partners: 3, cuisines: 2, rating: 4.82, mvp_criteria_met: 1, is_mvp: false, score: 46},
            {zone: "Edgware / Mill Hill", region: "Other", orders: 95, partners: 3, cuisines: 1, rating: 3.83, mvp_criteria_met: 0, is_mvp: false, score: 42},
            {zone: "Chingford", region: "Other", orders: 77, partners: 3, cuisines: 3, rating: 4.20, mvp_criteria_met: 1, is_mvp: false, score: 50}
        ];
        
        function initZoneAnalysis() {
            // Calculate MVP status counts
            const mvpReady = zoneData.filter(z => z.is_mvp).length;
            const nearMvp = zoneData.filter(z => !z.is_mvp && z.mvp_criteria_met === 2).length;
            const developing = zoneData.filter(z => !z.is_mvp && z.mvp_criteria_met < 2).length;
            
            // Update KPI cards
            document.getElementById('mvp-ready-count').textContent = mvpReady;
            document.getElementById('near-mvp-count').textContent = nearMvp;
            document.getElementById('developing-count').textContent = developing;
            
            // Create MVP Status Donut Chart
            new Chart(document.getElementById('zoneMvpDonutChart'), {
                type: 'doughnut',
                data: {
                    labels: ['MVP Ready', 'Near MVP', 'Developing'],
                    datasets: [{
                        data: [mvpReady, nearMvp, developing],
                        backgroundColor: ['#00d4aa', '#8b5cf6', '#f59e0b'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '60%',
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: { padding: 20, usePointStyle: true, pointStyle: 'circle' }
                        }
                    }
                }
            });
            
            // Create Top 10 Zones Bar Chart
            const top10 = [...zoneData].sort((a, b) => b.score - a.score).slice(0, 10);
            new Chart(document.getElementById('topZonesBarChart'), {
                type: 'bar',
                data: {
                    labels: top10.map(z => z.zone.length > 15 ? z.zone.substring(0, 15) + '...' : z.zone),
                    datasets: [{
                        data: top10.map(z => z.score),
                        backgroundColor: top10.map(z => z.is_mvp ? '#00d4aa' : '#f59e0b'),
                        borderRadius: 4
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        x: { min: 0, max: 100, grid: { color: '#2a2a3a' } },
                        y: { grid: { display: false } }
                    }
                }
            });
            
            // Populate zone table
            populateZoneTable(zoneData);
        }
        
        function populateZoneTable(data) {
            const tbody = document.getElementById('zones-table-body');
            tbody.innerHTML = data.map(z => {
                const status = z.is_mvp ? 'MVP Ready' : (z.mvp_criteria_met === 2 ? 'Near MVP' : 'Developing');
                const statusClass = z.is_mvp ? 'validated' : (z.mvp_criteria_met === 2 ? 'corroborated' : 'single');
                return `<tr>
                    <td class="bucket">${z.zone}</td>
                    <td>${z.region}</td>
                    <td><span class="evidence-badge ${statusClass}">${status}</span></td>
                    <td>${z.orders.toLocaleString()}</td>
                    <td>${z.partners}</td>
                    <td>${z.cuisines}</td>
                    <td>${z.rating.toFixed(2)}</td>
                    <td>${z.score}</td>
                </tr>`;
            }).join('');
            document.getElementById('zone-table-count').textContent = data.length;
        }
        
        // Zone table state
        let currentZoneSort = { column: 'orders', direction: 'desc' };
        let filteredZoneData = [];
        
        function filterZoneTable() {
            const searchFilter = document.getElementById('zoneSearchFilter')?.value?.toLowerCase() || '';
            const regionFilter = document.getElementById('zoneRegionFilter').value;
            const mvpFilter = document.getElementById('zoneMvpFilter').value;
            const progressFilter = document.getElementById('zoneProgressFilter')?.value || 'all';
            const partnersFilter = document.getElementById('zonePartnersFilter')?.value || 'all';
            
            // Use zoneAnalysisData - filter to zones with orders only
            let sourceData = zoneAnalysisData?.zones?.filter(z => z.orders && z.orders > 0) || [];
            let filtered = [...sourceData];
            
            // Search filter
            if (searchFilter) {
                filtered = filtered.filter(z => 
                    z.zone.toLowerCase().includes(searchFilter) ||
                    z.city?.toLowerCase().includes(searchFilter) ||
                    z.region?.toLowerCase().includes(searchFilter)
                );
            }
            
            // Region filter
            if (regionFilter !== 'all') {
                filtered = filtered.filter(z => z.region === regionFilter);
            }
            
            // MVP Status filter
            if (mvpFilter !== 'all') {
                if (mvpFilter === 'mvp') {
                    filtered = filtered.filter(z => z.mvp_status === 'MVP Ready');
                } else if (mvpFilter === 'near') {
                    filtered = filtered.filter(z => z.mvp_status === 'Near MVP');
                } else if (mvpFilter === 'developing') {
                    filtered = filtered.filter(z => z.mvp_status === 'Developing');
                }
            }
            
            // Progress filter
            if (progressFilter !== 'all') {
                const getProgress = z => z.progress?.overall_pct || 0;
                if (progressFilter === 'high') {
                    filtered = filtered.filter(z => getProgress(z) >= 80);
                } else if (progressFilter === 'medium') {
                    filtered = filtered.filter(z => getProgress(z) >= 50 && getProgress(z) < 80);
                } else if (progressFilter === 'low') {
                    filtered = filtered.filter(z => getProgress(z) < 50);
                }
            }
            
            // Partners filter
            if (partnersFilter !== 'all') {
                if (partnersFilter === '5+') {
                    filtered = filtered.filter(z => z.partners >= 5);
                } else if (partnersFilter === '3-4') {
                    filtered = filtered.filter(z => z.partners >= 3 && z.partners <= 4);
                } else if (partnersFilter === '1-2') {
                    filtered = filtered.filter(z => z.partners >= 1 && z.partners <= 2);
                }
            }
            
            // Sort
            filtered = sortZoneData(filtered);
            
            // Store filtered data
            filteredZoneData = filtered;
            
            // Update counts
            const totalWithOrders = zoneAnalysisData?.zones?.filter(z => z.orders && z.orders > 0).length || 0;
            document.getElementById('zone-filtered-count').textContent = filtered.length;
            document.getElementById('zone-total-count').textContent = totalWithOrders;
            
            // Render table
            populateZoneTableWithChecklist(filtered);
        }
        
        function sortZoneData(data) {
            const col = currentZoneSort.column;
            const dir = currentZoneSort.direction;
            
            return [...data].sort((a, b) => {
                let aVal, bVal;
                
                switch(col) {
                    case 'zone':
                        aVal = a.zone?.toLowerCase() || '';
                        bVal = b.zone?.toLowerCase() || '';
                        break;
                    case 'region':
                        aVal = a.region?.toLowerCase() || '';
                        bVal = b.region?.toLowerCase() || '';
                        break;
                    case 'status':
                        const statusOrder = {'MVP Ready': 0, 'Near MVP': 1, 'Developing': 2};
                        aVal = statusOrder[a.mvp_status] ?? 3;
                        bVal = statusOrder[b.mvp_status] ?? 3;
                        break;
                    case 'orders':
                        aVal = a.orders || 0;
                        bVal = b.orders || 0;
                        break;
                    case 'partners':
                        aVal = a.partners || 0;
                        bVal = b.partners || 0;
                        break;
                    case 'cuisines':
                        aVal = a.cuisines_count || 0;
                        bVal = b.cuisines_count || 0;
                        break;
                    case 'rating':
                        aVal = a.avg_rating || 0;
                        bVal = b.avg_rating || 0;
                        break;
                    case 'progress':
                        aVal = a.mvp_checklist?.progress?.overall_pct || 0;
                        bVal = b.mvp_checklist?.progress?.overall_pct || 0;
                        break;
                    default:
                        aVal = a[col] || 0;
                        bVal = b[col] || 0;
                }
                
                if (dir === 'asc') {
                    return aVal > bVal ? 1 : aVal < bVal ? -1 : 0;
                } else {
                    return aVal < bVal ? 1 : aVal > bVal ? -1 : 0;
                }
            });
        }
        
        function sortZoneTable(column) {
            // Toggle direction if same column, otherwise default to desc
            if (currentZoneSort.column === column) {
                currentZoneSort.direction = currentZoneSort.direction === 'asc' ? 'desc' : 'asc';
            } else {
                currentZoneSort.column = column;
                currentZoneSort.direction = 'desc';
            }
            
            // Update header indicators
            document.querySelectorAll('#zone-data-table th.sortable').forEach(th => {
                th.classList.remove('active', 'asc', 'desc');
                th.querySelector('.sort-indicator').textContent = '';
            });
            
            const activeHeader = document.querySelector(`#zone-data-table th[data-sort="${column}"]`);
            if (activeHeader) {
                activeHeader.classList.add('active', currentZoneSort.direction);
                activeHeader.querySelector('.sort-indicator').textContent = currentZoneSort.direction === 'asc' ? '‚ñ≤' : '‚ñº';
            }
            
            // Re-filter (which also sorts)
            filterZoneTable();
        }
        
        function clearZoneFilters() {
            document.getElementById('zoneSearchFilter').value = '';
            document.getElementById('zoneRegionFilter').value = 'all';
            document.getElementById('zoneMvpFilter').value = 'all';
            document.getElementById('zoneProgressFilter').value = 'all';
            document.getElementById('zonePartnersFilter').value = 'all';
            filterZoneTable();
        }
        
        function populateRegionFilter() {
            if (!zoneAnalysisData?.zones) return;
            
            const regions = [...new Set(zoneAnalysisData.zones
                .filter(z => z.orders && z.orders > 0)
                .map(z => z.region)
                .filter(r => r)
            )].sort();
            
            const select = document.getElementById('zoneRegionFilter');
            select.innerHTML = '<option value="all">All Regions</option>';
            regions.forEach(region => {
                const option = document.createElement('option');
                option.value = region;
                option.textContent = region;
                select.appendChild(option);
            });
        }
        
        // ============================================================
        // DISH PRIORITIZATION DATA & FUNCTIONS
        // ============================================================
        
        // Priority 100 Dish Data (from priority_100_unified.csv)
        const dishData = [
            {rank: 1, dish_type: "Curry", cuisine: "Indian", on_dinneroo: true, unified_score: 4.94, performance_score: 4.97, opportunity_score: 4.91, tier: "Tier 1: Must-Have", quadrant: "Priority", order_volume: 5897},
            {rank: 2, dish_type: "Noodles", cuisine: "Asian", on_dinneroo: true, unified_score: 4.90, performance_score: 4.82, opportunity_score: 4.99, tier: "Tier 1: Must-Have", quadrant: "Priority", order_volume: 2092},
            {rank: 3, dish_type: "Pho", cuisine: "Vietnamese", on_dinneroo: true, unified_score: 4.90, performance_score: 4.82, opportunity_score: 4.98, tier: "Tier 1: Must-Have", quadrant: "Priority", order_volume: 4530},
            {rank: 4, dish_type: "Katsu", cuisine: "Japanese", on_dinneroo: true, unified_score: 4.89, performance_score: 4.92, opportunity_score: 4.85, tier: "Tier 1: Must-Have", quadrant: "Priority", order_volume: 11730},
            {rank: 5, dish_type: "Salad", cuisine: "Healthy", on_dinneroo: true, unified_score: 4.65, performance_score: 4.33, opportunity_score: 4.96, tier: "Tier 1: Must-Have", quadrant: "Priority", order_volume: 1090},
            {rank: 6, dish_type: "Pasta", cuisine: "Italian", on_dinneroo: true, unified_score: 4.51, performance_score: 4.33, opportunity_score: 4.69, tier: "Tier 1: Must-Have", quadrant: "Priority", order_volume: 1342},
            {rank: 7, dish_type: "Chicken Pie", cuisine: "British", on_dinneroo: true, unified_score: 3.82, performance_score: 5.00, opportunity_score: 2.64, tier: "Tier 1: Must-Have", quadrant: "Protect", order_volume: 34506},
            {rank: 8, dish_type: "Pad Thai", cuisine: "Thai", on_dinneroo: true, unified_score: 3.64, performance_score: 4.63, opportunity_score: 2.64, tier: "Tier 2: Should-Have", quadrant: "Protect", order_volume: 2734},
            {rank: 9, dish_type: "Rice Bowl", cuisine: "Asian", on_dinneroo: true, unified_score: 3.50, performance_score: 4.92, opportunity_score: 2.07, tier: "Tier 2: Should-Have", quadrant: "Protect", order_volume: 9545},
            {rank: 10, dish_type: "Sushi", cuisine: "Japanese", on_dinneroo: true, unified_score: 3.39, performance_score: 3.64, opportunity_score: 3.14, tier: "Tier 2: Should-Have", quadrant: "Priority", order_volume: 1043},
            {rank: 11, dish_type: "Lasagne", cuisine: "Italian", on_dinneroo: true, unified_score: 3.36, performance_score: 3.10, opportunity_score: 3.62, tier: "Tier 2: Should-Have", quadrant: "Priority", order_volume: 931},
            {rank: 12, dish_type: "Ramen", cuisine: "Japanese", on_dinneroo: true, unified_score: 3.35, performance_score: 1.79, opportunity_score: 4.91, tier: "Tier 2: Should-Have", quadrant: "Develop", order_volume: 223},
            {rank: 13, dish_type: "Biryani", cuisine: "Indian", on_dinneroo: true, unified_score: 3.33, performance_score: 4.02, opportunity_score: 2.64, tier: "Tier 2: Should-Have", quadrant: "Protect", order_volume: 458},
            {rank: 14, dish_type: "Grilled Chicken with Sides", cuisine: "Global", on_dinneroo: true, unified_score: 3.29, performance_score: 3.10, opportunity_score: 3.47, tier: "Tier 2: Should-Have", quadrant: "Priority", order_volume: 540},
            {rank: 15, dish_type: "Teriyaki", cuisine: "Japanese", on_dinneroo: true, unified_score: 3.28, performance_score: 4.33, opportunity_score: 2.24, tier: "Tier 2: Should-Have", quadrant: "Protect", order_volume: 1369},
            {rank: 16, dish_type: "Bowl", cuisine: "Healthy/Fresh", on_dinneroo: true, unified_score: 3.25, performance_score: 4.88, opportunity_score: 1.63, tier: "Tier 2: Should-Have", quadrant: "Protect", order_volume: 4517},
            {rank: 17, dish_type: "Pizza", cuisine: "Italian", on_dinneroo: true, unified_score: 3.17, performance_score: 3.10, opportunity_score: 3.23, tier: "Tier 3: Nice-to-Have", quadrant: "Priority", order_volume: 548},
            {rank: 18, dish_type: "Fried Rice", cuisine: "Chinese", on_dinneroo: true, unified_score: 3.14, performance_score: 4.82, opportunity_score: 1.46, tier: "Tier 3: Nice-to-Have", quadrant: "Protect", order_volume: 4958},
            {rank: 19, dish_type: "Sweet & Sour Chicken", cuisine: "Global", on_dinneroo: true, unified_score: 2.87, performance_score: 3.10, opportunity_score: 2.64, tier: "Tier 3: Nice-to-Have", quadrant: "Protect", order_volume: 1081},
            {rank: 20, dish_type: "Fajitas", cuisine: "Mexican", on_dinneroo: true, unified_score: 2.85, performance_score: 3.46, opportunity_score: 2.24, tier: "Tier 3: Nice-to-Have", quadrant: "Protect", order_volume: 221},
            {rank: 21, dish_type: "Mac & Cheese", cuisine: "American", on_dinneroo: true, unified_score: 2.80, performance_score: 4.33, opportunity_score: 1.28, tier: "Tier 3: Nice-to-Have", quadrant: "Protect", order_volume: 1322},
            {rank: 22, dish_type: "Shawarma", cuisine: "Middle Eastern", on_dinneroo: true, unified_score: 2.67, performance_score: 3.64, opportunity_score: 1.70, tier: "Tier 4: Monitor", quadrant: "Protect", order_volume: 1355},
            {rank: 23, dish_type: "Butter Chicken", cuisine: "Indian", on_dinneroo: true, unified_score: 2.67, performance_score: 3.10, opportunity_score: 2.24, tier: "Tier 4: Monitor", quadrant: "Protect", order_volume: 650},
            {rank: 24, dish_type: "Tacos", cuisine: "Mexican", on_dinneroo: true, unified_score: 2.65, performance_score: 1.18, opportunity_score: 4.12, tier: "Tier 4: Monitor", quadrant: "Develop", order_volume: 62},
            {rank: 25, dish_type: "Grain Bowl", cuisine: "Healthy", on_dinneroo: true, unified_score: 2.58, performance_score: 1.79, opportunity_score: 3.36, tier: "Tier 4: Monitor", quadrant: "Develop", order_volume: 192},
            {rank: 26, dish_type: "Stir Fry", cuisine: "Asian", on_dinneroo: true, unified_score: 2.14, performance_score: 1.79, opportunity_score: 2.50, tier: "Tier 4: Monitor", quadrant: "Monitor", order_volume: 252},
            {rank: 27, dish_type: "Korean Fried Chicken", cuisine: "Korean", on_dinneroo: true, unified_score: 2.11, performance_score: 1.79, opportunity_score: 2.42, tier: "Tier 4: Monitor", quadrant: "Monitor", order_volume: 398},
            {rank: 28, dish_type: "Burger", cuisine: "American", on_dinneroo: true, unified_score: 2.10, performance_score: 1.18, opportunity_score: 3.01, tier: "Tier 4: Monitor", quadrant: "Develop", order_volume: 61},
            {rank: 29, dish_type: "Roast Dinner", cuisine: "British", on_dinneroo: true, unified_score: 2.01, performance_score: 1.79, opportunity_score: 2.24, tier: "Tier 4: Monitor", quadrant: "Monitor", order_volume: 287},
            {rank: 30, dish_type: "Quesadilla", cuisine: "Mexican", on_dinneroo: true, unified_score: 1.91, performance_score: 2.53, opportunity_score: 1.28, tier: "Tier 4: Monitor", quadrant: "Monitor", order_volume: 57},
            {rank: 31, dish_type: "Veggie Fajitas", cuisine: "Mexican", on_dinneroo: true, unified_score: 1.75, performance_score: 1.79, opportunity_score: 1.70, tier: "Tier 4: Monitor", quadrant: "Monitor", order_volume: 333},
            {rank: 32, dish_type: "Shepherd's Pie", cuisine: "British", on_dinneroo: true, unified_score: 1.63, performance_score: 1.79, opportunity_score: 1.46, tier: "Tier 4: Monitor", quadrant: "Monitor", order_volume: 333},
            {rank: 33, dish_type: "Halloumi Wrap", cuisine: "Global", on_dinneroo: true, unified_score: 1.63, performance_score: 1.79, opportunity_score: 1.46, tier: "Tier 4: Monitor", quadrant: "Monitor", order_volume: 161},
            {rank: 34, dish_type: "Risotto", cuisine: "Italian", on_dinneroo: false, unified_score: null, performance_score: null, opportunity_score: 4.12, tier: "Tier 4: Monitor", quadrant: "Prospect", order_volume: null},
            {rank: 35, dish_type: "Gnocchi", cuisine: "Italian", on_dinneroo: false, unified_score: null, performance_score: null, opportunity_score: 4.12, tier: "Tier 4: Monitor", quadrant: "Prospect", order_volume: null},
            {rank: 36, dish_type: "Filled Pasta", cuisine: "Italian", on_dinneroo: false, unified_score: null, performance_score: null, opportunity_score: 4.12, tier: "Tier 4: Monitor", quadrant: "Prospect", order_volume: null},
            {rank: 37, dish_type: "Baked Pasta", cuisine: "Italian", on_dinneroo: false, unified_score: null, performance_score: null, opportunity_score: 1.28, tier: "Tier 4: Monitor", quadrant: "Monitor", order_volume: null},
            {rank: 38, dish_type: "Gyoza", cuisine: "Japanese", on_dinneroo: false, unified_score: null, performance_score: null, opportunity_score: 4.83, tier: "Tier 4: Monitor", quadrant: "Prospect", order_volume: null},
            {rank: 39, dish_type: "Tempura", cuisine: "Japanese", on_dinneroo: false, unified_score: null, performance_score: null, opportunity_score: 3.77, tier: "Tier 4: Monitor", quadrant: "Prospect", order_volume: null},
            {rank: 40, dish_type: "Udon", cuisine: "Japanese", on_dinneroo: false, unified_score: null, performance_score: null, opportunity_score: 2.24, tier: "Tier 4: Monitor", quadrant: "Monitor", order_volume: null},
            {rank: 41, dish_type: "Sweet & Sour", cuisine: "Chinese", on_dinneroo: false, unified_score: null, performance_score: null, opportunity_score: 3.23, tier: "Tier 4: Monitor", quadrant: "Prospect", order_volume: null},
            {rank: 42, dish_type: "Spring Rolls", cuisine: "Chinese", on_dinneroo: false, unified_score: null, performance_score: null, opportunity_score: 1.11, tier: "Tier 4: Monitor", quadrant: "Monitor", order_volume: null},
            {rank: 43, dish_type: "Dim Sum", cuisine: "Chinese", on_dinneroo: false, unified_score: null, performance_score: null, opportunity_score: 2.64, tier: "Tier 4: Monitor", quadrant: "Monitor", order_volume: null},
            {rank: 44, dish_type: "Peking Duck", cuisine: "Chinese", on_dinneroo: false, unified_score: null, performance_score: null, opportunity_score: 4.91, tier: "Tier 4: Monitor", quadrant: "Prospect", order_volume: null},
            {rank: 45, dish_type: "Thai Curry", cuisine: "Thai", on_dinneroo: true, unified_score: null, performance_score: null, opportunity_score: 4.81, tier: "Tier 4: Monitor", quadrant: "Develop", order_volume: null},
            {rank: 46, dish_type: "Tom Yum", cuisine: "Thai", on_dinneroo: false, unified_score: null, performance_score: null, opportunity_score: 4.95, tier: "Tier 4: Monitor", quadrant: "Prospect", order_volume: null},
            {rank: 47, dish_type: "Satay", cuisine: "Thai", on_dinneroo: false, unified_score: null, performance_score: null, opportunity_score: 4.83, tier: "Tier 4: Monitor", quadrant: "Prospect", order_volume: null},
            {rank: 48, dish_type: "Banh Mi", cuisine: "Vietnamese", on_dinneroo: false, unified_score: null, performance_score: null, opportunity_score: 4.43, tier: "Tier 4: Monitor", quadrant: "Prospect", order_volume: null},
            {rank: 49, dish_type: "Bibimbap", cuisine: "Korean", on_dinneroo: false, unified_score: null, performance_score: null, opportunity_score: 2.50, tier: "Tier 4: Monitor", quadrant: "Monitor", order_volume: null},
            {rank: 50, dish_type: "Bulgogi", cuisine: "Korean", on_dinneroo: false, unified_score: null, performance_score: null, opportunity_score: 4.43, tier: "Tier 4: Monitor", quadrant: "Prospect", order_volume: null}
        ];
        
        function initDishPrioritization() {
            // Create 2x2 Scatter Chart for dishes ON Dinneroo
            const onDinneroo = dishData.filter(d => d.on_dinneroo && d.performance_score !== null);
            
            const quadrantColors = {
                'Priority': '#22c55e',
                'Protect': '#3b82f6',
                'Develop': '#f59e0b',
                'Monitor': '#64748b'
            };
            
            new Chart(document.getElementById('dishScatterChart'), {
                type: 'scatter',
                data: {
                    datasets: [{
                        data: onDinneroo.map(d => ({
                            x: d.performance_score,
                            y: d.opportunity_score,
                            label: d.dish_type
                        })),
                        backgroundColor: onDinneroo.map(d => quadrantColors[d.quadrant] || '#64748b'),
                        pointRadius: 8,
                        pointHoverRadius: 12
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const d = onDinneroo[context.dataIndex];
                                    return `${d.dish_type}: Perf ${d.performance_score.toFixed(1)}, Opp ${d.opportunity_score.toFixed(1)}`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            min: 0, max: 5.5,
                            title: { display: true, text: 'Performance Score', color: '#a0a0b0' },
                            grid: { color: '#2a2a3a' }
                        },
                        y: {
                            min: 0, max: 5.5,
                            title: { display: true, text: 'Opportunity Score', color: '#a0a0b0' },
                            grid: { color: '#2a2a3a' }
                        }
                    }
                },
                plugins: [{
                    afterDraw: function(chart) {
                        const ctx = chart.ctx;
                        const xAxis = chart.scales.x;
                        const yAxis = chart.scales.y;
                        
                        // Draw quadrant lines
                        ctx.save();
                        ctx.setLineDash([5, 5]);
                        ctx.strokeStyle = 'rgba(255, 255, 255, 0.3)';
                        ctx.lineWidth = 1;
                        
                        // Vertical line at x=3.5
                        const x35 = xAxis.getPixelForValue(3.5);
                        ctx.beginPath();
                        ctx.moveTo(x35, yAxis.top);
                        ctx.lineTo(x35, yAxis.bottom);
                        ctx.stroke();
                        
                        // Horizontal line at y=3.0
                        const y30 = yAxis.getPixelForValue(3.0);
                        ctx.beginPath();
                        ctx.moveTo(xAxis.left, y30);
                        ctx.lineTo(xAxis.right, y30);
                        ctx.stroke();
                        
                        ctx.restore();
                    }
                }]
            });
            
            // Create Quadrant Distribution Donut
            const quadrantCounts = {
                'Priority': dishData.filter(d => d.quadrant === 'Priority').length,
                'Protect': dishData.filter(d => d.quadrant === 'Protect').length,
                'Develop': dishData.filter(d => d.quadrant === 'Develop').length,
                'Monitor': dishData.filter(d => d.quadrant === 'Monitor').length,
                'Prospect': dishData.filter(d => d.quadrant === 'Prospect').length
            };
            
            new Chart(document.getElementById('quadrantDonutChart'), {
                type: 'doughnut',
                data: {
                    labels: Object.keys(quadrantCounts),
                    datasets: [{
                        data: Object.values(quadrantCounts),
                        backgroundColor: ['#22c55e', '#3b82f6', '#f59e0b', '#64748b', '#8b5cf6'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '60%',
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: { padding: 15, usePointStyle: true, pointStyle: 'circle' }
                        }
                    }
                }
            });
            
            // Populate dish table
            populateDishTable(dishData);
        }
        
        function populateDishTable(data) {
            const tbody = document.getElementById('dishes-table-body');
            tbody.innerHTML = data.map(d => {
                const tierClass = d.tier.includes('Must-Have') ? 'validated' : 
                                  d.tier.includes('Should-Have') ? 'corroborated' : 'single';
                const quadrantColor = {
                    'Priority': 'validated',
                    'Protect': 'single',
                    'Develop': 'corroborated',
                    'Monitor': 'single',
                    'Prospect': 'corroborated'
                }[d.quadrant] || 'single';
                
                return `<tr>
                    <td class="bucket">${d.rank}</td>
                    <td class="bucket">${d.dish_type}</td>
                    <td>${d.cuisine}</td>
                    <td>${d.on_dinneroo ? 'Yes' : 'No'}</td>
                    <td><span class="evidence-badge ${tierClass}">${d.tier.replace('Tier ', 'T')}</span></td>
                    <td><span class="evidence-badge ${quadrantColor}">${d.quadrant}</span></td>
                    <td>${d.unified_score !== null ? d.unified_score.toFixed(2) : '-'}</td>
                    <td>${d.performance_score !== null ? d.performance_score.toFixed(2) : '-'}</td>
                    <td>${d.opportunity_score !== null ? d.opportunity_score.toFixed(2) : '-'}</td>
                </tr>`;
            }).join('');
            document.getElementById('dish-table-count').textContent = data.length;
        }
        
        function filterDishTable() {
            const tierFilter = document.getElementById('dishTierFilter').value;
            const quadrantFilter = document.getElementById('dishQuadrantFilter').value;
            
            let filtered = dishData;
            if (tierFilter !== 'all') {
                filtered = filtered.filter(d => d.tier === tierFilter);
            }
            if (quadrantFilter !== 'all') {
                filtered = filtered.filter(d => d.quadrant === quadrantFilter);
            }
            populateDishTable(filtered);
        }
        
        // ============================================================
        // CUISINE GAPS DATA & FUNCTIONS
        // ============================================================
        
        // Cuisine Gap Data (from cuisine_gap_analysis.csv)
        const cuisineGapData = [
            {cuisine: "British", item_count: 292, brand_count: 1, avg_rating: 4.50, order_count: 3358, gap_type: "OK", supply_vs_avg: 152.4},
            {cuisine: "Chinese", item_count: 46, brand_count: 3, avg_rating: 4.38, order_count: 849, gap_type: "SUPPLY GAP", supply_vs_avg: 24.0},
            {cuisine: "French", item_count: 15, brand_count: 1, avg_rating: 4.42, order_count: 978, gap_type: "SUPPLY GAP", supply_vs_avg: 7.8},
            {cuisine: "Healthy/Fresh", item_count: 109, brand_count: 4, avg_rating: 4.45, order_count: 2636, gap_type: "OK", supply_vs_avg: 56.9},
            {cuisine: "Indian", item_count: 85, brand_count: 6, avg_rating: 4.39, order_count: 10183, gap_type: "OK", supply_vs_avg: 44.4},
            {cuisine: "Irish/British", item_count: 3, brand_count: 1, avg_rating: 4.22, order_count: 36, gap_type: "SUPPLY GAP", supply_vs_avg: 1.6},
            {cuisine: "Italian", item_count: 705, brand_count: 6, avg_rating: 4.12, order_count: 8385, gap_type: "OK", supply_vs_avg: 368.1},
            {cuisine: "Japanese", item_count: 282, brand_count: 5, avg_rating: 4.51, order_count: 3788, gap_type: "OK", supply_vs_avg: 147.2},
            {cuisine: "Japanese/Asian", item_count: 410, brand_count: 1, avg_rating: 4.25, order_count: 14129, gap_type: "OK", supply_vs_avg: 214.1},
            {cuisine: "Mexican", item_count: 168, brand_count: 2, avg_rating: 3.94, order_count: 1479, gap_type: "QUALITY GAP", supply_vs_avg: 87.7},
            {cuisine: "Middle Eastern", item_count: 30, brand_count: 5, avg_rating: 4.67, order_count: 1023, gap_type: "SUPPLY GAP", supply_vs_avg: 15.7},
            {cuisine: "Thai/Southeast Asian", item_count: 207, brand_count: 3, avg_rating: 4.43, order_count: 10224, gap_type: "OK", supply_vs_avg: 108.1},
            {cuisine: "Vietnamese", item_count: 138, brand_count: 1, avg_rating: 4.56, order_count: 14055, gap_type: "OK", supply_vs_avg: 72.0}
        ];
        
        // Recruitment Priorities Data (from recruitment_priorities.csv)
        const recruitmentData = [
            {zone: "Finsbury Park / Harringay / Crouch End", priority: "High", orders: 1534, missing: "Japanese/Asian, Italian, Thai/Southeast Asian", action: "Recruit Japanese/Asian, Italian partners"},
            {zone: "Canning Town", priority: "High", orders: 1314, missing: "Japanese/Asian, Vietnamese, Italian", action: "Recruit Japanese/Asian, Vietnamese partners"},
            {zone: "Surrey Quays", priority: "High", orders: 1139, missing: "Japanese/Asian, Vietnamese, Italian", action: "Recruit Japanese/Asian, Vietnamese partners"},
            {zone: "Wapping and Mile End", priority: "High", orders: 961, missing: "Japanese/Asian, Vietnamese, Italian", action: "Recruit Japanese/Asian, Vietnamese partners"},
            {zone: "Brockley / Forest Hill", priority: "Medium", orders: 1478, missing: "Italian, Thai/Southeast Asian", action: "Recruit Italian, Thai partners"},
            {zone: "Wandsworth", priority: "Medium", orders: 853, missing: "Vietnamese, Thai/Southeast Asian", action: "Recruit Vietnamese, Thai partners"},
            {zone: "Hampstead", priority: "Medium", orders: 797, missing: "Vietnamese, Italian", action: "Recruit Vietnamese, Italian partners"},
            {zone: "Edinburgh Central", priority: "Medium", orders: 722, missing: "Japanese/Asian, Indian", action: "Recruit Japanese/Asian, Indian partners"},
            {zone: "South Kensington", priority: "High", orders: 676, missing: "Japanese/Asian, Vietnamese, Indian", action: "Recruit Japanese/Asian, Vietnamese partners"},
            {zone: "Stratford", priority: "Medium", orders: 665, missing: "Indian, Thai/Southeast Asian", action: "Recruit Indian, Thai partners"}
        ];
        
        function initCuisineGaps() {
            // Create Cuisine Supply Bar Chart
            const sortedCuisines = [...cuisineGapData].sort((a, b) => b.supply_vs_avg - a.supply_vs_avg);
            
            new Chart(document.getElementById('cuisineSupplyChart'), {
                type: 'bar',
                data: {
                    labels: sortedCuisines.map(c => c.cuisine.length > 12 ? c.cuisine.substring(0, 12) + '...' : c.cuisine),
                    datasets: [{
                        label: 'Supply vs Avg %',
                        data: sortedCuisines.map(c => c.supply_vs_avg),
                        backgroundColor: sortedCuisines.map(c => {
                            if (c.gap_type === 'SUPPLY GAP') return '#f59e0b';
                            if (c.gap_type === 'QUALITY GAP') return '#ef4444';
                            return '#00d4aa';
                        }),
                        borderRadius: 4
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const c = sortedCuisines[context.dataIndex];
                                    return `${c.supply_vs_avg.toFixed(1)}% of avg (${c.gap_type})`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: { color: '#2a2a3a' },
                            title: { display: true, text: '% of Average Supply', color: '#a0a0b0' }
                        },
                        y: { grid: { display: false } }
                    }
                }
            });
            
            // Create Gap Type Donut
            const gapCounts = {
                'OK': cuisineGapData.filter(c => c.gap_type === 'OK').length,
                'Supply Gap': cuisineGapData.filter(c => c.gap_type === 'SUPPLY GAP').length,
                'Quality Gap': cuisineGapData.filter(c => c.gap_type === 'QUALITY GAP').length
            };
            
            new Chart(document.getElementById('gapTypeDonutChart'), {
                type: 'doughnut',
                data: {
                    labels: Object.keys(gapCounts),
                    datasets: [{
                        data: Object.values(gapCounts),
                        backgroundColor: ['#00d4aa', '#f59e0b', '#ef4444'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '60%',
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: { padding: 20, usePointStyle: true, pointStyle: 'circle' }
                        }
                    }
                }
            });
            
            // Populate cuisine gaps table
            const gapsTableBody = document.getElementById('cuisine-gaps-table-body');
            gapsTableBody.innerHTML = cuisineGapData.map(c => {
                const gapClass = c.gap_type === 'OK' ? 'validated' : 
                                 c.gap_type === 'SUPPLY GAP' ? 'corroborated' : 'single';
                const gapLabel = c.gap_type === 'OK' ? 'OK' : 
                                 c.gap_type === 'SUPPLY GAP' ? 'Supply Gap' : 'Quality Gap';
                return `<tr>
                    <td class="bucket">${c.cuisine}</td>
                    <td><span class="evidence-badge ${gapClass}">${gapLabel}</span></td>
                    <td>${c.item_count}</td>
                    <td>${c.brand_count}</td>
                    <td>${c.avg_rating.toFixed(2)}</td>
                    <td>${c.order_count.toLocaleString()}</td>
                    <td>${c.supply_vs_avg.toFixed(1)}%</td>
                </tr>`;
            }).join('');
            
            // Populate recruitment priorities table
            const recruitmentTableBody = document.getElementById('recruitment-table-body');
            recruitmentTableBody.innerHTML = recruitmentData.map(r => {
                const priorityClass = r.priority === 'High' ? 'validated' : 'corroborated';
                return `<tr>
                    <td class="bucket">${r.zone}</td>
                    <td><span class="evidence-badge ${priorityClass}">${r.priority}</span></td>
                    <td>${r.orders.toLocaleString()}</td>
                    <td>${r.missing}</td>
                    <td>${r.action}</td>
                </tr>`;
            }).join('');
        }
    </script>
    
    <!-- Zone Detail Panel -->
    <div class="zone-detail-overlay" id="zone-detail-overlay" onclick="closeZoneDetail()"></div>
    <div class="zone-detail-panel" id="zone-detail-panel">
        <div class="zone-detail-header">
            <div>
                <h2 id="detail-zone-name">Zone Name</h2>
                <span id="detail-zone-region" style="color: var(--text-muted); font-size: 0.85rem;"></span>
            </div>
            <button class="zone-detail-close" onclick="closeZoneDetail()">√ó</button>
        </div>
        <div class="zone-detail-content">
            <!-- Route to MVP Progress -->
            <div class="zone-detail-section">
                <div class="mvp-progress-header">
                    <span class="mvp-progress-title">Route to MVP</span>
                    <span class="mvp-progress-pct" id="detail-progress-pct">0%</span>
                </div>
                <div class="mvp-progress-bar">
                    <div class="mvp-progress-fill" id="detail-progress-bar" style="width: 0%;"></div>
                </div>
            </div>
            
            <!-- Key Metrics -->
            <div class="zone-detail-section">
                <h4>Key Metrics</h4>
                <div class="zone-metrics-grid" id="detail-metrics"></div>
            </div>
            
            <!-- Cuisine Coverage (Anna's 7) -->
            <div class="zone-detail-section coverage-section">
                <div class="coverage-header">
                    <span class="coverage-title">Cuisine Coverage</span>
                    <span class="coverage-count" id="detail-cuisine-count">0/7</span>
                </div>
                <div class="coverage-grid" id="detail-cuisine-coverage"></div>
            </div>
            
            <!-- Core Drivers Coverage (8) -->
            <div class="zone-detail-section coverage-section">
                <div class="coverage-header">
                    <span class="coverage-title">Core Drivers</span>
                    <span class="coverage-count" id="detail-driver-count">0/8</span>
                </div>
                <div class="coverage-grid" id="detail-driver-coverage"></div>
            </div>
            
            <!-- Priority Actions -->
            <div class="zone-detail-section priority-actions">
                <h4>Priority Actions</h4>
                <div id="detail-priority-actions"></div>
            </div>
        </div>
    </div>
    
    <script>
        // ============================================================
        // ZONE DETAIL PANEL - Load from zone_analysis.json
        // ============================================================
        
        let zoneAnalysisData = null;
        
        // Load zone analysis data from JSON or embedded data
        async function loadZoneAnalysisData() {
            // First check if embedded data is available (from zone_data.js)
            if (typeof zoneAnalysisDataEmbedded !== 'undefined') {
                console.log('Using embedded zone data');
                zoneAnalysisData = zoneAnalysisDataEmbedded;
                updateZoneTableWithAnalysisData();
                return;
            }
            
            // Try loading from JSON files
            try {
                let response = await fetch('./zone_analysis.json');
                if (!response.ok) {
                    response = await fetch('../../docs/data/zone_analysis.json');
                }
                if (!response.ok) {
                    throw new Error('Failed to load zone_analysis.json');
                }
                zoneAnalysisData = await response.json();
                console.log('Loaded zone analysis data from JSON');
                updateZoneTableWithAnalysisData();
            } catch (error) {
                console.error('Error loading zone analysis data:', error);
                document.getElementById('zones-table-body').innerHTML = `
                    <tr>
                        <td colspan="8" style="text-align: center; padding: 2rem; color: var(--text-muted);">
                            Error loading zone data. Please ensure zone_data.js is in the same directory.
                        </td>
                    </tr>
                `;
            }
        }
        
        function updateZoneTableWithAnalysisData() {
            // Filter to zones with orders
            const zonesWithOrders = zoneAnalysisData.zones.filter(z => z.orders && z.orders > 0);
            
            // Update KPI counts
            const mvpReady = zonesWithOrders.filter(z => z.mvp_status === 'MVP Ready').length;
            const nearMvp = zonesWithOrders.filter(z => z.mvp_status === 'Near MVP').length;
            const developing = zonesWithOrders.filter(z => z.mvp_status === 'Developing').length;
            
            document.getElementById('mvp-ready-count').textContent = mvpReady;
            document.getElementById('near-mvp-count').textContent = nearMvp;
            document.getElementById('developing-count').textContent = developing;
            
            // Populate region filter from data
            populateRegionFilter();
            
            // Set initial sort indicator
            const ordersHeader = document.querySelector('#zone-data-table th[data-sort="orders"]');
            if (ordersHeader) {
                ordersHeader.classList.add('active', 'desc');
                ordersHeader.querySelector('.sort-indicator').textContent = '‚ñº';
            }
            
            // Update total count
            document.getElementById('zone-total-count').textContent = zonesWithOrders.length;
            
            // Filter and render table (applies default sort)
            filterZoneTable();
        }
        
        function populateZoneTableWithChecklist(data) {
            const tbody = document.getElementById('zones-table-body');
            tbody.innerHTML = data.map(z => {
                const status = z.mvp_status || 'Developing';
                const statusClass = status === 'MVP Ready' ? 'validated' : 
                                   (status === 'Near MVP' ? 'corroborated' : 'single');
                const progress = z.progress?.overall_pct || 0;
                const progressColor = progress >= 80 ? '#00d4aa' : progress >= 50 ? '#f59e0b' : '#f43f5e';
                
                return `<tr class="clickable" onclick="openZoneDetail('${z.zone.replace(/'/g, "\\'")}')">
                    <td class="bucket">${z.zone}</td>
                    <td>${z.region || '-'}</td>
                    <td><span class="evidence-badge ${statusClass}">${status}</span></td>
                    <td>${(z.orders || 0).toLocaleString()}</td>
                    <td>${z.partners || 0}</td>
                    <td>${z.cuisines_count || 0}</td>
                    <td>${z.avg_rating ? z.avg_rating.toFixed(2) : '-'}</td>
                    <td>
                        <div class="progress-mini">
                            <div class="progress-mini-bar">
                                <div class="progress-mini-fill" style="width: ${progress}%; background: ${progressColor};"></div>
                            </div>
                            <span class="progress-mini-text">${progress}%</span>
                        </div>
                    </td>
                </tr>`;
            }).join('');
            document.getElementById('zone-table-count').textContent = data.length;
        }
        
        function openZoneDetail(zoneName) {
            if (!zoneAnalysisData?.zones) {
                console.error('Zone analysis data not loaded');
                return;
            }
            
            const zone = zoneAnalysisData.zones.find(z => z.zone === zoneName);
            if (!zone) {
                console.error('Zone not found:', zoneName);
                return;
            }
            
            document.getElementById('detail-zone-name').textContent = zone.zone;
            document.getElementById('detail-zone-region').textContent = `${zone.city || ''} ¬∑ ${zone.region}`;
            
            // Route to MVP Progress
            // Fields are directly on zone object, not under mvp_checklist
            const checklist = zone;
            const progress = zone.progress || { cuisines: '0/7', core_drivers: '0/8', overall_pct: 0 };
            
            document.getElementById('detail-progress-pct').textContent = `${progress.overall_pct}%`;
            document.getElementById('detail-progress-bar').style.width = `${progress.overall_pct}%`;
            document.getElementById('detail-cuisine-count').textContent = progress.cuisines;
            document.getElementById('detail-driver-count').textContent = progress.core_drivers;
            
            // Metrics
            document.getElementById('detail-metrics').innerHTML = `
                <div class="zone-metric">
                    <div class="zone-metric-value">${(zone.orders || 0).toLocaleString()}</div>
                    <div class="zone-metric-label">Orders</div>
                </div>
                <div class="zone-metric">
                    <div class="zone-metric-value">${zone.partners}</div>
                    <div class="zone-metric-label">Partners</div>
                </div>
                <div class="zone-metric">
                    <div class="zone-metric-value">${zone.cuisines_count}</div>
                    <div class="zone-metric-label">Cuisines</div>
                </div>
                <div class="zone-metric">
                    <div class="zone-metric-value">${zone.total_dishes}</div>
                    <div class="zone-metric-label">Dishes</div>
                </div>
                <div class="zone-metric">
                    <div class="zone-metric-value">${zone.avg_rating ? zone.avg_rating.toFixed(1) : 'N/A'}</div>
                    <div class="zone-metric-label">Rating</div>
                </div>
                <div class="zone-metric">
                    <div class="zone-metric-value">${zone.health_score}</div>
                    <div class="zone-metric-label">Health</div>
                </div>
            `;
            
            // Cuisine Coverage (Anna's 7)
            const cuisineCoverage = zone.cuisine_coverage || {};
            const cuisineNames = {
                'asian': 'Asian',
                'italian': 'Italian',
                'indian': 'Indian',
                'healthy': 'Healthy',
                'mexican': 'Mexican',
                'middle_eastern': 'Middle Eastern',
                'british': 'British'
            };
            
            document.getElementById('detail-cuisine-coverage').innerHTML = Object.entries(cuisineNames).map(([key, name]) => {
                const data = cuisineCoverage[key] || { has: false, dishes: 0 };
                return `
                    <div class="coverage-item ${data.has ? 'has' : 'missing'}">
                        <span class="coverage-item-icon">${data.has ? '‚úì' : '‚úó'}</span>
                        <span class="coverage-item-name">${name}</span>
                        <span class="coverage-item-count">${data.dishes} dishes</span>
                    </div>
                `;
            }).join('');
            
            // Core Driver Coverage (8)
            const driverCoverage = zone.core_driver_coverage || {};
            const driverNames = {
                'pho': 'Pho',
                'south_asian___indian_curry': 'Indian Curry',
                'biryani': 'Biryani',
                'fried_rice': 'Fried Rice',
                'sushi': 'Sushi',
                'katsu': 'Katsu',
                'rice_bowl': 'Rice Bowl',
                'noodles': 'Noodles'
            };
            
            document.getElementById('detail-driver-coverage').innerHTML = Object.entries(driverNames).map(([key, name]) => {
                const data = driverCoverage[key] || { has: false, blocked_by: null };
                return `
                    <div class="coverage-item ${data.has ? 'has' : 'missing'}" title="${data.blocked_by || ''}">
                        <span class="coverage-item-icon">${data.has ? '‚úì' : '‚úó'}</span>
                        <span class="coverage-item-name">${name}</span>
                    </div>
                `;
            }).join('');
            
            // Priority Actions
            const actions = zone.priority_actions || [];
            if (actions.length > 0) {
                document.getElementById('detail-priority-actions').innerHTML = actions.map((action, i) => `
                    <div class="priority-action">
                        <span class="priority-action-number">${i + 1}</span>
                        <div class="priority-action-content">
                            <div class="priority-action-gap">${action.gap}</div>
                            <div class="priority-action-text">${action.action}</div>
                            <div class="priority-action-impact">‚Üí ${action.impact}</div>
                        </div>
                    </div>
                `).join('');
            } else {
                document.getElementById('detail-priority-actions').innerHTML = `
                    <div style="padding: 1rem; background: rgba(0, 212, 170, 0.1); border-radius: 8px; text-align: center;">
                        <span style="color: var(--accent-teal);">‚úì All cuisines and Core Drivers covered!</span>
                    </div>
                `;
            }
            
            document.getElementById('zone-detail-panel').classList.add('open');
            document.getElementById('zone-detail-overlay').classList.add('visible');
        }
        
        function closeZoneDetail() {
            document.getElementById('zone-detail-panel').classList.remove('open');
            document.getElementById('zone-detail-overlay').classList.remove('visible');
        }
        
        // Load zone analysis data on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadZoneAnalysisData();
        });

        // Export Functions
        function downloadCSV(data, filename) {
            const blob = new Blob([data], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = filename;
            link.click();
        }
        
        function exportZoneChecklist() {
            const csv = `Zone Name,MVP Status,Partners,Cuisines,Missing Cuisines,Priority Actions,Source
Birmingham Central,NEAR MVP,4,6,Mexican,Recruit Tortilla,zone_mvp_status.json
Manchester North,AT MVP,5,7,None,-,zone_mvp_status.json
Leeds West,NEAR MVP,3,5,"Indian, Mexican","Recruit Dishoom, Tortilla",zone_mvp_status.json
Liverpool,BUILDING,2,4,"Indian, Chinese, Mexican",Priority partner recruitment,zone_mvp_status.json
Edinburgh,AT MVP,6,8,None,-,zone_mvp_status.json`;
            downloadCSV(csv, 'dinneroo_zone_checklist_' + new Date().toISOString().slice(0,10) + '.csv');
            alert('‚úÖ Zone Checklist exported!');
        }
        
        function exportRecruitmentBrief() {
            const csv = `Priority,Dish Type,Score,Latent Mentions,Zone Gaps,Recommended Partners,Source
1,Veggie Platter,5.2,87,89,"Leon, Itsu",latent_demand.json
2,Grilled Chicken,5.1,45,67,"Nando's",dish_why_metrics.json
3,Kids Mild Curry,4.9,74,52,Dishoom,barriers.json
4,Tacos,4.7,34,45,Tortilla,latent_demand.json
5,Rice Bowl,4.5,38,67,Wagamama,dish_why_metrics.json`;
            downloadCSV(csv, 'dinneroo_recruitment_brief_' + new Date().toISOString().slice(0,10) + '.csv');
            alert('‚úÖ Recruitment Brief exported!');
        }
        
        function exportSegmentData() {
            const csv = `Segment,Pct of Orders,Satisfaction,Top Driver 1,Top Driver 2,Top Driver 3,Confidence,Source
Family,46%,85.6%,Kids will eat it (95%),Value for money (89%),Variety (84%),HIGH,decision_drivers.json
Couple,23%,87.1%,Quality of food (92%),Cuisine variety (88%),Value (85%),HIGH,decision_drivers.json
Single,12%,82.4%,Value for money (91%),Portion flexibility (84%),Speed (79%),MEDIUM,decision_drivers.json
Friends,4%,88.2%,Shareable portions (89%),Variety (86%),Social fit (82%),LOW,decision_drivers.json
Mixed,16%,84.5%,Pleases multiple (93%),Flexible ordering (87%),Value (84%),MEDIUM,decision_drivers.json`;
            downloadCSV(csv, 'dinneroo_segment_insights_' + new Date().toISOString().slice(0,10) + '.csv');
            alert('‚úÖ Segment Insights exported!');
        }
        
        function exportPartnerBrief() {
            const csv = `Partner,Status,Cuisines,Zone Impact,Why Recommended,Priority,Source
Wagamama,IN ZONE (34),Asian,+25 zones,Top performer - expand menu to add Rice Bowl,1,partner_coverage.json
Dishoom,ON PLATFORM,Indian,+15 zones,Premium Indian fills 32 Near MVP gaps,2,partner_coverage.json
Tortilla,ON PLATFORM,Mexican,+10 zones,Fills Mexican gaps in 10 Near MVP zones,3,partner_coverage.json
Nando's,IN ZONE (45),American,+8 zones,Expand Grilled Chicken offerings,4,partner_coverage.json
Masala Zone,NOT ON PLATFORM,Indian,+8 zones,12 latent demand mentions - affordable Indian,5,latent_demand.json`;
            downloadCSV(csv, 'dinneroo_partner_brief_' + new Date().toISOString().slice(0,10) + '.csv');
            alert('‚úÖ Partner Brief exported!');
        }
        

        // Segment Toggle Function
        function filterBySegment(segment) {
            // Update active button
            document.querySelectorAll('[id^="btn-"]').forEach(btn => btn.classList.remove('active'));
            document.getElementById('btn-' + segment).classList.add('active');
            
            // Show notification
            const segmentNames = {
                'all': 'All Segments',
                'family': 'Family (46%)',
                'couple': 'Couple (23%)'
            };
            
            // For now, show a visual indicator
            console.log('Filtering by: ' + segmentNames[segment]);
            
            // In a full implementation, this would filter the table data
            // For demo, we just show the selection
        }
        
        // Threshold Simulator
        function updateThresholdSimulator(value) {
            const label = document.getElementById('simulator-value');
            if (label) {
                label.textContent = value;
                // Update zone count based on threshold
                const zoneEstimates = {3: 137, 4: 101, 5: 70, 6: 45, 7: 17};
                const estimate = zoneEstimates[value] || 70;
                const estLabel = document.getElementById('simulator-zones');
                if (estLabel) estLabel.textContent = estimate + ' zones';
            }
        }
        
    </script>
</body>
</html>

