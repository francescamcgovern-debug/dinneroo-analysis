<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zone Analysis | Dinneroo Analytics</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=IBM+Plex+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0b0d12;
            --bg-secondary: #12151c;
            --bg-card: #181c25;
            --bg-card-hover: #1f242f;
            --bg-elevated: #252a36;
            --border: #2a303d;
            --border-light: #3a4150;
            
            --text-primary: #f4f5f7;
            --text-secondary: #9ca3b0;
            --text-muted: #6b7280;
            
            --accent-emerald: #10b981;
            --accent-emerald-dim: rgba(16, 185, 129, 0.15);
            --accent-violet: #8b5cf6;
            --accent-violet-dim: rgba(139, 92, 246, 0.15);
            --accent-amber: #f59e0b;
            --accent-amber-dim: rgba(245, 158, 11, 0.15);
            --accent-sky: #0ea5e9;
            --accent-sky-dim: rgba(14, 165, 233, 0.15);
            --accent-rose: #f43f5e;
            --accent-rose-dim: rgba(244, 63, 94, 0.15);
            
            --success: #22c55e;
            --warning: #eab308;
            --danger: #ef4444;
            --info: #3b82f6;
            
            --gradient-primary: linear-gradient(135deg, var(--accent-emerald), var(--accent-violet));
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'DM Sans', -apple-system, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
        }
        
        /* Header */
        .header {
            background: rgba(11, 13, 18, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border);
            padding: 1rem 2rem;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header-content {
            max-width: 1600px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .logo-icon {
            width: 42px;
            height: 42px;
            background: var(--gradient-primary);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.25rem;
        }
        
        .logo-text h1 {
            font-size: 1.25rem;
            font-weight: 700;
            letter-spacing: -0.02em;
        }
        
        .logo-text span {
            font-size: 0.75rem;
            color: var(--text-muted);
        }
        
        .header-stats {
            display: flex;
            gap: 2rem;
            align-items: center;
        }
        
        .header-stat {
            text-align: right;
        }
        
        .header-stat-value {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--accent-emerald);
        }
        
        .header-stat-label {
            font-size: 0.7rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .back-link {
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: color 0.2s;
        }
        
        .back-link:hover { color: var(--accent-emerald); }
        
        /* Main Container */
        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        /* Section Title */
        .section-header {
            margin-bottom: 2rem;
        }
        
        .section-title {
            font-size: 1.75rem;
            font-weight: 700;
            letter-spacing: -0.02em;
            margin-bottom: 0.5rem;
        }
        
        .section-subtitle {
            color: var(--text-secondary);
            font-size: 1rem;
        }
        
        /* Data Source Badge */
        .data-source-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: var(--accent-emerald-dim);
            color: var(--accent-emerald);
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-size: 0.8rem;
            font-weight: 500;
            margin-bottom: 1.5rem;
        }
        
        /* KPI Grid */
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        @media (max-width: 1400px) {
            .kpi-grid { grid-template-columns: repeat(3, 1fr); }
        }
        
        @media (max-width: 768px) {
            .kpi-grid { grid-template-columns: repeat(2, 1fr); }
        }
        
        .kpi-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 1.25rem;
            position: relative;
            overflow: hidden;
            transition: all 0.2s;
        }
        
        .kpi-card:hover {
            transform: translateY(-2px);
            border-color: var(--border-light);
        }
        
        .kpi-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
        }
        
        .kpi-card.emerald::before { background: var(--accent-emerald); }
        .kpi-card.violet::before { background: var(--accent-violet); }
        .kpi-card.amber::before { background: var(--accent-amber); }
        .kpi-card.sky::before { background: var(--accent-sky); }
        .kpi-card.rose::before { background: var(--accent-rose); }
        .kpi-card.success::before { background: var(--success); }
        
        .kpi-label {
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-muted);
            margin-bottom: 0.5rem;
        }
        
        .kpi-value {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 2rem;
            font-weight: 600;
            line-height: 1;
            margin-bottom: 0.25rem;
        }
        
        .kpi-card.emerald .kpi-value { color: var(--accent-emerald); }
        .kpi-card.violet .kpi-value { color: var(--accent-violet); }
        .kpi-card.amber .kpi-value { color: var(--accent-amber); }
        .kpi-card.sky .kpi-value { color: var(--accent-sky); }
        .kpi-card.rose .kpi-value { color: var(--accent-rose); }
        .kpi-card.success .kpi-value { color: var(--success); }
        
        .kpi-detail {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }
        
        /* Tabs */
        .tabs {
            display: flex;
            gap: 0.25rem;
            background: var(--bg-secondary);
            padding: 0.25rem;
            border-radius: 12px;
            margin-bottom: 2rem;
            overflow-x: auto;
        }
        
        .tab-btn {
            padding: 0.75rem 1.5rem;
            background: transparent;
            border: none;
            color: var(--text-secondary);
            font-family: inherit;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.2s;
            white-space: nowrap;
        }
        
        .tab-btn:hover {
            color: var(--text-primary);
            background: var(--bg-card);
        }
        
        .tab-btn.active {
            background: var(--bg-card);
            color: var(--accent-emerald);
        }
        
        /* Tab Panels */
        .tab-panel {
            display: none;
            animation: fadeIn 0.3s ease;
        }
        
        .tab-panel.active { display: block; }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Charts Grid */
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        @media (max-width: 1024px) {
            .charts-grid { grid-template-columns: 1fr; }
        }
        
        .chart-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 1.5rem;
        }
        
        .chart-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .chart-badge {
            font-size: 0.65rem;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-weight: 500;
        }
        
        .chart-badge.ground-truth {
            background: var(--accent-emerald-dim);
            color: var(--accent-emerald);
        }
        
        .chart-container {
            height: 300px;
            position: relative;
        }
        
        /* Filters */
        .filters-bar {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            align-items: center;
            margin-bottom: 1.5rem;
            padding: 1rem;
            background: var(--bg-secondary);
            border-radius: 12px;
        }
        
        .filter-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .filter-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }
        
        .filter-select, .filter-input {
            padding: 0.5rem 1rem;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            font-family: inherit;
            font-size: 0.85rem;
            min-width: 150px;
        }
        
        .filter-select:focus, .filter-input:focus {
            outline: none;
            border-color: var(--accent-emerald);
        }
        
        .search-input {
            flex: 1;
            min-width: 200px;
            max-width: 300px;
        }
        
        .filter-count {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-left: auto;
        }
        
        /* Data Table */
        .table-wrapper {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            overflow: hidden;
        }
        
        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--border);
        }
        
        .table-title {
            font-weight: 600;
        }
        
        .table-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        .table-scroll {
            overflow-x: auto;
            max-height: 600px;
            overflow-y: auto;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85rem;
        }
        
        .data-table th {
            background: var(--bg-secondary);
            padding: 0.75rem 1rem;
            text-align: left;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            font-size: 0.7rem;
            letter-spacing: 0.05em;
            position: sticky;
            top: 0;
            z-index: 10;
            cursor: pointer;
            user-select: none;
        }
        
        .data-table th:hover {
            background: var(--bg-elevated);
        }
        
        .data-table th.sorted-asc::after { content: ' ‚Üë'; }
        .data-table th.sorted-desc::after { content: ' ‚Üì'; }
        
        .data-table td {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid var(--border);
        }
        
        .data-table tr:hover {
            background: var(--bg-card-hover);
        }
        
        .data-table tr.clickable {
            cursor: pointer;
        }
        
        /* Status Badges */
        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.35rem;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 500;
        }
        
        .status-badge.mvp-ready {
            background: var(--accent-emerald-dim);
            color: var(--accent-emerald);
        }
        
        .status-badge.near-mvp {
            background: var(--accent-sky-dim);
            color: var(--accent-sky);
        }
        
        .status-badge.developing {
            background: var(--accent-amber-dim);
            color: var(--accent-amber);
        }
        
        .status-badge.supply-only {
            background: var(--accent-violet-dim);
            color: var(--accent-violet);
        }
        
        .status-badge.not-started {
            background: var(--accent-rose-dim);
            color: var(--accent-rose);
        }
        
        /* Priority Badges */
        .priority-badge {
            display: inline-flex;
            padding: 0.2rem 0.6rem;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .priority-badge.critical {
            background: var(--danger);
            color: white;
        }
        
        .priority-badge.high {
            background: var(--accent-amber);
            color: #000;
        }
        
        .priority-badge.medium {
            background: var(--accent-sky);
            color: white;
        }
        
        .priority-badge.low {
            background: var(--success);
            color: white;
        }
        
        /* Health Score Bar */
        .health-bar {
            width: 60px;
            height: 6px;
            background: var(--bg-secondary);
            border-radius: 3px;
            overflow: hidden;
            display: inline-block;
            vertical-align: middle;
            margin-right: 0.5rem;
        }
        
        .health-bar-fill {
            height: 100%;
            border-radius: 3px;
            transition: width 0.3s;
        }
        
        /* Cuisine Pills */
        .cuisine-pills {
            display: flex;
            flex-wrap: wrap;
            gap: 0.25rem;
        }
        
        .cuisine-pill {
            display: inline-block;
            padding: 0.15rem 0.5rem;
            background: var(--bg-elevated);
            border-radius: 4px;
            font-size: 0.7rem;
            color: var(--text-secondary);
        }
        
        .cuisine-pill.missing {
            background: var(--accent-rose-dim);
            color: var(--accent-rose);
        }
        
        /* Zone Detail Panel */
        .zone-detail-panel {
            position: fixed;
            top: 0;
            right: -500px;
            width: 500px;
            height: 100vh;
            background: var(--bg-secondary);
            border-left: 1px solid var(--border);
            z-index: 200;
            transition: right 0.3s ease;
            overflow-y: auto;
        }
        
        .zone-detail-panel.open {
            right: 0;
        }
        
        .zone-detail-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            position: sticky;
            top: 0;
            background: var(--bg-secondary);
            z-index: 10;
        }
        
        .zone-detail-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.25rem;
            line-height: 1;
        }
        
        .zone-detail-close:hover {
            color: var(--text-primary);
        }
        
        .zone-detail-content {
            padding: 1.5rem;
        }
        
        .zone-detail-section {
            margin-bottom: 1.5rem;
        }
        
        .zone-detail-section h4 {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-muted);
            margin-bottom: 0.75rem;
        }
        
        .zone-metrics-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.75rem;
        }
        
        .zone-metric {
            background: var(--bg-card);
            padding: 0.75rem;
            border-radius: 8px;
        }
        
        .zone-metric-value {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--accent-emerald);
        }
        
        .zone-metric-label {
            font-size: 0.7rem;
            color: var(--text-muted);
        }
        
        /* AM Checklist */
        .checklist {
            list-style: none;
        }
        
        .checklist-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem;
            background: var(--bg-card);
            border-radius: 8px;
            margin-bottom: 0.5rem;
        }
        
        .checklist-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.85rem;
            flex-shrink: 0;
        }
        
        .checklist-icon.pass {
            background: var(--accent-emerald-dim);
            color: var(--accent-emerald);
        }
        
        .checklist-icon.fail {
            background: var(--accent-rose-dim);
            color: var(--accent-rose);
        }
        
        .checklist-text {
            flex: 1;
            font-size: 0.85rem;
        }
        
        /* Route to MVP Progress */
        .mvp-progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .mvp-progress-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .mvp-progress-pct {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--accent-emerald);
        }
        
        .mvp-progress-bar {
            width: 100%;
            height: 12px;
            background: var(--bg-secondary);
            border-radius: 6px;
            overflow: hidden;
            margin-bottom: 1.5rem;
        }
        
        .mvp-progress-fill {
            height: 100%;
            border-radius: 6px;
            background: var(--gradient-primary);
            transition: width 0.5s ease;
        }
        
        /* Coverage Section */
        .coverage-section {
            margin-bottom: 1.5rem;
        }
        
        .coverage-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
        }
        
        .coverage-title {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-muted);
            font-weight: 600;
        }
        
        .coverage-count {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 0.85rem;
            color: var(--accent-emerald);
        }
        
        .coverage-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.5rem;
        }
        
        .coverage-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 0.75rem;
            background: var(--bg-card);
            border-radius: 6px;
            font-size: 0.8rem;
        }
        
        .coverage-item.has {
            border-left: 3px solid var(--accent-emerald);
        }
        
        .coverage-item.missing {
            border-left: 3px solid var(--accent-rose);
            background: var(--accent-rose-dim);
        }
        
        .coverage-item-icon {
            font-size: 0.75rem;
        }
        
        .coverage-item-name {
            flex: 1;
        }
        
        .coverage-item-count {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 0.7rem;
            color: var(--text-muted);
        }
        
        /* Priority Actions */
        .priority-actions {
            margin-top: 1.5rem;
        }
        
        .priority-action {
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
            padding: 0.75rem;
            background: var(--bg-card);
            border-radius: 8px;
            margin-bottom: 0.5rem;
            border-left: 3px solid var(--accent-amber);
        }
        
        .priority-action-number {
            width: 24px;
            height: 24px;
            background: var(--accent-amber);
            color: #000;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: 700;
            flex-shrink: 0;
        }
        
        .priority-action-content {
            flex: 1;
        }
        
        .priority-action-gap {
            font-weight: 600;
            font-size: 0.85rem;
            margin-bottom: 0.25rem;
        }
        
        .priority-action-text {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }
        
        .priority-action-impact {
            font-size: 0.7rem;
            color: var(--accent-emerald);
            margin-top: 0.25rem;
        }
        
        /* Overlay */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 150;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }
        
        .overlay.visible {
            opacity: 1;
            visibility: visible;
        }
        
        /* Region Cards */
        .region-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .region-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.25rem;
            transition: all 0.2s;
            cursor: pointer;
        }
        
        .region-card:hover {
            border-color: var(--accent-emerald);
            transform: translateY(-2px);
        }
        
        .region-name {
            font-weight: 600;
            margin-bottom: 0.75rem;
        }
        
        .region-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.5rem;
            font-size: 0.8rem;
        }
        
        .region-stat-value {
            font-family: 'IBM Plex Mono', monospace;
            font-weight: 600;
            color: var(--accent-emerald);
        }
        
        .region-stat-label {
            color: var(--text-muted);
            font-size: 0.7rem;
        }
        
        /* Cuisine Coverage Grid */
        .cuisine-coverage-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0.5rem;
            margin-bottom: 1rem;
        }
        
        @media (max-width: 768px) {
            .cuisine-coverage-grid { grid-template-columns: repeat(4, 1fr); }
        }
        
        .cuisine-coverage-item {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 0.75rem;
            text-align: center;
        }
        
        .cuisine-coverage-name {
            font-size: 0.7rem;
            color: var(--text-secondary);
            margin-bottom: 0.25rem;
        }
        
        .cuisine-coverage-value {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 1.25rem;
            font-weight: 600;
        }
        
        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 3rem;
            color: var(--text-muted);
        }
        
        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }
        
        /* Loading */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 3rem;
            color: var(--text-muted);
        }
        
        .loading::after {
            content: '';
            width: 24px;
            height: 24px;
            border: 2px solid var(--border);
            border-top-color: var(--accent-emerald);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin-left: 0.75rem;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Methodology Note */
        .methodology-note {
            background: var(--accent-emerald-dim);
            border: 1px solid rgba(16, 185, 129, 0.3);
            border-radius: 12px;
            padding: 1rem 1.25rem;
            margin-bottom: 1.5rem;
            font-size: 0.85rem;
            color: var(--text-secondary);
        }
        
        .methodology-note strong {
            color: var(--accent-emerald);
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <div class="logo-icon">üó∫Ô∏è</div>
                <div class="logo-text">
                    <h1>Zone Analysis</h1>
                    <span>Dinneroo Analytics</span>
                </div>
            </div>
            <div class="header-stats">
                <div class="header-stat">
                    <div class="header-stat-value" id="total-zones">1,306</div>
                    <div class="header-stat-label">Total Zones</div>
                </div>
                <div class="header-stat">
                    <div class="header-stat-value" id="zones-with-orders">201</div>
                    <div class="header-stat-label">With Orders</div>
                </div>
                <a href="../index.html" class="back-link">‚Üê Back to Dashboards</a>
            </div>
        </div>
    </header>
    
    <div class="container">
        <!-- Data Source Badge -->
        <div class="data-source-badge">
            <span>‚úì</span>
            <span>Ground Truth: All <strong>1,306 zones</strong> from Anna's data</span>
        </div>
        
        <!-- KPI Cards - MVP Status -->
        <div class="kpi-grid">
            <div class="kpi-card success">
                <div class="kpi-label">MVP Ready</div>
                <div class="kpi-value" id="kpi-mvp-ready">33</div>
                <div class="kpi-detail">Meet all criteria</div>
            </div>
            <div class="kpi-card sky">
                <div class="kpi-label">Near MVP</div>
                <div class="kpi-value" id="kpi-near-mvp">48</div>
                <div class="kpi-detail">1-2 criteria away</div>
            </div>
            <div class="kpi-card amber">
                <div class="kpi-label">Developing</div>
                <div class="kpi-value" id="kpi-developing">120</div>
                <div class="kpi-detail">Live, building up</div>
            </div>
            <div class="kpi-card violet">
                <div class="kpi-label">Supply Only</div>
                <div class="kpi-value" id="kpi-supply-only">235</div>
                <div class="kpi-detail">Partners, no orders yet</div>
            </div>
            <div class="kpi-card rose">
                <div class="kpi-label">Not Started</div>
                <div class="kpi-value" id="kpi-not-started">870</div>
                <div class="kpi-detail">Expansion opportunity</div>
            </div>
            <div class="kpi-card emerald">
                <div class="kpi-label">Live Zones</div>
                <div class="kpi-value" id="kpi-live-zones">201</div>
                <div class="kpi-detail">With order data</div>
            </div>
        </div>
        
        <!-- KPI Cards - Supply Metrics -->
        <div class="kpi-grid" style="margin-top: 1rem;">
            <div class="kpi-card" style="background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(99, 102, 241, 0.05));">
                <div class="kpi-label">Zones with Partners</div>
                <div class="kpi-value" id="kpi-zones-partners">434</div>
                <div class="kpi-detail">Of 1,306 total</div>
            </div>
            <div class="kpi-card" style="background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(99, 102, 241, 0.05));">
                <div class="kpi-label">Total Partners</div>
                <div class="kpi-value" id="kpi-total-partners">2,325</div>
                <div class="kpi-detail">Across all zones</div>
            </div>
            <div class="kpi-card" style="background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(99, 102, 241, 0.05));">
                <div class="kpi-label">Total Dishes</div>
                <div class="kpi-value" id="kpi-total-dishes">10,463</div>
                <div class="kpi-detail">Family-suitable</div>
            </div>
            <div class="kpi-card" style="background: linear-gradient(135deg, rgba(236, 72, 153, 0.1), rgba(236, 72, 153, 0.05)); border-color: rgba(236, 72, 153, 0.3);">
                <div class="kpi-label">Avg Dishes/Partner</div>
                <div class="kpi-value" id="kpi-avg-dishes-partner" style="color: #ec4899;">4.5</div>
                <div class="kpi-detail">Menu depth indicator</div>
            </div>
            <div class="kpi-card" style="background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(99, 102, 241, 0.05));">
                <div class="kpi-label">Avg Health Score</div>
                <div class="kpi-value" id="kpi-avg-health">--</div>
                <div class="kpi-detail">Composite (0-100)</div>
            </div>
            <div class="kpi-card" style="background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(99, 102, 241, 0.05));">
                <div class="kpi-label">Total Orders</div>
                <div class="kpi-value" id="kpi-total-orders">--</div>
                <div class="kpi-detail">Trial period</div>
            </div>
        </div>
        
        <!-- Tabs -->
        <div class="tabs">
            <button class="tab-btn active" data-tab="overview">Overview</button>
            <button class="tab-btn" data-tab="all-zones">All Zones</button>
            <button class="tab-btn" data-tab="regions">By Region</button>
            <button class="tab-btn" data-tab="gaps">Cuisine Gaps</button>
            <button class="tab-btn" data-tab="recruitment">Recruitment Priorities</button>
        </div>
        
        <!-- Overview Tab -->
        <div class="tab-panel active" id="tab-overview">
            <div class="methodology-note">
                <strong>üìä Data Scope:</strong> This analysis includes ALL 1,306 zones from Anna's ground truth data. 
                <strong>201 zones</strong> have order activity from the trial period (Sep-Dec 2025). 
                The remaining <strong>1,105 zones</strong> represent expansion opportunities with partners ready to activate.
            </div>
            
            <div class="charts-grid">
                <div class="chart-card">
                    <div class="chart-title">
                        MVP Status Distribution
                        <span class="chart-badge ground-truth">1,306 Zones</span>
                    </div>
                    <div class="chart-container">
                        <canvas id="mvpStatusChart"></canvas>
                    </div>
                </div>
                <div class="chart-card">
                    <div class="chart-title">
                        Recruitment Priority
                        <span class="chart-badge ground-truth">All Zones</span>
                    </div>
                    <div class="chart-container">
                        <canvas id="priorityChart"></canvas>
                    </div>
                </div>
                <div class="chart-card">
                    <div class="chart-title">
                        Top 15 Zones by Orders
                        <span class="chart-badge ground-truth">Trial Period</span>
                    </div>
                    <div class="chart-container">
                        <canvas id="topZonesChart"></canvas>
                    </div>
                </div>
                <div class="chart-card">
                    <div class="chart-title">
                        Zones by Region
                        <span class="chart-badge ground-truth">All Zones</span>
                    </div>
                    <div class="chart-container">
                        <canvas id="regionChart"></canvas>
                    </div>
                </div>
            </div>
            
            <!-- Zones Needing Attention -->
            <div class="table-wrapper">
                <div class="table-header">
                    <div class="table-title">üéØ Zones Needing Attention (High Orders, High Priority)</div>
                </div>
                <div class="table-scroll" style="max-height: 350px;">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Zone</th>
                                <th>Orders</th>
                                <th>Partners</th>
                                <th>Cuisines</th>
                                <th>Priority</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="attention-zones-body"></tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- All Zones Tab -->
        <div class="tab-panel" id="tab-all-zones">
            <div class="filters-bar">
                <div class="filter-group">
                    <label class="filter-label">Status:</label>
                    <select class="filter-select" id="filter-status">
                        <option value="all">All Statuses</option>
                        <option value="MVP Ready">MVP Ready</option>
                        <option value="Near MVP">Near MVP</option>
                        <option value="Developing">Developing</option>
                        <option value="Supply Only">Supply Only</option>
                        <option value="Not Started">Not Started</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">Region:</label>
                    <select class="filter-select" id="filter-region">
                        <option value="all">All Regions</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">Priority:</label>
                    <select class="filter-select" id="filter-priority">
                        <option value="all">All Priorities</option>
                        <option value="Critical">Critical</option>
                        <option value="High">High</option>
                        <option value="Medium">Medium</option>
                        <option value="Low">Low</option>
                    </select>
                </div>
                <div class="filter-group">
                    <input type="text" class="filter-input search-input" id="filter-search" placeholder="Search zones...">
                </div>
                <div class="filter-count">
                    Showing <span id="filtered-count">0</span> of <span id="total-count">0</span> zones
                </div>
            </div>
            
            <div class="table-wrapper">
                <div class="table-header">
                    <div class="table-title">üìç All Zones</div>
                </div>
                <div class="table-scroll">
                    <table class="data-table" id="zones-table">
                        <thead>
                            <tr>
                                <th data-sort="zone">Zone</th>
                                <th data-sort="region">Region</th>
                                <th data-sort="mvp_status">Status</th>
                                <th data-sort="orders">Orders</th>
                                <th data-sort="partners">Partners</th>
                                <th data-sort="cuisines_count">Cuisines</th>
                                <th data-sort="total_dishes">Dishes</th>
                                <th data-sort="avg_dishes_per_partner">Dishes/Partner</th>
                                <th data-sort="health_score">Health</th>
                                <th data-sort="recruitment_priority">Priority</th>
                            </tr>
                        </thead>
                        <tbody id="zones-table-body"></tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- Regions Tab -->
        <div class="tab-panel" id="tab-regions">
            <div class="section-header">
                <h2 class="section-title">Zone Performance by Region</h2>
                <p class="section-subtitle">Click a region to filter the zone table</p>
            </div>
            <div class="region-grid" id="region-grid"></div>
        </div>
        
        <!-- Cuisine Gaps Tab -->
        <div class="tab-panel" id="tab-gaps">
            <div class="section-header">
                <h2 class="section-title">Cuisine Coverage Analysis</h2>
                <p class="section-subtitle">Identify gaps in cuisine availability across zones</p>
            </div>
            
            <div class="methodology-note">
                <strong>Source of Truth:</strong> Anna's 7 Cuisine Categories<br>
                <strong>Cuisines:</strong> Asian, Italian, Indian, Healthy, Mexican, Middle Eastern, British<br>
                <strong>Core Drivers (8):</strong> Pho, Indian Curry, Biryani, Fried Rice, Sushi, Katsu, Rice Bowl, Noodles
            </div>
            
            <div class="charts-grid">
                <div class="chart-card">
                    <div class="chart-title">
                        Zones Missing Essential Cuisines
                        <span class="chart-badge ground-truth">Gap Analysis</span>
                    </div>
                    <div class="chart-container">
                        <canvas id="missingCuisinesChart"></canvas>
                    </div>
                </div>
                <div class="chart-card">
                    <div class="chart-title">
                        Cuisine Distribution (Total Dishes)
                        <span class="chart-badge ground-truth">All Zones</span>
                    </div>
                    <div class="chart-container">
                        <canvas id="cuisineDistChart"></canvas>
                    </div>
                </div>
            </div>
            
            <div class="table-wrapper">
                <div class="table-header">
                    <div class="table-title">üçΩÔ∏è Zones with Cuisine Gaps (MVP Ready but missing cuisines)</div>
                </div>
                <div class="table-scroll" style="max-height: 400px;">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Zone</th>
                                <th>Orders</th>
                                <th>Cuisines Available</th>
                                <th>Missing Essential</th>
                                <th>Coverage</th>
                            </tr>
                        </thead>
                        <tbody id="cuisine-gaps-body"></tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- Recruitment Tab -->
        <div class="tab-panel" id="tab-recruitment">
            <div class="section-header">
                <h2 class="section-title">Recruitment Priorities</h2>
                <p class="section-subtitle">Zones prioritized for partner recruitment</p>
            </div>
            
            <div class="methodology-note">
                <strong>Priority Logic:</strong><br>
                ‚Ä¢ <strong>Critical:</strong> No partners onboarded - expansion opportunity<br>
                ‚Ä¢ <strong>High:</strong> &lt;3 partners or &lt;3 cuisines - needs recruitment<br>
                ‚Ä¢ <strong>Medium:</strong> &lt;5 partners or &lt;5 cuisines - close to MVP<br>
                ‚Ä¢ <strong>Low:</strong> 5+ partners and 5+ cuisines - focus on growth
            </div>
            
            <div class="charts-grid">
                <div class="chart-card">
                    <div class="chart-title">
                        High-Value Recruitment Targets
                        <span class="chart-badge ground-truth">Orders + Priority</span>
                    </div>
                    <div class="chart-container">
                        <canvas id="recruitmentChart"></canvas>
                    </div>
                </div>
                <div class="chart-card">
                    <div class="chart-title">
                        Priority Distribution by Region
                        <span class="chart-badge ground-truth">All Zones</span>
                    </div>
                    <div class="chart-container">
                        <canvas id="priorityByRegionChart"></canvas>
                    </div>
                </div>
            </div>
            
            <div class="table-wrapper">
                <div class="table-header">
                    <div class="table-title">üöÄ Top Recruitment Targets (High orders, needs partners)</div>
                </div>
                <div class="table-scroll" style="max-height: 400px;">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Zone</th>
                                <th>Region</th>
                                <th>Orders</th>
                                <th>Partners</th>
                                <th>Cuisines</th>
                                <th>Priority</th>
                                <th>Missing Cuisines</th>
                            </tr>
                        </thead>
                        <tbody id="recruitment-body"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Zone Detail Panel -->
    <div class="overlay" id="overlay"></div>
    <div class="zone-detail-panel" id="zone-detail-panel">
        <div class="zone-detail-header">
            <div>
                <h2 id="detail-zone-name">Zone Name</h2>
                <span id="detail-zone-region" style="color: var(--text-muted); font-size: 0.85rem;"></span>
            </div>
            <button class="zone-detail-close" onclick="closeZoneDetail()">√ó</button>
        </div>
        <div class="zone-detail-content">
            <!-- Route to MVP Progress -->
            <div class="zone-detail-section">
                <div class="mvp-progress-header">
                    <span class="mvp-progress-title">Route to MVP</span>
                    <span class="mvp-progress-pct" id="detail-progress-pct">0%</span>
                </div>
                <div class="mvp-progress-bar">
                    <div class="mvp-progress-fill" id="detail-progress-bar" style="width: 0%;"></div>
                </div>
            </div>
            
            <!-- Key Metrics -->
            <div class="zone-detail-section">
                <h4>Key Metrics</h4>
                <div class="zone-metrics-grid" id="detail-metrics"></div>
            </div>
            
            <!-- Cuisine Coverage (Anna's 7) -->
            <div class="zone-detail-section coverage-section">
                <div class="coverage-header">
                    <span class="coverage-title">Cuisine Coverage</span>
                    <span class="coverage-count" id="detail-cuisine-count">0/7</span>
                </div>
                <div class="coverage-grid" id="detail-cuisine-coverage"></div>
            </div>
            
            <!-- Core Drivers Coverage (8) -->
            <div class="zone-detail-section coverage-section">
                <div class="coverage-header">
                    <span class="coverage-title">Core Drivers</span>
                    <span class="coverage-count" id="detail-driver-count">0/8</span>
                </div>
                <div class="coverage-grid" id="detail-driver-coverage"></div>
            </div>
            
            <!-- Priority Actions -->
            <div class="zone-detail-section priority-actions">
                <h4>Priority Actions</h4>
                <div id="detail-priority-actions"></div>
            </div>
            
            <!-- Legacy Checklist (hidden by default, for reference) -->
            <div class="zone-detail-section" style="display: none;">
                <h4>AM Checklist (Legacy)</h4>
                <ul class="checklist" id="detail-checklist"></ul>
            </div>
            
            <!-- Cuisines Available -->
            <div class="zone-detail-section">
                <h4>Cuisines Available</h4>
                <div class="cuisine-pills" id="detail-cuisines"></div>
            </div>
            
            <!-- Missing Cuisines -->
            <div class="zone-detail-section">
                <h4>Missing Cuisines</h4>
                <div class="cuisine-pills" id="detail-missing"></div>
            </div>
        </div>
    </div>
    
    <script>
        // Global data
        let zoneData = null;
        let filteredZones = [];
        let currentSort = { column: 'orders', direction: 'desc' };
        
        // Chart instances
        let charts = {};
        
        // Load data
        async function loadData() {
            try {
                const response = await fetch('../data/zone_analysis.json');
                zoneData = await response.json();
                initializeDashboard();
            } catch (error) {
                console.error('Error loading data:', error);
                document.querySelector('.container').innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">‚ö†Ô∏è</div>
                        <p>Error loading zone data. Please run:<br><code>python3 scripts/generate_zone_dashboard_data.py</code></p>
                    </div>
                `;
            }
        }
        
        function initializeDashboard() {
            updateKPIs();
            populateFilters();
            renderCharts();
            renderAllZonesTable();
            renderRegionCards();
            renderAttentionZones();
            renderCuisineGaps();
            renderRecruitmentTable();
            setupEventListeners();
        }
        
        function updateKPIs() {
            const summary = zoneData.summary;
            
            document.getElementById('total-zones').textContent = summary.total_zones.toLocaleString();
            document.getElementById('zones-with-orders').textContent = summary.zones_with_orders.toLocaleString();
            
            // MVP Status KPIs
            document.getElementById('kpi-mvp-ready').textContent = summary.mvp_status['MVP Ready'] || 0;
            document.getElementById('kpi-near-mvp').textContent = summary.mvp_status['Near MVP'] || 0;
            document.getElementById('kpi-developing').textContent = summary.mvp_status['Developing'] || 0;
            document.getElementById('kpi-supply-only').textContent = summary.mvp_status['Supply Only'] || 0;
            document.getElementById('kpi-not-started').textContent = (summary.mvp_status['Not Started'] || 0).toLocaleString();
            document.getElementById('kpi-live-zones').textContent = summary.zones_with_mvp_data || summary.zones_with_orders;
            
            // Supply Metrics KPIs
            document.getElementById('kpi-zones-partners').textContent = (summary.zones_with_partners || 0).toLocaleString();
            document.getElementById('kpi-total-partners').textContent = (summary.total_partners || 0).toLocaleString();
            document.getElementById('kpi-total-dishes').textContent = (summary.total_dishes || 0).toLocaleString();
            document.getElementById('kpi-avg-dishes-partner').textContent = summary.avg_dishes_per_partner || '--';
            document.getElementById('kpi-avg-health').textContent = summary.avg_health_score || '--';
            document.getElementById('kpi-total-orders').textContent = (summary.total_orders || 0).toLocaleString();
        }
        
        function populateFilters() {
            const regions = [...new Set(zoneData.zones.map(z => z.region))].sort();
            const regionSelect = document.getElementById('filter-region');
            regions.forEach(region => {
                const option = document.createElement('option');
                option.value = region;
                option.textContent = region;
                regionSelect.appendChild(option);
            });
        }
        
        function renderCharts() {
            // MVP Status Donut
            const mvpCtx = document.getElementById('mvpStatusChart').getContext('2d');
            charts.mvpStatus = new Chart(mvpCtx, {
                type: 'doughnut',
                data: {
                    labels: ['MVP Ready', 'Near MVP', 'Developing', 'Supply Only', 'Not Started'],
                    datasets: [{
                        data: [
                            zoneData.summary.mvp_status['MVP Ready'] || 0,
                            zoneData.summary.mvp_status['Near MVP'] || 0,
                            zoneData.summary.mvp_status['Developing'] || 0,
                            zoneData.summary.mvp_status['Supply Only'] || 0,
                            zoneData.summary.mvp_status['Not Started'] || 0
                        ],
                        backgroundColor: ['#22c55e', '#0ea5e9', '#f59e0b', '#a855f7', '#f43f5e'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: { color: '#9ca3b0', font: { family: 'DM Sans' } }
                        }
                    }
                }
            });
            
            // Priority Chart
            const priorityCtx = document.getElementById('priorityChart').getContext('2d');
            charts.priority = new Chart(priorityCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Critical', 'High', 'Medium', 'Low'],
                    datasets: [{
                        data: [
                            zoneData.summary.recruitment_priority['Critical'] || 0,
                            zoneData.summary.recruitment_priority['High'] || 0,
                            zoneData.summary.recruitment_priority['Medium'] || 0,
                            zoneData.summary.recruitment_priority['Low'] || 0
                        ],
                        backgroundColor: ['#ef4444', '#f59e0b', '#0ea5e9', '#22c55e'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: { color: '#9ca3b0', font: { family: 'DM Sans' } }
                        }
                    }
                }
            });
            
            // Top Zones Bar Chart
            const topZonesCtx = document.getElementById('topZonesChart').getContext('2d');
            const topZones = zoneData.top_zones_by_orders.slice(0, 15);
            charts.topZones = new Chart(topZonesCtx, {
                type: 'bar',
                data: {
                    labels: topZones.map(z => z.zone),
                    datasets: [{
                        label: 'Orders',
                        data: topZones.map(z => z.orders),
                        backgroundColor: '#10b981',
                        borderRadius: 4
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        x: {
                            grid: { color: '#2a303d' },
                            ticks: { color: '#9ca3b0' }
                        },
                        y: {
                            grid: { display: false },
                            ticks: { color: '#9ca3b0', font: { size: 10 } }
                        }
                    }
                }
            });
            
            // Region Chart
            const regionCtx = document.getElementById('regionChart').getContext('2d');
            const regionData = Object.entries(zoneData.region_breakdown).sort((a, b) => b[1].zone - a[1].zone);
            charts.region = new Chart(regionCtx, {
                type: 'bar',
                data: {
                    labels: regionData.map(r => r[0]),
                    datasets: [{
                        label: 'Zones',
                        data: regionData.map(r => r[1].zone),
                        backgroundColor: '#8b5cf6',
                        borderRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        x: {
                            grid: { display: false },
                            ticks: { color: '#9ca3b0', font: { size: 10 }, maxRotation: 45 }
                        },
                        y: {
                            grid: { color: '#2a303d' },
                            ticks: { color: '#9ca3b0' }
                        }
                    }
                }
            });
            
            // Missing Cuisines Chart
            const missingCtx = document.getElementById('missingCuisinesChart').getContext('2d');
            const cuisineMissing = {};
            zoneData.zones.forEach(z => {
                (z.missing_essential || []).forEach(c => {
                    cuisineMissing[c] = (cuisineMissing[c] || 0) + 1;
                });
            });
            const sortedMissing = Object.entries(cuisineMissing).sort((a, b) => b[1] - a[1]);
            charts.missing = new Chart(missingCtx, {
                type: 'bar',
                data: {
                    labels: sortedMissing.map(c => c[0]),
                    datasets: [{
                        label: 'Zones Missing',
                        data: sortedMissing.map(c => c[1]),
                        backgroundColor: '#f43f5e',
                        borderRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        x: {
                            grid: { display: false },
                            ticks: { color: '#9ca3b0', font: { size: 10 } }
                        },
                        y: {
                            grid: { color: '#2a303d' },
                            ticks: { color: '#9ca3b0' }
                        }
                    }
                }
            });
            
            // Cuisine Distribution Chart
            const cuisineDistCtx = document.getElementById('cuisineDistChart').getContext('2d');
            const cuisineTotals = {
                'Asian': zoneData.zones.reduce((sum, z) => sum + (z.asian_dishes || 0), 0),
                'Italian': zoneData.zones.reduce((sum, z) => sum + (z.italian_dishes || 0), 0),
                'Indian': zoneData.zones.reduce((sum, z) => sum + (z.indian_dishes || 0), 0),
                'Healthy': zoneData.zones.reduce((sum, z) => sum + (z.healthy_dishes || 0), 0),
                'Mexican': zoneData.zones.reduce((sum, z) => sum + (z.mexican_dishes || 0), 0),
                'Middle Eastern': zoneData.zones.reduce((sum, z) => sum + (z.middle_eastern_dishes || 0), 0),
                'British': zoneData.zones.reduce((sum, z) => sum + (z.british_dishes || 0), 0)
            };
            charts.cuisineDist = new Chart(cuisineDistCtx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(cuisineTotals),
                    datasets: [{
                        data: Object.values(cuisineTotals),
                        backgroundColor: ['#10b981', '#f59e0b', '#ef4444', '#22c55e', '#8b5cf6', '#0ea5e9', '#f43f5e'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: { color: '#9ca3b0', font: { family: 'DM Sans' } }
                        }
                    }
                }
            });
            
            // Recruitment Chart
            const recruitCtx = document.getElementById('recruitmentChart').getContext('2d');
            const highValueTargets = zoneData.zones
                .filter(z => z.orders > 200 && ['Critical', 'High'].includes(z.recruitment_priority))
                .sort((a, b) => b.orders - a.orders)
                .slice(0, 10);
            charts.recruitment = new Chart(recruitCtx, {
                type: 'bar',
                data: {
                    labels: highValueTargets.map(z => z.zone),
                    datasets: [{
                        label: 'Orders',
                        data: highValueTargets.map(z => z.orders),
                        backgroundColor: highValueTargets.map(z => 
                            z.recruitment_priority === 'Critical' ? '#ef4444' : '#f59e0b'
                        ),
                        borderRadius: 4
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        x: {
                            grid: { color: '#2a303d' },
                            ticks: { color: '#9ca3b0' }
                        },
                        y: {
                            grid: { display: false },
                            ticks: { color: '#9ca3b0', font: { size: 10 } }
                        }
                    }
                }
            });
        }
        
        function renderAllZonesTable() {
            applyFilters();
        }
        
        function applyFilters() {
            const statusFilter = document.getElementById('filter-status').value;
            const regionFilter = document.getElementById('filter-region').value;
            const priorityFilter = document.getElementById('filter-priority').value;
            const searchFilter = document.getElementById('filter-search').value.toLowerCase();
            
            filteredZones = zoneData.zones.filter(z => {
                if (statusFilter !== 'all' && z.mvp_status !== statusFilter) return false;
                if (regionFilter !== 'all' && z.region !== regionFilter) return false;
                if (priorityFilter !== 'all' && z.recruitment_priority !== priorityFilter) return false;
                if (searchFilter && !z.zone.toLowerCase().includes(searchFilter) && 
                    !z.city.toLowerCase().includes(searchFilter)) return false;
                return true;
            });
            
            // Sort
            filteredZones.sort((a, b) => {
                let aVal = a[currentSort.column];
                let bVal = b[currentSort.column];
                if (typeof aVal === 'string') {
                    aVal = aVal.toLowerCase();
                    bVal = bVal.toLowerCase();
                }
                if (currentSort.direction === 'asc') {
                    return aVal > bVal ? 1 : -1;
                } else {
                    return aVal < bVal ? 1 : -1;
                }
            });
            
            document.getElementById('filtered-count').textContent = filteredZones.length;
            document.getElementById('total-count').textContent = zoneData.zones.length;
            
            renderZonesTableBody();
        }
        
        function renderZonesTableBody() {
            const tbody = document.getElementById('zones-table-body');
            tbody.innerHTML = filteredZones.map(z => `
                <tr class="clickable" onclick="openZoneDetail('${z.zone}')">
                    <td><strong>${z.zone}</strong><br><span style="font-size: 0.75rem; color: var(--text-muted);">${z.city}</span></td>
                    <td>${z.region}</td>
                    <td>${getStatusBadge(z.mvp_status)}</td>
                    <td>${z.orders.toLocaleString()}</td>
                    <td>${z.partners}</td>
                    <td>${z.cuisines_count}</td>
                    <td>${z.total_dishes}</td>
                    <td style="color: ${z.avg_dishes_per_partner >= 5 ? '#22c55e' : z.avg_dishes_per_partner >= 3 ? '#f59e0b' : '#f43f5e'}; font-weight: 600;">${z.avg_dishes_per_partner || '--'}</td>
                    <td>${getHealthBar(z.health_score)}</td>
                    <td>${getPriorityBadge(z.recruitment_priority)}</td>
                </tr>
            `).join('');
        }
        
        function getStatusBadge(status) {
            const classes = {
                'MVP Ready': 'mvp-ready',
                'Near MVP': 'near-mvp',
                'Developing': 'developing',
                'Supply Only': 'supply-only',
                'Not Started': 'not-started'
            };
            const icons = {
                'MVP Ready': '‚úì',
                'Near MVP': '‚óê',
                'Developing': '‚óî',
                'Supply Only': '‚óë',
                'Not Started': '‚óã'
            };
            return `<span class="status-badge ${classes[status] || 'not-started'}">${icons[status] || '‚óã'} ${status}</span>`;
        }
        
        function getPriorityBadge(priority) {
            return `<span class="priority-badge ${priority.toLowerCase()}">${priority}</span>`;
        }
        
        function getHealthBar(score) {
            const color = score >= 60 ? '#22c55e' : score >= 40 ? '#f59e0b' : score >= 20 ? '#0ea5e9' : '#f43f5e';
            return `
                <div class="health-bar">
                    <div class="health-bar-fill" style="width: ${score}%; background: ${color};"></div>
                </div>
                <span style="font-family: 'IBM Plex Mono', monospace; font-size: 0.8rem;">${score}</span>
            `;
        }
        
        function renderRegionCards() {
            const grid = document.getElementById('region-grid');
            const regions = Object.entries(zoneData.region_breakdown).sort((a, b) => b[1].orders - a[1].orders);
            
            grid.innerHTML = regions.map(([name, data]) => `
                <div class="region-card" onclick="filterByRegion('${name}')">
                    <div class="region-name">${name}</div>
                    <div class="region-stats">
                        <div>
                            <div class="region-stat-value">${data.zone}</div>
                            <div class="region-stat-label">Zones</div>
                        </div>
                        <div>
                            <div class="region-stat-value">${data.orders.toLocaleString()}</div>
                            <div class="region-stat-label">Orders</div>
                        </div>
                        <div>
                            <div class="region-stat-value">${data.partners}</div>
                            <div class="region-stat-label">Partners</div>
                        </div>
                        <div>
                            <div class="region-stat-value">${data.health_score.toFixed(1)}</div>
                            <div class="region-stat-label">Avg Health</div>
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        function renderAttentionZones() {
            const tbody = document.getElementById('attention-zones-body');
            const attentionZones = zoneData.zones
                .filter(z => z.orders > 100 && ['Critical', 'High'].includes(z.recruitment_priority))
                .sort((a, b) => b.orders - a.orders)
                .slice(0, 15);
            
            tbody.innerHTML = attentionZones.map(z => `
                <tr class="clickable" onclick="openZoneDetail('${z.zone}')">
                    <td><strong>${z.zone}</strong></td>
                    <td>${z.orders.toLocaleString()}</td>
                    <td>${z.partners}</td>
                    <td>${z.cuisines_count}</td>
                    <td>${getPriorityBadge(z.recruitment_priority)}</td>
                    <td style="font-size: 0.8rem; color: var(--text-secondary);">
                        ${z.partners < 5 ? 'Recruit partners' : 'Add cuisines'}
                    </td>
                </tr>
            `).join('');
        }
        
        function renderCuisineGaps() {
            const tbody = document.getElementById('cuisine-gaps-body');
            const gapZones = zoneData.zones
                .filter(z => z.orders > 0 && z.missing_essential && z.missing_essential.length > 0)
                .sort((a, b) => b.orders - a.orders)
                .slice(0, 30);
            
            tbody.innerHTML = gapZones.map(z => `
                <tr class="clickable" onclick="openZoneDetail('${z.zone}')">
                    <td><strong>${z.zone}</strong></td>
                    <td>${z.orders.toLocaleString()}</td>
                    <td>
                        <div class="cuisine-pills">
                            ${(z.cuisines_available || []).slice(0, 4).map(c => 
                                `<span class="cuisine-pill">${c}</span>`
                            ).join('')}
                            ${(z.cuisines_available || []).length > 4 ? `<span class="cuisine-pill">+${z.cuisines_available.length - 4}</span>` : ''}
                        </div>
                    </td>
                    <td>
                        <div class="cuisine-pills">
                            ${(z.missing_essential || []).map(c => 
                                `<span class="cuisine-pill missing">${c}</span>`
                            ).join('')}
                        </div>
                    </td>
                    <td>${z.essential_coverage}</td>
                </tr>
            `).join('');
        }
        
        function renderRecruitmentTable() {
            const tbody = document.getElementById('recruitment-body');
            const recruitZones = zoneData.zones
                .filter(z => z.orders > 50 && ['Critical', 'High', 'Medium'].includes(z.recruitment_priority))
                .sort((a, b) => {
                    const priorityOrder = { 'Critical': 0, 'High': 1, 'Medium': 2 };
                    if (priorityOrder[a.recruitment_priority] !== priorityOrder[b.recruitment_priority]) {
                        return priorityOrder[a.recruitment_priority] - priorityOrder[b.recruitment_priority];
                    }
                    return b.orders - a.orders;
                })
                .slice(0, 30);
            
            tbody.innerHTML = recruitZones.map(z => `
                <tr class="clickable" onclick="openZoneDetail('${z.zone}')">
                    <td><strong>${z.zone}</strong></td>
                    <td>${z.region}</td>
                    <td>${z.orders.toLocaleString()}</td>
                    <td>${z.partners}</td>
                    <td>${z.cuisines_count}</td>
                    <td>${getPriorityBadge(z.recruitment_priority)}</td>
                    <td>
                        <div class="cuisine-pills">
                            ${(z.missing_essential || []).slice(0, 3).map(c => 
                                `<span class="cuisine-pill missing">${c}</span>`
                            ).join('')}
                        </div>
                    </td>
                </tr>
            `).join('');
        }
        
        function openZoneDetail(zoneName) {
            const zone = zoneData.zones.find(z => z.zone === zoneName);
            if (!zone) return;
            
            document.getElementById('detail-zone-name').textContent = zone.zone;
            document.getElementById('detail-zone-region').textContent = `${zone.city} ¬∑ ${zone.region}`;
            
            // Route to MVP Progress
            const checklist = zone.mvp_checklist || {};
            const progress = checklist.progress || { cuisines: '0/7', core_drivers: '0/8', overall_pct: 0 };
            
            document.getElementById('detail-progress-pct').textContent = `${progress.overall_pct}%`;
            document.getElementById('detail-progress-bar').style.width = `${progress.overall_pct}%`;
            document.getElementById('detail-cuisine-count').textContent = progress.cuisines;
            document.getElementById('detail-driver-count').textContent = progress.core_drivers;
            
            // Metrics
            document.getElementById('detail-metrics').innerHTML = `
                <div class="zone-metric">
                    <div class="zone-metric-value">${zone.orders.toLocaleString()}</div>
                    <div class="zone-metric-label">Orders</div>
                </div>
                <div class="zone-metric">
                    <div class="zone-metric-value">${zone.partners}</div>
                    <div class="zone-metric-label">Partners</div>
                </div>
                <div class="zone-metric">
                    <div class="zone-metric-value">${zone.cuisines_count}</div>
                    <div class="zone-metric-label">Cuisines</div>
                </div>
                <div class="zone-metric">
                    <div class="zone-metric-value">${zone.total_dishes}</div>
                    <div class="zone-metric-label">Dishes</div>
                </div>
                <div class="zone-metric">
                    <div class="zone-metric-value">${zone.avg_rating || 'N/A'}</div>
                    <div class="zone-metric-label">Avg Rating</div>
                </div>
                <div class="zone-metric">
                    <div class="zone-metric-value">${zone.health_score}</div>
                    <div class="zone-metric-label">Health Score</div>
                </div>
            `;
            
            // Cuisine Coverage (Anna's 7)
            const cuisineCoverage = checklist.cuisine_coverage || {};
            const cuisineNames = {
                'asian': 'Asian',
                'italian': 'Italian',
                'indian': 'Indian',
                'healthy': 'Healthy',
                'mexican': 'Mexican',
                'middle_eastern': 'Middle Eastern',
                'british': 'British'
            };
            
            document.getElementById('detail-cuisine-coverage').innerHTML = Object.entries(cuisineNames).map(([key, name]) => {
                const data = cuisineCoverage[key] || { has: false, dishes: 0 };
                return `
                    <div class="coverage-item ${data.has ? 'has' : 'missing'}">
                        <span class="coverage-item-icon">${data.has ? '‚úì' : '‚úó'}</span>
                        <span class="coverage-item-name">${name}</span>
                        <span class="coverage-item-count">${data.dishes} dishes</span>
                    </div>
                `;
            }).join('');
            
            // Core Driver Coverage (8)
            const driverCoverage = checklist.core_driver_coverage || {};
            const driverNames = {
                'pho': 'Pho',
                'south_asian___indian_curry': 'Indian Curry',
                'biryani': 'Biryani',
                'fried_rice': 'Fried Rice',
                'sushi': 'Sushi',
                'katsu': 'Katsu',
                'rice_bowl': 'Rice Bowl',
                'noodles': 'Noodles'
            };
            
            document.getElementById('detail-driver-coverage').innerHTML = Object.entries(driverNames).map(([key, name]) => {
                const data = driverCoverage[key] || { has: false, blocked_by: null };
                const blockedText = data.blocked_by ? ` (${data.blocked_by.replace('Blocked by missing ', '‚Üë ')})` : '';
                return `
                    <div class="coverage-item ${data.has ? 'has' : 'missing'}" title="${data.blocked_by || ''}">
                        <span class="coverage-item-icon">${data.has ? '‚úì' : '‚úó'}</span>
                        <span class="coverage-item-name">${name}</span>
                    </div>
                `;
            }).join('');
            
            // Priority Actions
            const actions = checklist.priority_actions || [];
            if (actions.length > 0) {
                document.getElementById('detail-priority-actions').innerHTML = actions.map((action, i) => `
                    <div class="priority-action">
                        <span class="priority-action-number">${i + 1}</span>
                        <div class="priority-action-content">
                            <div class="priority-action-gap">${action.gap}</div>
                            <div class="priority-action-text">${action.action}</div>
                            <div class="priority-action-impact">‚Üí ${action.impact}</div>
                        </div>
                    </div>
                `).join('');
            } else {
                document.getElementById('detail-priority-actions').innerHTML = `
                    <div style="padding: 1rem; background: var(--accent-emerald-dim); border-radius: 8px; text-align: center;">
                        <span style="color: var(--accent-emerald);">‚úì All cuisines and Core Drivers covered!</span>
                    </div>
                `;
            }
            
            // Legacy AM Checklist (hidden but still populated for reference)
            const legacyChecklist = [
                { text: 'Pizza/Pasta option (Italian)', pass: zone.italian_dishes > 0 },
                { text: 'Mild curry option (Indian)', pass: zone.indian_dishes > 0 },
                { text: 'Rice bowl option (Asian)', pass: zone.asian_dishes > 0 },
                { text: 'Grilled chicken with sides', pass: zone.british_dishes > 0 || zone.healthy_dishes > 0 },
                { text: 'Noodle/fresh option (Thai/Viet)', pass: zone.asian_dishes > 5 },
                { text: '5+ partners', pass: zone.partners >= 5 },
                { text: '5+ cuisines', pass: zone.cuisines_count >= 5 },
                { text: 'Rating 4.0+', pass: zone.avg_rating >= 4.0 }
            ];
            
            document.getElementById('detail-checklist').innerHTML = legacyChecklist.map(item => `
                <li class="checklist-item">
                    <span class="checklist-icon ${item.pass ? 'pass' : 'fail'}">${item.pass ? '‚úì' : '‚úó'}</span>
                    <span class="checklist-text">${item.text}</span>
                </li>
            `).join('');
            
            // Cuisines Available
            document.getElementById('detail-cuisines').innerHTML = (zone.cuisines_available || []).map(c => 
                `<span class="cuisine-pill">${c}</span>`
            ).join('') || '<span style="color: var(--text-muted);">None</span>';
            
            // Missing Cuisines
            document.getElementById('detail-missing').innerHTML = (zone.missing_essential || []).map(c => 
                `<span class="cuisine-pill missing">${c}</span>`
            ).join('') || '<span style="color: var(--text-muted);">None - all essential cuisines covered!</span>';
            
            document.getElementById('zone-detail-panel').classList.add('open');
            document.getElementById('overlay').classList.add('visible');
        }
        
        function closeZoneDetail() {
            document.getElementById('zone-detail-panel').classList.remove('open');
            document.getElementById('overlay').classList.remove('visible');
        }
        
        function filterByRegion(region) {
            document.getElementById('filter-region').value = region;
            document.querySelector('[data-tab="all-zones"]').click();
            applyFilters();
        }
        
        function setupEventListeners() {
            // Tabs
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                    document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
                    btn.classList.add('active');
                    document.getElementById(`tab-${btn.dataset.tab}`).classList.add('active');
                });
            });
            
            // Filters
            document.getElementById('filter-status').addEventListener('change', applyFilters);
            document.getElementById('filter-region').addEventListener('change', applyFilters);
            document.getElementById('filter-priority').addEventListener('change', applyFilters);
            document.getElementById('filter-search').addEventListener('input', applyFilters);
            
            // Table sorting
            document.querySelectorAll('#zones-table th[data-sort]').forEach(th => {
                th.addEventListener('click', () => {
                    const column = th.dataset.sort;
                    if (currentSort.column === column) {
                        currentSort.direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
                    } else {
                        currentSort.column = column;
                        currentSort.direction = 'desc';
                    }
                    
                    document.querySelectorAll('#zones-table th').forEach(h => {
                        h.classList.remove('sorted-asc', 'sorted-desc');
                    });
                    th.classList.add(`sorted-${currentSort.direction}`);
                    
                    applyFilters();
                });
            });
            
            // Overlay click to close
            document.getElementById('overlay').addEventListener('click', closeZoneDetail);
        }
        
        // Initialize
        loadData();
    </script>
</body>
</html>

