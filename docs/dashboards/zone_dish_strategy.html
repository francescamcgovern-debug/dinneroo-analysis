<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dinneroo Zone & Dish Strategy Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --teal: #00CCBC;
            --teal-dark: #00A89D;
            --dark: #1a1f2e;
            --dark-card: #242938;
            --gray: #8b8f9a;
            --light-gray: #3a3f4e;
            --white: #FFFFFF;
            --red: #ff6b6b;
            --orange: #ffa94d;
            --green: #51cf66;
            --yellow: #ffd43b;
            --purple: #9775fa;
            --blue: #4dabf7;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'DM Sans', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #0f1219 0%, #1a1f2e 50%, #0f1219 100%);
            color: var(--white);
            line-height: 1.6;
            min-height: 100vh;
        }
        
        /* Navigation */
        nav {
            background: rgba(26, 31, 46, 0.95);
            backdrop-filter: blur(10px);
            padding: 0;
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: 1px solid var(--light-gray);
        }
        
        .nav-container {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            align-items: center;
        }
        
        .nav-brand {
            color: var(--white);
            font-size: 1.25rem;
            font-weight: 700;
            padding: 1rem 1.5rem;
            border-right: 1px solid var(--light-gray);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .nav-brand span { color: var(--teal); }
        
        .nav-tabs {
            display: flex;
            list-style: none;
            flex-wrap: wrap;
        }
        
        .nav-tabs li a {
            display: block;
            color: var(--gray);
            text-decoration: none;
            padding: 1rem 1.25rem;
            font-size: 0.9rem;
            font-weight: 500;
            border-bottom: 3px solid transparent;
            transition: all 0.2s;
        }
        
        .nav-tabs li a:hover {
            color: var(--white);
            background: rgba(255,255,255,0.05);
        }
        
        .nav-tabs li a.active {
            color: var(--teal);
            border-bottom-color: var(--teal);
        }
        
        /* Page Container */
        .page {
            display: none;
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .page.active { display: block; }
        
        /* Page Header */
        .page-header {
            margin-bottom: 2rem;
            text-align: center;
        }
        
        .page-header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, var(--white) 0%, var(--teal) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .page-header p {
            color: var(--gray);
            font-size: 1.1rem;
        }
        
        .data-date {
            text-align: center;
            font-size: 0.8rem;
            color: var(--gray);
            margin-bottom: 2rem;
            opacity: 0.7;
        }
        
        /* Cards */
        .card {
            background: var(--dark-card);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border: 1px solid var(--light-gray);
        }
        
        .card h2 {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--white);
        }
        
        .card h3 {
            font-size: 1rem;
            margin: 1.5rem 0 0.75rem 0;
            color: var(--gray);
        }
        
        /* Hero Stats */
        .hero-stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        @media (max-width: 900px) {
            .hero-stats { grid-template-columns: repeat(2, 1fr); }
        }
        
        .hero-stat {
            background: var(--dark-card);
            border-radius: 16px;
            padding: 1.5rem;
            text-align: center;
            border: 1px solid var(--light-gray);
            position: relative;
            overflow: hidden;
        }
        
        .hero-stat::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
        }
        
        .hero-stat.mvp::before { background: var(--green); }
        .hero-stat.near::before { background: var(--yellow); }
        .hero-stat.developing::before { background: var(--orange); }
        .hero-stat.total::before { background: var(--teal); }
        
        .hero-stat .value {
            font-size: 3rem;
            font-weight: 700;
            line-height: 1;
        }
        
        .hero-stat.mvp .value { color: var(--green); }
        .hero-stat.near .value { color: var(--yellow); }
        .hero-stat.developing .value { color: var(--orange); }
        .hero-stat.total .value { color: var(--teal); }
        
        .hero-stat .label {
            font-size: 0.9rem;
            color: var(--gray);
            margin-top: 0.5rem;
        }
        
        /* Grid Layouts */
        .grid-2 {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.5rem;
        }
        
        .grid-3 {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
        }
        
        @media (max-width: 900px) {
            .grid-2, .grid-3 { grid-template-columns: 1fr; }
        }
        
        /* Tables */
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th, td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid var(--light-gray);
        }
        
        th {
            font-weight: 600;
            color: var(--gray);
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        tr:hover {
            background: rgba(255,255,255,0.02);
        }
        
        /* Badges */
        .badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }
        
        .badge.expand { background: rgba(81, 207, 102, 0.2); color: var(--green); }
        .badge.recruit { background: rgba(77, 171, 247, 0.2); color: var(--blue); }
        .badge.discover { background: rgba(151, 117, 250, 0.2); color: var(--purple); }
        .badge.fix { background: rgba(255, 107, 107, 0.2); color: var(--red); }
        .badge.monitor { background: rgba(139, 143, 154, 0.2); color: var(--gray); }
        
        .badge.mvp { background: rgba(81, 207, 102, 0.2); color: var(--green); }
        .badge.near { background: rgba(255, 212, 59, 0.2); color: var(--yellow); }
        .badge.developing { background: rgba(255, 169, 77, 0.2); color: var(--orange); }
        
        .badge.ok { background: rgba(81, 207, 102, 0.2); color: var(--green); }
        .badge.quality-gap { background: rgba(255, 169, 77, 0.2); color: var(--orange); }
        .badge.supply-gap { background: rgba(255, 107, 107, 0.2); color: var(--red); }
        
        /* Progress Bars */
        .progress-bar {
            background: var(--light-gray);
            border-radius: 10px;
            height: 8px;
            overflow: hidden;
            margin-top: 0.5rem;
        }
        
        .progress-bar .fill {
            height: 100%;
            border-radius: 10px;
            transition: width 0.3s ease;
        }
        
        .progress-bar .fill.green { background: var(--green); }
        .progress-bar .fill.yellow { background: var(--yellow); }
        .progress-bar .fill.red { background: var(--red); }
        .progress-bar .fill.teal { background: var(--teal); }
        
        /* Filters */
        .filters {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }
        
        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }
        
        .filter-group label {
            font-size: 0.8rem;
            color: var(--gray);
        }
        
        select, input[type="text"] {
            background: var(--dark);
            border: 1px solid var(--light-gray);
            color: var(--white);
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-size: 0.9rem;
            min-width: 200px;
        }
        
        select:focus, input[type="text"]:focus {
            outline: none;
            border-color: var(--teal);
        }
        
        /* Checklist */
        .checklist {
            list-style: none;
        }
        
        .checklist li {
            padding: 0.75rem 0;
            border-bottom: 1px solid var(--light-gray);
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .checklist li:last-child {
            border-bottom: none;
        }
        
        .check-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
        }
        
        .check-icon.pass {
            background: rgba(81, 207, 102, 0.2);
            color: var(--green);
        }
        
        .check-icon.fail {
            background: rgba(255, 107, 107, 0.2);
            color: var(--red);
        }
        
        /* Metric Cards */
        .metric-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 0;
            border-bottom: 1px solid var(--light-gray);
        }
        
        .metric-row:last-child {
            border-bottom: none;
        }
        
        .metric-label {
            color: var(--gray);
        }
        
        .metric-value {
            font-weight: 600;
            font-size: 1.1rem;
        }
        
        .metric-value.good { color: var(--green); }
        .metric-value.warning { color: var(--yellow); }
        .metric-value.bad { color: var(--red); }
        
        /* Formula Box */
        .formula-box {
            background: rgba(0, 204, 188, 0.1);
            border: 1px solid var(--teal);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .formula-box h3 {
            color: var(--teal);
            margin-bottom: 1rem;
            margin-top: 0;
        }
        
        .formula-box code {
            background: var(--dark);
            padding: 0.5rem 1rem;
            border-radius: 8px;
            display: block;
            font-family: monospace;
            color: var(--white);
        }
        
        /* Evidence Flag */
        .evidence-flag {
            font-size: 0.75rem;
            color: var(--gray);
            margin-top: 0.25rem;
        }
        
        /* Scroll Table */
        .table-scroll {
            max-height: 500px;
            overflow-y: auto;
        }
        
        .table-scroll thead th {
            position: sticky;
            top: 0;
            background: var(--dark-card);
            z-index: 1;
        }
    </style>
</head>
<body>
    <nav>
        <div class="nav-container">
            <div class="nav-brand">Dinneroo <span>Zone Strategy</span></div>
            <ul class="nav-tabs">
                <li><a href="#" class="active" data-page="overview">1. Overview</a></li>
                <li><a href="#" data-page="zones">2. Zone Checker</a></li>
                <li><a href="#" data-page="dishes">3. Priority Dishes</a></li>
                <li><a href="#" data-page="cuisines">4. Cuisines</a></li>
                <li><a href="#" data-page="benchmarks">5. What Good Looks Like</a></li>
            </ul>
        </div>
    </nav>

    <!-- PAGE 1: OVERVIEW -->
    <div class="page active" id="overview">
        <div class="page-header">
            <h1>Zone MVP Status</h1>
            <p>How many zones are ready to scale vs need work?</p>
        </div>
        <div class="data-date">Data as of January 2026 | Thresholds validated against repeat rate correlation</div>
        
        <div class="formula-box">
            <h3>MVP Criteria (Validated)</h3>
            <code>MVP Ready = Rating ≥ 4.3 AND Repeat Rate ≥ 20% AND Cuisines ≥ 4</code>
            <p style="margin-top: 1rem; color: var(--gray); font-size: 0.9rem;">
                These thresholds are statistically validated - zones meeting them have significantly higher repeat rates (p < 0.05)
            </p>
        </div>
        
        <div class="hero-stats" id="hero-stats">
            <!-- Populated by JS -->
        </div>
        
        <div class="grid-2">
            <div class="card">
                <h2>Criteria Breakdown</h2>
                <div id="criteria-breakdown">
                    <!-- Populated by JS -->
                </div>
            </div>
            <div class="card">
                <h2>Top Performing Zones</h2>
                <div class="table-scroll">
                    <table id="top-zones-table">
                        <thead>
                            <tr>
                                <th>Zone</th>
                                <th>Repeat Rate</th>
                                <th>Rating</th>
                                <th>Cuisines</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- PAGE 2: ZONE CHECKER -->
    <div class="page" id="zones">
        <div class="page-header">
            <h1>Zone Checker</h1>
            <p>Select a zone to see its MVP status and gaps</p>
        </div>
        
        <div class="filters">
            <div class="filter-group">
                <label>Select Zone</label>
                <select id="zone-select">
                    <option value="">-- Select a zone --</option>
                </select>
            </div>
            <div class="filter-group">
                <label>Filter by Status</label>
                <select id="status-filter">
                    <option value="">All Statuses</option>
                    <option value="MVP Ready">MVP Ready</option>
                    <option value="Near MVP">Near MVP</option>
                    <option value="Developing">Developing</option>
                </select>
            </div>
        </div>
        
        <div class="grid-2">
            <div class="card" id="zone-details">
                <h2>Zone Details</h2>
                <p style="color: var(--gray);">Select a zone to see details</p>
            </div>
            <div class="card" id="zone-checklist">
                <h2>MVP Checklist</h2>
                <p style="color: var(--gray);">Select a zone to see checklist</p>
            </div>
        </div>
        
        <div class="card">
            <h2>All Zones</h2>
            <div class="table-scroll">
                <table id="zones-table">
                    <thead>
                        <tr>
                            <th>Zone</th>
                            <th>Status</th>
                            <th>Orders</th>
                            <th>Repeat Rate</th>
                            <th>Rating</th>
                            <th>Cuisines</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- PAGE 3: PRIORITY DISHES -->
    <div class="page" id="dishes">
        <div class="page-header">
            <h1>Priority 100+ Dishes</h1>
            <p>Which dishes to prioritize for your zone</p>
        </div>
        
        <div class="formula-box">
            <h3>Two-Track Scoring System</h3>
            <p style="color: var(--gray); margin-bottom: 1rem;">
                <strong>Track A (Performance):</strong> How well is this dish doing? (orders, ratings, satisfaction)<br>
                <strong>Track B (Opportunity):</strong> How much do families want this? (latent demand, framework fit)
            </p>
            <code>Priority Score = Track A × 0.6 + Track B × 0.4 (for available dishes)</code>
        </div>
        
        <div class="hero-stats">
            <div class="hero-stat mvp">
                <div class="value" id="expand-count">0</div>
                <div class="label">Expand</div>
            </div>
            <div class="hero-stat near">
                <div class="value" id="recruit-count">0</div>
                <div class="label">Recruit</div>
            </div>
            <div class="hero-stat developing">
                <div class="value" id="discover-count">0</div>
                <div class="label">Discover</div>
            </div>
            <div class="hero-stat total">
                <div class="value" id="fix-count">0</div>
                <div class="label">Fix</div>
            </div>
        </div>
        
        <div class="filters">
            <div class="filter-group">
                <label>Filter by Category</label>
                <select id="dish-category-filter">
                    <option value="">All Categories</option>
                    <option value="Expand">Expand (Proven Winners)</option>
                    <option value="Recruit">Recruit (High Demand Gaps)</option>
                    <option value="Discover">Discover (New Opportunities)</option>
                    <option value="Fix">Fix (Underperformers)</option>
                    <option value="Monitor">Monitor</option>
                </select>
            </div>
            <div class="filter-group">
                <label>Filter by Cuisine</label>
                <select id="dish-cuisine-filter">
                    <option value="">All Cuisines</option>
                </select>
            </div>
            <div class="filter-group">
                <label>Search</label>
                <input type="text" id="dish-search" placeholder="Search dishes...">
            </div>
        </div>
        
        <div class="card">
            <h2>Priority Dishes</h2>
            <div class="table-scroll">
                <table id="dishes-table">
                    <thead>
                        <tr>
                            <th>Rank</th>
                            <th>Dish</th>
                            <th>Score</th>
                            <th>Category</th>
                            <th>Cuisine</th>
                            <th>Evidence</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- PAGE 4: CUISINES -->
    <div class="page" id="cuisines">
        <div class="page-header">
            <h1>Cuisine Analysis</h1>
            <p>Which cuisines to prioritize recruiting</p>
        </div>
        
        <div class="hero-stats">
            <div class="hero-stat mvp">
                <div class="value" id="ok-cuisines">0</div>
                <div class="label">OK</div>
            </div>
            <div class="hero-stat near">
                <div class="value" id="quality-gap-cuisines">0</div>
                <div class="label">Quality Gap</div>
            </div>
            <div class="hero-stat developing">
                <div class="value" id="supply-gap-cuisines">0</div>
                <div class="label">Supply Gap</div>
            </div>
        </div>
        
        <div class="grid-2">
            <div class="card">
                <h2>Supply Gaps (Need Partners)</h2>
                <div id="supply-gaps-list">
                    <!-- Populated by JS -->
                </div>
            </div>
            <div class="card">
                <h2>Quality Gaps (Need Improvement)</h2>
                <div id="quality-gaps-list">
                    <!-- Populated by JS -->
                </div>
            </div>
        </div>
        
        <div class="card">
            <h2>All Cuisines</h2>
            <div class="table-scroll">
                <table id="cuisines-table">
                    <thead>
                        <tr>
                            <th>Cuisine</th>
                            <th>Avg Rating</th>
                            <th>Rating Count</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- PAGE 5: BENCHMARKS -->
    <div class="page" id="benchmarks">
        <div class="page-header">
            <h1>What Good Looks Like</h1>
            <p>Benchmarks and examples of successful zones</p>
        </div>
        
        <div class="formula-box">
            <h3>Validated MVP Thresholds</h3>
            <p style="color: var(--gray); margin-bottom: 1rem;">
                These thresholds were validated against repeat rate correlation. Zones meeting these criteria have significantly better outcomes.
            </p>
            <div class="grid-3" style="margin-top: 1rem;">
                <div>
                    <div style="font-size: 2rem; font-weight: 700; color: var(--teal);">4.3+</div>
                    <div style="color: var(--gray);">Rating (p < 0.05)</div>
                </div>
                <div>
                    <div style="font-size: 2rem; font-weight: 700; color: var(--teal);">20%+</div>
                    <div style="color: var(--gray);">Repeat Rate</div>
                </div>
                <div>
                    <div style="font-size: 2rem; font-weight: 700; color: var(--teal);">4+</div>
                    <div style="color: var(--gray);">Cuisines (r = 0.51)</div>
                </div>
            </div>
        </div>
        
        <div class="grid-2">
            <div class="card">
                <h2>Current Performance</h2>
                <div id="current-performance">
                    <!-- Populated by JS -->
                </div>
            </div>
            <div class="card">
                <h2>Key Insights</h2>
                <ul class="checklist">
                    <li>
                        <div class="check-icon pass">★</div>
                        <div>
                            <strong>Cuisine count is the strongest predictor</strong>
                            <div class="evidence-flag">Correlation with repeat rate: r = 0.51</div>
                        </div>
                    </li>
                    <li>
                        <div class="check-icon pass">★</div>
                        <div>
                            <strong>Rating at 4.3 is the meaningful threshold</strong>
                            <div class="evidence-flag">4.5 threshold showed no significant impact (p = 0.21)</div>
                        </div>
                    </li>
                    <li>
                        <div class="check-icon pass">★</div>
                        <div>
                            <strong>20% repeat rate is achievable</strong>
                            <div class="evidence-flag">41% of zones achieve this vs 0% at 35%</div>
                        </div>
                    </li>
                </ul>
            </div>
        </div>
        
        <div class="card">
            <h2>Top Performing Zones</h2>
            <p style="color: var(--gray); margin-bottom: 1rem;">Learn from these zones - what are they doing right?</p>
            <div class="table-scroll">
                <table id="benchmark-zones-table">
                    <thead>
                        <tr>
                            <th>Zone</th>
                            <th>Repeat Rate</th>
                            <th>Rating</th>
                            <th>Cuisines</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // Data will be loaded from JSON files
        let zoneData = [];
        let dishData = [];
        let cuisineData = [];
        let benchmarks = {};

        // Load all data
        async function loadData() {
            try {
                const [zonesRes, dishesRes, cuisinesRes, benchmarksRes] = await Promise.all([
                    fetch('../data/zone_mvp_status.json'),
                    fetch('../data/priority_dishes.json'),
                    fetch('../data/cuisine_gaps.json'),
                    fetch('../data/benchmarks.json')
                ]);
                
                zoneData = await zonesRes.json();
                dishData = await dishesRes.json();
                cuisineData = await cuisinesRes.json();
                benchmarks = await benchmarksRes.json();
                
                renderAll();
            } catch (error) {
                console.error('Error loading data:', error);
                // Use fallback data for demo
                useFallbackData();
            }
        }

        function useFallbackData() {
            // Fallback data if JSON files not available
            benchmarks = {
                mvp_summary: { mvp_ready: 33, near_mvp: 48, developing: 120, total_zones: 201 },
                thresholds: { rating_min: 4.3, repeat_rate_min: 0.20, cuisine_count_min: 4 },
                current_performance: { avg_rating: 4.25, avg_repeat_rate: 0.171, avg_cuisine_count: 3.0 },
                top_performers: []
            };
            renderAll();
        }

        function renderAll() {
            renderOverview();
            renderZones();
            renderDishes();
            renderCuisines();
            renderBenchmarks();
        }

        function renderOverview() {
            const stats = benchmarks.mvp_summary || {};
            
            document.getElementById('hero-stats').innerHTML = `
                <div class="hero-stat mvp">
                    <div class="value">${stats.mvp_ready || 0}</div>
                    <div class="label">MVP Ready</div>
                </div>
                <div class="hero-stat near">
                    <div class="value">${stats.near_mvp || 0}</div>
                    <div class="label">Near MVP</div>
                </div>
                <div class="hero-stat developing">
                    <div class="value">${stats.developing || 0}</div>
                    <div class="label">Developing</div>
                </div>
                <div class="hero-stat total">
                    <div class="value">${stats.total_zones || 0}</div>
                    <div class="label">Total Zones</div>
                </div>
            `;
            
            // Criteria breakdown
            const perf = benchmarks.current_performance || {};
            const thresh = benchmarks.thresholds || {};
            
            document.getElementById('criteria-breakdown').innerHTML = `
                <div class="metric-row">
                    <span class="metric-label">Zones with Rating ≥ ${thresh.rating_min || 4.3}</span>
                    <span class="metric-value">${zoneData.filter(z => z.rating_pass).length} zones</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">Zones with Repeat ≥ ${((thresh.repeat_rate_min || 0.2) * 100).toFixed(0)}%</span>
                    <span class="metric-value">${zoneData.filter(z => z.repeat_pass).length} zones</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">Zones with ${thresh.cuisine_count_min || 4}+ Cuisines</span>
                    <span class="metric-value">${zoneData.filter(z => z.cuisine_pass).length} zones</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">Average Rating</span>
                    <span class="metric-value ${perf.avg_rating >= 4.3 ? 'good' : 'warning'}">${(perf.avg_rating || 0).toFixed(2)}</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">Average Repeat Rate</span>
                    <span class="metric-value ${perf.avg_repeat_rate >= 0.2 ? 'good' : 'warning'}">${((perf.avg_repeat_rate || 0) * 100).toFixed(1)}%</span>
                </div>
            `;
            
            // Top zones
            const topZones = (benchmarks.top_performers || []).slice(0, 5);
            const tbody = document.querySelector('#top-zones-table tbody');
            tbody.innerHTML = topZones.map(z => `
                <tr>
                    <td>${z.zone}</td>
                    <td>${(z.repeat_rate * 100).toFixed(1)}%</td>
                    <td>${z.avg_rating ? z.avg_rating.toFixed(2) : 'N/A'}</td>
                    <td>${z.cuisine_count}</td>
                </tr>
            `).join('');
        }

        function renderZones() {
            // Populate zone select
            const select = document.getElementById('zone-select');
            const sortedZones = [...zoneData].sort((a, b) => a.zone.localeCompare(b.zone));
            select.innerHTML = '<option value="">-- Select a zone --</option>' + 
                sortedZones.map(z => `<option value="${z.zone}">${z.zone}</option>`).join('');
            
            // Render zones table
            renderZonesTable();
            
            // Event listeners
            select.addEventListener('change', (e) => {
                if (e.target.value) {
                    showZoneDetails(e.target.value);
                }
            });
            
            document.getElementById('status-filter').addEventListener('change', renderZonesTable);
        }

        function renderZonesTable() {
            const statusFilter = document.getElementById('status-filter').value;
            let filtered = zoneData;
            
            if (statusFilter) {
                filtered = filtered.filter(z => z.mvp_status === statusFilter);
            }
            
            const tbody = document.querySelector('#zones-table tbody');
            tbody.innerHTML = filtered.slice(0, 100).map(z => `
                <tr onclick="showZoneDetails('${z.zone}')" style="cursor: pointer;">
                    <td>${z.zone}</td>
                    <td><span class="badge ${z.mvp_status.toLowerCase().replace(' ', '-')}">${z.mvp_status}</span></td>
                    <td>${z.order_count.toLocaleString()}</td>
                    <td class="${z.repeat_pass ? 'good' : ''}">${(z.repeat_rate * 100).toFixed(1)}%</td>
                    <td class="${z.rating_pass ? 'good' : ''}">${z.avg_rating ? z.avg_rating.toFixed(2) : 'N/A'}</td>
                    <td class="${z.cuisine_pass ? 'good' : ''}">${z.cuisine_count}</td>
                </tr>
            `).join('');
        }

        function showZoneDetails(zoneName) {
            const zone = zoneData.find(z => z.zone === zoneName);
            if (!zone) return;
            
            document.getElementById('zone-select').value = zoneName;
            
            document.getElementById('zone-details').innerHTML = `
                <h2>${zone.zone}</h2>
                <span class="badge ${zone.mvp_status.toLowerCase().replace(' ', '-')}">${zone.mvp_status}</span>
                <div style="margin-top: 1.5rem;">
                    <div class="metric-row">
                        <span class="metric-label">Orders</span>
                        <span class="metric-value">${zone.order_count.toLocaleString()}</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Customers</span>
                        <span class="metric-value">${zone.customer_count.toLocaleString()}</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Repeat Rate</span>
                        <span class="metric-value ${zone.repeat_pass ? 'good' : 'warning'}">${(zone.repeat_rate * 100).toFixed(1)}%</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Average Rating</span>
                        <span class="metric-value ${zone.rating_pass ? 'good' : 'warning'}">${zone.avg_rating ? zone.avg_rating.toFixed(2) : 'N/A'}</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Cuisines Available</span>
                        <span class="metric-value ${zone.cuisine_pass ? 'good' : 'warning'}">${zone.cuisine_count}</span>
                    </div>
                </div>
            `;
            
            document.getElementById('zone-checklist').innerHTML = `
                <h2>MVP Checklist</h2>
                <ul class="checklist">
                    <li>
                        <div class="check-icon ${zone.rating_pass ? 'pass' : 'fail'}">${zone.rating_pass ? '✓' : '✗'}</div>
                        <div>Rating ≥ 4.3</div>
                    </li>
                    <li>
                        <div class="check-icon ${zone.repeat_pass ? 'pass' : 'fail'}">${zone.repeat_pass ? '✓' : '✗'}</div>
                        <div>Repeat Rate ≥ 20%</div>
                    </li>
                    <li>
                        <div class="check-icon ${zone.cuisine_pass ? 'pass' : 'fail'}">${zone.cuisine_pass ? '✓' : '✗'}</div>
                        <div>4+ Cuisines Available</div>
                    </li>
                </ul>
                <h3 style="margin-top: 1.5rem; color: var(--gray);">Cuisines in Zone</h3>
                <p style="margin-top: 0.5rem;">${(zone.cuisines || []).join(', ') || 'None'}</p>
            `;
        }

        function renderDishes() {
            // Count by category
            const counts = {};
            dishData.forEach(d => {
                counts[d.category] = (counts[d.category] || 0) + 1;
            });
            
            document.getElementById('expand-count').textContent = counts['Expand'] || 0;
            document.getElementById('recruit-count').textContent = counts['Recruit'] || 0;
            document.getElementById('discover-count').textContent = counts['Discover'] || 0;
            document.getElementById('fix-count').textContent = counts['Fix'] || 0;
            
            // Populate cuisine filter
            const cuisines = [...new Set(dishData.map(d => d.cuisine).filter(Boolean))].sort();
            const cuisineFilter = document.getElementById('dish-cuisine-filter');
            cuisineFilter.innerHTML = '<option value="">All Cuisines</option>' + 
                cuisines.map(c => `<option value="${c}">${c}</option>`).join('');
            
            // Render table
            renderDishesTable();
            
            // Event listeners
            document.getElementById('dish-category-filter').addEventListener('change', renderDishesTable);
            document.getElementById('dish-cuisine-filter').addEventListener('change', renderDishesTable);
            document.getElementById('dish-search').addEventListener('input', renderDishesTable);
        }

        function renderDishesTable() {
            const categoryFilter = document.getElementById('dish-category-filter').value;
            const cuisineFilter = document.getElementById('dish-cuisine-filter').value;
            const search = document.getElementById('dish-search').value.toLowerCase();
            
            let filtered = dishData;
            
            if (categoryFilter) {
                filtered = filtered.filter(d => d.category === categoryFilter);
            }
            if (cuisineFilter) {
                filtered = filtered.filter(d => d.cuisine === cuisineFilter);
            }
            if (search) {
                filtered = filtered.filter(d => d.dish_type.toLowerCase().includes(search));
            }
            
            const tbody = document.querySelector('#dishes-table tbody');
            tbody.innerHTML = filtered.slice(0, 100).map(d => `
                <tr>
                    <td>${d.rank}</td>
                    <td><strong>${d.dish_type}</strong></td>
                    <td>${d.priority_score.toFixed(2)}</td>
                    <td><span class="badge ${d.category.toLowerCase()}">${d.category}</span></td>
                    <td>${d.cuisine || 'N/A'}</td>
                    <td><span class="evidence-flag">${d.evidence_flag || d.evidence_type}</span></td>
                </tr>
            `).join('');
        }

        function renderCuisines() {
            // Count by gap type
            const ok = cuisineData.filter(c => c.gap_type === 'OK').length;
            const qualityGap = cuisineData.filter(c => c.gap_type === 'Quality Gap').length;
            const supplyGap = cuisineData.filter(c => c.gap_type === 'Supply Gap').length;
            
            document.getElementById('ok-cuisines').textContent = ok;
            document.getElementById('quality-gap-cuisines').textContent = qualityGap;
            document.getElementById('supply-gap-cuisines').textContent = supplyGap;
            
            // Supply gaps list
            const supplyGaps = cuisineData.filter(c => c.gap_type === 'Supply Gap');
            document.getElementById('supply-gaps-list').innerHTML = supplyGaps.length > 0 ?
                `<ul class="checklist">${supplyGaps.map(c => `
                    <li>
                        <div class="check-icon fail">!</div>
                        <div><strong>${c.cuisine}</strong> - Need partners</div>
                    </li>
                `).join('')}</ul>` :
                '<p style="color: var(--gray);">No supply gaps identified</p>';
            
            // Quality gaps list
            const qualityGaps = cuisineData.filter(c => c.gap_type === 'Quality Gap');
            document.getElementById('quality-gaps-list').innerHTML = qualityGaps.length > 0 ?
                `<ul class="checklist">${qualityGaps.slice(0, 10).map(c => `
                    <li>
                        <div class="check-icon fail">!</div>
                        <div>
                            <strong>${c.cuisine}</strong>
                            <div class="evidence-flag">Rating: ${c.avg_rating?.toFixed(2) || 'N/A'} (n=${c.rating_count})</div>
                        </div>
                    </li>
                `).join('')}</ul>` :
                '<p style="color: var(--gray);">No quality gaps identified</p>';
            
            // All cuisines table
            const tbody = document.querySelector('#cuisines-table tbody');
            tbody.innerHTML = cuisineData
                .sort((a, b) => (b.avg_rating || 0) - (a.avg_rating || 0))
                .map(c => `
                <tr>
                    <td>${c.cuisine}</td>
                    <td>${c.avg_rating ? c.avg_rating.toFixed(2) : 'N/A'}</td>
                    <td>${c.rating_count}</td>
                    <td><span class="badge ${c.gap_type.toLowerCase().replace(' ', '-')}">${c.gap_type}</span></td>
                </tr>
            `).join('');
        }

        function renderBenchmarks() {
            const perf = benchmarks.current_performance || {};
            const thresh = benchmarks.thresholds || {};
            
            document.getElementById('current-performance').innerHTML = `
                <div class="metric-row">
                    <span class="metric-label">Average Rating</span>
                    <span class="metric-value ${perf.avg_rating >= thresh.rating_min ? 'good' : 'warning'}">
                        ${(perf.avg_rating || 0).toFixed(2)}
                    </span>
                </div>
                <div class="progress-bar">
                    <div class="fill ${perf.avg_rating >= thresh.rating_min ? 'green' : 'yellow'}" 
                         style="width: ${Math.min((perf.avg_rating / 5) * 100, 100)}%"></div>
                </div>
                
                <div class="metric-row" style="margin-top: 1rem;">
                    <span class="metric-label">Average Repeat Rate</span>
                    <span class="metric-value ${perf.avg_repeat_rate >= thresh.repeat_rate_min ? 'good' : 'warning'}">
                        ${((perf.avg_repeat_rate || 0) * 100).toFixed(1)}%
                    </span>
                </div>
                <div class="progress-bar">
                    <div class="fill ${perf.avg_repeat_rate >= thresh.repeat_rate_min ? 'green' : 'yellow'}" 
                         style="width: ${Math.min((perf.avg_repeat_rate / 0.5) * 100, 100)}%"></div>
                </div>
                
                <div class="metric-row" style="margin-top: 1rem;">
                    <span class="metric-label">Average Cuisine Count</span>
                    <span class="metric-value ${perf.avg_cuisine_count >= thresh.cuisine_count_min ? 'good' : 'warning'}">
                        ${(perf.avg_cuisine_count || 0).toFixed(1)}
                    </span>
                </div>
                <div class="progress-bar">
                    <div class="fill ${perf.avg_cuisine_count >= thresh.cuisine_count_min ? 'green' : 'yellow'}" 
                         style="width: ${Math.min((perf.avg_cuisine_count / 8) * 100, 100)}%"></div>
                </div>
            `;
            
            // Top zones
            const topZones = (benchmarks.top_performers || []).slice(0, 10);
            const tbody = document.querySelector('#benchmark-zones-table tbody');
            tbody.innerHTML = topZones.map(z => `
                <tr>
                    <td><strong>${z.zone}</strong></td>
                    <td class="good">${(z.repeat_rate * 100).toFixed(1)}%</td>
                    <td>${z.avg_rating ? z.avg_rating.toFixed(2) : 'N/A'}</td>
                    <td>${z.cuisine_count}</td>
                </tr>
            `).join('');
        }

        // Navigation
        document.querySelectorAll('.nav-tabs a').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const page = e.target.dataset.page;
                
                document.querySelectorAll('.nav-tabs a').forEach(l => l.classList.remove('active'));
                e.target.classList.add('active');
                
                document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
                document.getElementById(page).classList.add('active');
            });
        });

        // Global function for zone click
        window.showZoneDetails = showZoneDetails;

        // Initialize
        loadData();
    </script>
</body>
</html>

