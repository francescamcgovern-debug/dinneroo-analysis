<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consumer Insight Tracker | Dinneroo</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap');
        
        :root {
            --bg-primary: #0a0a12;
            --bg-secondary: #12121c;
            --bg-card: #1a1a28;
            --bg-card-hover: #222234;
            --accent-teal: #00d4aa;
            --accent-purple: #8b5cf6;
            --accent-orange: #f59e0b;
            --accent-pink: #ec4899;
            --accent-blue: #3b82f6;
            --accent-coral: #ff6b6b;
            --text-primary: #f8fafc;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;
            --border: #2d2d44;
            --success: #22c55e;
            --warning: #f59e0b;
            --error: #ef4444;
            --tier-core: #22c55e;
            --tier-preference: #3b82f6;
            --tier-demand: #f59e0b;
            --tier-deprioritised: #64748b;
            --tier-prospect: #8b5cf6;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Space Grotesk', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            background-image: 
                radial-gradient(ellipse at 10% 0%, rgba(139, 92, 246, 0.08) 0%, transparent 50%),
                radial-gradient(ellipse at 90% 100%, rgba(0, 212, 170, 0.05) 0%, transparent 50%),
                radial-gradient(ellipse at 50% 50%, rgba(236, 72, 153, 0.03) 0%, transparent 70%);
        }
        
        /* Header */
        .header {
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border);
            padding: 16px 32px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(10px);
        }
        
        .header-left {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        .header h1 {
            font-size: 20px;
            font-weight: 600;
            background: linear-gradient(135deg, var(--text-primary) 0%, var(--accent-teal) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .header-badge {
            background: linear-gradient(135deg, var(--accent-purple), var(--accent-teal));
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .header-right {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        .freshness-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            color: var(--text-secondary);
        }
        
        .freshness-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--success);
            animation: pulse 2s infinite;
        }
        
        .freshness-dot.stale {
            background: var(--warning);
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        /* Navigation Tabs */
        .nav-tabs {
            display: flex;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border);
            padding: 0 32px;
            overflow-x: auto;
        }
        
        .nav-tab {
            padding: 14px 20px;
            font-size: 13px;
            font-weight: 500;
            color: var(--text-secondary);
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
            white-space: nowrap;
        }
        
        .nav-tab:hover {
            color: var(--text-primary);
            background: rgba(255,255,255,0.02);
        }
        
        .nav-tab.active {
            color: var(--accent-teal);
            border-bottom-color: var(--accent-teal);
        }
        
        /* Main Content */
        .main-content {
            padding: 24px 32px;
            max-width: 1600px;
            margin: 0 auto;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* KPI Cards */
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }
        
        .kpi-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            transition: all 0.2s;
            position: relative;
        }
        
        .kpi-card:hover {
            border-color: var(--accent-teal);
            transform: translateY(-2px);
        }
        
        .kpi-card[title] {
            cursor: help;
        }
        
        .kpi-label {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-muted);
            margin-bottom: 8px;
        }
        
        .kpi-value {
            font-size: 28px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--text-primary), var(--accent-teal));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .kpi-subtitle {
            font-size: 12px;
            color: var(--text-secondary);
            margin-top: 4px;
        }
        
        .kpi-sample {
            font-size: 10px;
            color: var(--text-muted);
            margin-top: 4px;
            font-family: 'JetBrains Mono', monospace;
        }
        
        /* Cards */
        .card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        
        .card-title {
            font-size: 16px;
            font-weight: 600;
        }
        
        /* Quick Wins Card */
        .quick-wins-card {
            background: linear-gradient(135deg, rgba(0, 212, 170, 0.1), rgba(139, 92, 246, 0.1));
            border: 1px solid var(--accent-teal);
        }
        
        .quick-wins-card .card-title {
            color: var(--accent-teal);
        }
        
        .quick-win-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: var(--bg-card);
            border-radius: 8px;
            margin-bottom: 8px;
        }
        
        .quick-win-item:last-child {
            margin-bottom: 0;
        }
        
        .quick-win-zone {
            font-weight: 600;
        }
        
        .quick-win-action {
            font-size: 12px;
            color: var(--accent-teal);
        }
        
        /* Tables */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }
        
        .data-table th {
            text-align: left;
            padding: 12px;
            background: var(--bg-secondary);
            color: var(--text-secondary);
            font-weight: 500;
            text-transform: uppercase;
            font-size: 11px;
            letter-spacing: 0.5px;
            border-bottom: 1px solid var(--border);
            cursor: pointer;
        }
        
        .data-table th:hover {
            color: var(--accent-teal);
        }
        
        .data-table td {
            padding: 12px;
            border-bottom: 1px solid var(--border);
            color: var(--text-primary);
        }
        
        .data-table tr:hover td {
            background: var(--bg-card-hover);
        }
        
        /* Action cell */
        .action-cell {
            font-size: 12px;
            color: var(--accent-teal);
            max-width: 200px;
        }
        
        /* Badges */
        .badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .badge-core { background: rgba(34, 197, 94, 0.2); color: var(--tier-core); }
        .badge-preference { background: rgba(59, 130, 246, 0.2); color: var(--tier-preference); }
        .badge-demand { background: rgba(245, 158, 11, 0.2); color: var(--tier-demand); }
        .badge-deprioritised { background: rgba(100, 116, 139, 0.2); color: var(--tier-deprioritised); }
        .badge-prospect { background: rgba(139, 92, 246, 0.2); color: var(--tier-prospect); }
        .badge-high { background: rgba(239, 68, 68, 0.2); color: var(--error); }
        .badge-medium { background: rgba(245, 158, 11, 0.2); color: var(--warning); }
        .badge-low { background: rgba(34, 197, 94, 0.2); color: var(--success); }
        .badge-mvp { background: rgba(0, 212, 170, 0.2); color: var(--accent-teal); }
        
        /* Data quality indicators */
        .quality-dot {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 6px;
        }
        
        .quality-good { background: var(--success); }
        .quality-warn { background: var(--warning); }
        .quality-bad { background: var(--error); }
        
        /* Evidence badges */
        .evidence-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 600;
        }
        
        .evidence-validated { background: rgba(34, 197, 94, 0.2); color: var(--success); }
        .evidence-corroborated { background: rgba(245, 158, 11, 0.2); color: var(--warning); }
        .evidence-single { background: rgba(59, 130, 246, 0.2); color: var(--accent-blue); }
        
        /* Search box */
        .search-box {
            position: relative;
            flex: 1;
            max-width: 300px;
        }
        
        .search-input {
            width: 100%;
            padding: 10px 12px 10px 36px;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 13px;
            font-family: inherit;
        }
        
        .search-input:focus {
            outline: none;
            border-color: var(--accent-teal);
        }
        
        .search-input::placeholder {
            color: var(--text-muted);
        }
        
        .search-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
            font-size: 14px;
        }
        
        /* Filters */
        .filters {
            display: flex;
            gap: 12px;
            margin-bottom: 16px;
            flex-wrap: wrap;
            align-items: flex-end;
        }
        
        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        
        .filter-label {
            font-size: 10px;
            text-transform: uppercase;
            color: var(--text-muted);
            letter-spacing: 0.5px;
        }
        
        .filter-select {
            padding: 8px 12px;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 13px;
            font-family: inherit;
            cursor: pointer;
            min-width: 150px;
        }
        
        .filter-select:focus {
            outline: none;
            border-color: var(--accent-teal);
        }
        
        /* Charts */
        .chart-container {
            position: relative;
            height: 400px;
            margin: 20px 0;
        }
        
        /* Grid layouts */
        .grid-2 {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }
        
        .grid-3 {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
        }
        
        .grid-4 {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
        }
        
        @media (max-width: 1200px) {
            .grid-2, .grid-3 {
                grid-template-columns: 1fr;
            }
            .grid-4 {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        /* Quick insights */
        .quick-insights {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 16px;
        }
        
        .insight-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 16px;
        }
        
        .insight-title {
            font-size: 12px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 12px;
        }
        
        .insight-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid var(--border);
        }
        
        .insight-item:last-child {
            border-bottom: none;
        }
        
        /* Warning box */
        .warning-box {
            background: rgba(245, 158, 11, 0.1);
            border: 1px solid rgba(245, 158, 11, 0.3);
            border-radius: 8px;
            padding: 12px 16px;
            margin-bottom: 16px;
            display: flex;
            align-items: flex-start;
            gap: 12px;
        }
        
        .warning-icon {
            color: var(--warning);
            font-size: 18px;
        }
        
        .warning-text {
            font-size: 13px;
            color: var(--text-secondary);
        }
        
        /* Info box */
        .info-box {
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 8px;
            padding: 12px 16px;
            margin-bottom: 16px;
        }
        
        .info-box-title {
            font-weight: 600;
            color: var(--accent-blue);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }
        
        .info-box-content {
            font-size: 13px;
            color: var(--text-secondary);
            line-height: 1.6;
        }
        
        .info-box-content.collapsed {
            display: none;
        }
        
        /* Methodology panel */
        .methodology-panel {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            margin-bottom: 20px;
        }
        
        .methodology-header {
            padding: 16px 20px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .methodology-header:hover {
            background: var(--bg-card-hover);
        }
        
        .methodology-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--accent-blue);
        }
        
        .methodology-toggle {
            color: var(--text-muted);
            transition: transform 0.2s;
        }
        
        .methodology-toggle.open {
            transform: rotate(180deg);
        }
        
        .methodology-content {
            padding: 0 20px 20px;
            display: none;
        }
        
        .methodology-content.open {
            display: block;
        }
        
        .weight-bar {
            display: flex;
            height: 24px;
            border-radius: 4px;
            overflow: hidden;
            margin: 12px 0;
        }
        
        .weight-segment {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: 600;
            color: white;
        }
        
        /* Source citation */
        .source-citation {
            font-size: 11px;
            color: var(--text-muted);
            margin-top: 8px;
            font-style: italic;
        }
        
        /* Progress bars */
        .progress-bar {
            height: 6px;
            background: var(--bg-secondary);
            border-radius: 3px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            border-radius: 3px;
            transition: width 0.5s ease;
        }
        
        /* Export button */
        .export-btn {
            padding: 8px 16px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 12px;
            font-family: inherit;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.2s;
        }
        
        .export-btn:hover {
            background: var(--bg-card-hover);
            border-color: var(--accent-teal);
        }
        
        /* Scatter plot quadrants */
        .quadrant-legend {
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
            margin-top: 12px;
        }
        
        .quadrant-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
            color: var(--text-secondary);
        }
        
        .quadrant-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }
        
        /* Evidence breakdown */
        .evidence-breakdown {
            background: var(--bg-secondary);
            border-radius: 8px;
            padding: 16px;
            margin-top: 12px;
        }
        
        .evidence-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid var(--border);
        }
        
        .evidence-row:last-child {
            border-bottom: none;
        }
        
        .evidence-source {
            font-size: 12px;
            color: var(--text-secondary);
        }
        
        .evidence-value {
            font-size: 12px;
            font-weight: 600;
            font-family: 'JetBrains Mono', monospace;
        }
        
        /* Dish evidence card */
        .dish-evidence-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 12px;
        }
        
        .dish-evidence-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .dish-evidence-title {
            font-weight: 600;
            font-size: 14px;
        }
        
        .dish-evidence-rank {
            font-size: 12px;
            color: var(--text-muted);
        }
        
        /* Results count */
        .results-count {
            font-size: 12px;
            color: var(--text-muted);
            margin-bottom: 12px;
        }
        
        /* Weight sliders */
        .weight-sliders {
            background: var(--bg-secondary);
            border-radius: 8px;
            padding: 16px;
            margin-top: 16px;
        }
        
        .slider-group {
            margin-bottom: 16px;
        }
        
        .slider-group:last-child {
            margin-bottom: 0;
        }
        
        .slider-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .slider-label {
            font-size: 13px;
            font-weight: 500;
        }
        
        .slider-value {
            font-size: 13px;
            font-weight: 600;
            font-family: 'JetBrains Mono', monospace;
            min-width: 40px;
            text-align: right;
        }
        
        .weight-slider {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: var(--bg-card);
            outline: none;
            -webkit-appearance: none;
            appearance: none;
            cursor: pointer;
        }
        
        .weight-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: var(--accent-teal);
            cursor: pointer;
            transition: transform 0.1s;
        }
        
        .weight-slider::-webkit-slider-thumb:hover {
            transform: scale(1.2);
        }
        
        .weight-slider::-moz-range-thumb {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: var(--accent-teal);
            cursor: pointer;
            border: none;
        }
        
        .weight-slider.performance::-webkit-slider-thumb { background: var(--success); }
        .weight-slider.opportunity::-webkit-slider-thumb { background: var(--warning); }
        .weight-slider.context::-webkit-slider-thumb { background: var(--accent-blue); }
        
        .weight-slider.performance::-moz-range-thumb { background: var(--success); }
        .weight-slider.opportunity::-moz-range-thumb { background: var(--warning); }
        .weight-slider.context::-moz-range-thumb { background: var(--accent-blue); }
        
        .weight-total {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 12px;
            border-top: 1px solid var(--border);
            margin-top: 12px;
        }
        
        .weight-total-label {
            font-size: 12px;
            color: var(--text-muted);
        }
        
        .weight-total-value {
            font-size: 14px;
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
        }
        
        .weight-total-value.valid { color: var(--success); }
        .weight-total-value.invalid { color: var(--error); }
        
        .recalculate-btn {
            width: 100%;
            padding: 10px;
            background: linear-gradient(135deg, var(--accent-teal), var(--accent-purple));
            border: none;
            border-radius: 8px;
            color: white;
            font-size: 13px;
            font-weight: 600;
            font-family: inherit;
            cursor: pointer;
            margin-top: 12px;
            transition: transform 0.1s, opacity 0.2s;
        }
        
        .recalculate-btn:hover {
            transform: translateY(-1px);
            opacity: 0.9;
        }
        
        .recalculate-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        /* 2x2 Matrix */
        .matrix-container {
            position: relative;
            width: 100%;
            height: 450px;
            background: var(--bg-secondary);
            border-radius: 8px;
            overflow: hidden;
        }
        
        .matrix-quadrant {
            position: absolute;
            width: 50%;
            height: 50%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 12px;
            transition: background 0.2s;
        }
        
        .matrix-quadrant:hover {
            filter: brightness(1.1);
        }
        
        .quadrant-top-left {
            top: 0;
            left: 0;
            background: rgba(245, 158, 11, 0.15);
            border-right: 1px solid var(--border);
            border-bottom: 1px solid var(--border);
        }
        
        .quadrant-top-right {
            top: 0;
            right: 0;
            background: rgba(34, 197, 94, 0.15);
            border-bottom: 1px solid var(--border);
        }
        
        .quadrant-bottom-left {
            bottom: 0;
            left: 0;
            background: rgba(100, 116, 139, 0.15);
            border-right: 1px solid var(--border);
        }
        
        .quadrant-bottom-right {
            bottom: 0;
            right: 0;
            background: rgba(59, 130, 246, 0.15);
        }
        
        .quadrant-label {
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
            opacity: 0.7;
        }
        
        .quadrant-top-left .quadrant-label { color: var(--warning); }
        .quadrant-top-right .quadrant-label { color: var(--success); }
        .quadrant-bottom-left .quadrant-label { color: var(--text-muted); }
        .quadrant-bottom-right .quadrant-label { color: var(--accent-blue); }
        
        .quadrant-dishes {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            justify-content: center;
            max-height: 160px;
            overflow-y: auto;
        }
        
        .dish-bubble {
            padding: 6px 10px;
            border-radius: 16px;
            font-size: 11px;
            font-weight: 500;
            cursor: pointer;
            transition: transform 0.1s, box-shadow 0.2s;
            white-space: nowrap;
        }
        
        .dish-bubble:hover {
            transform: scale(1.05);
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }
        
        .dish-bubble.develop { background: rgba(245, 158, 11, 0.3); color: var(--warning); }
        .dish-bubble.priority { background: rgba(34, 197, 94, 0.3); color: var(--success); }
        .dish-bubble.monitor { background: rgba(100, 116, 139, 0.3); color: var(--text-secondary); }
        .dish-bubble.protect { background: rgba(59, 130, 246, 0.3); color: var(--accent-blue); }
        .dish-bubble.prospect { background: rgba(139, 92, 246, 0.3); color: var(--accent-purple); border: 1px dashed var(--accent-purple); }
        
        .matrix-axis-label {
            position: absolute;
            font-size: 11px;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .matrix-axis-x {
            bottom: 8px;
            left: 50%;
            transform: translateX(-50%);
        }
        
        .matrix-axis-y {
            left: 8px;
            top: 50%;
            transform: translateY(-50%) rotate(-90deg);
            transform-origin: center;
        }
        
        .matrix-axis-arrow {
            position: absolute;
            color: var(--text-muted);
            font-size: 10px;
        }
        
        .arrow-right { right: 8px; bottom: 6px; }
        .arrow-up { left: 6px; top: 8px; }
        
        /* Dish tooltip */
        .dish-tooltip {
            position: fixed;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 12px;
            font-size: 12px;
            max-width: 280px;
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(0,0,0,0.4);
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.15s;
        }
        
        .dish-tooltip.visible {
            opacity: 1;
        }
        
        .dish-tooltip-header {
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 8px;
            color: var(--accent-teal);
        }
        
        .dish-tooltip-row {
            display: flex;
            justify-content: space-between;
            padding: 4px 0;
            border-bottom: 1px solid var(--border);
        }
        
        .dish-tooltip-row:last-child {
            border-bottom: none;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-left">
            <h1>Consumer Insight Tracker</h1>
            <span class="header-badge">Dinneroo</span>
        </div>
        <div class="header-right">
            <div class="freshness-indicator">
                <span class="freshness-dot" id="freshness-dot"></span>
                <span id="lastUpdated">Data: Jan 7, 2026</span>
            </div>
            <button class="export-btn" onclick="exportData()">
                <span>‚Üì</span> Export CSV
            </button>
        </div>
    </header>
    
    <!-- Navigation Tabs -->
    <nav class="nav-tabs">
        <div class="nav-tab active" data-tab="overview">Overview</div>
        <div class="nav-tab" data-tab="dishes">Dish Demand</div>
        <div class="nav-tab" data-tab="gaps">Cuisine Gaps</div>
        <div class="nav-tab" data-tab="demand">Latent Demand</div>
        <div class="nav-tab" data-tab="zones">Zone Priorities</div>
        <div class="nav-tab" data-tab="evidence">Evidence</div>
        <div class="nav-tab" data-tab="operational">Operational</div>
    </nav>
    
    <!-- Main Content -->
    <main class="main-content">
        <!-- Tab 1: Overview -->
        <section id="overview" class="tab-content active">
            <div class="kpi-grid">
                <div class="kpi-card" title="Post-Order Survey (n=1,599) + Dropoff Survey (n=838)">
                    <div class="kpi-label">Survey Responses</div>
                    <div class="kpi-value" id="kpi-surveys">2,437</div>
                    <div class="kpi-subtitle">Post-Order + Dropoff</div>
                    <div class="kpi-sample">n=2,437 total responses</div>
                </div>
                <div class="kpi-card" title="Source: Snowflake ALL_DINNEROO_ORDERS.csv">
                    <div class="kpi-label">Orders Analyzed</div>
                    <div class="kpi-value" id="kpi-orders">82,350</div>
                    <div class="kpi-subtitle">Revealed preference</div>
                    <div class="kpi-sample">n=82,350 orders</div>
                </div>
                <div class="kpi-card" title="23 on platform, 9 prospects for recruitment">
                    <div class="kpi-label">Dishes Scored</div>
                    <div class="kpi-value" id="kpi-dishes">32</div>
                    <div class="kpi-subtitle">23 on platform, 9 prospects</div>
                    <div class="kpi-sample">Full scoring framework</div>
                </div>
                <div class="kpi-card" title="Zones with order data for gap analysis">
                    <div class="kpi-label">Zones Analyzed</div>
                    <div class="kpi-value" id="kpi-zones">100</div>
                    <div class="kpi-subtitle">With gap analysis</div>
                    <div class="kpi-sample">n=100 active zones</div>
                </div>
                <div class="kpi-card" title="Source: DINNEROO_RATINGS.csv (n=10,713)">
                    <div class="kpi-label">Avg Rating</div>
                    <div class="kpi-value" id="kpi-rating">4.4</div>
                    <div class="kpi-subtitle">From customer ratings</div>
                    <div class="kpi-sample">n=10,713 ratings</div>
                </div>
                <div class="kpi-card" title="Zones meeting MVP criteria (5+ partners, 5+ cuisines, 20+ dishes)">
                    <div class="kpi-label">MVP Zones</div>
                    <div class="kpi-value" id="kpi-mvp">0</div>
                    <div class="kpi-subtitle">Meeting all criteria</div>
                    <div class="kpi-sample">5+ partners, 5+ cuisines</div>
                </div>
            </div>
            
            <!-- Quick Wins Card -->
            <div class="card quick-wins-card">
                <div class="card-header">
                    <div class="card-title">‚ö° Quick Wins - Zones 1 Partner from MVP</div>
                </div>
                <div id="quick-wins-content">
                    <p style="color: var(--text-muted);">Loading quick wins...</p>
                </div>
            </div>
            
            <div class="quick-insights">
                <div class="insight-card">
                    <div class="insight-title">Top Dishes by Demand</div>
                    <div id="top-dishes"></div>
                </div>
                <div class="insight-card">
                    <div class="insight-title">Top Cuisine Gaps</div>
                    <div id="top-gaps"></div>
                </div>
                <div class="insight-card">
                    <div class="insight-title">High Priority Zones</div>
                    <div id="priority-zones"></div>
                </div>
            </div>
            
            <div class="card" style="margin-top: 24px;">
                <div class="card-header">
                    <div class="card-title">Data Sources Summary</div>
                </div>
                <table class="data-table" id="sources-table">
                    <thead>
                        <tr>
                            <th>Source</th>
                            <th>Type</th>
                            <th>Sample Size</th>
                            <th>Last Updated</th>
                            <th>Quality</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </section>
        
        <!-- Tab 2: Dish Demand Matrix -->
        <section id="dishes" class="tab-content">
            <div class="grid-2">
                <!-- Left: 2x2 Matrix -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Performance vs Opportunity Matrix</div>
                    </div>
                    
                    <div class="matrix-container" id="dish-matrix">
                        <!-- Axis labels -->
                        <span class="matrix-axis-label matrix-axis-x">Performance ‚Üí</span>
                        <span class="matrix-axis-label matrix-axis-y">Opportunity ‚Üí</span>
                        <span class="matrix-axis-arrow arrow-right">HIGH</span>
                        <span class="matrix-axis-arrow arrow-up">HIGH</span>
                        
                        <!-- Quadrants -->
                        <div class="matrix-quadrant quadrant-top-left" id="quadrant-develop">
                            <div class="quadrant-label">üå± Develop</div>
                            <div class="quadrant-dishes" id="dishes-develop"></div>
                        </div>
                        <div class="matrix-quadrant quadrant-top-right" id="quadrant-priority">
                            <div class="quadrant-label">‚≠ê Priority</div>
                            <div class="quadrant-dishes" id="dishes-priority"></div>
                        </div>
                        <div class="matrix-quadrant quadrant-bottom-left" id="quadrant-monitor">
                            <div class="quadrant-label">üëÅÔ∏è Monitor</div>
                            <div class="quadrant-dishes" id="dishes-monitor"></div>
                        </div>
                        <div class="matrix-quadrant quadrant-bottom-right" id="quadrant-protect">
                            <div class="quadrant-label">üõ°Ô∏è Protect</div>
                            <div class="quadrant-dishes" id="dishes-protect"></div>
                        </div>
                    </div>
                    
                    <div class="quadrant-legend" style="margin-top: 16px;">
                        <div class="quadrant-item"><span class="quadrant-dot" style="background: var(--success)"></span> Priority: High perf + High opp</div>
                        <div class="quadrant-item"><span class="quadrant-dot" style="background: var(--accent-blue)"></span> Protect: High perf + Low opp</div>
                        <div class="quadrant-item"><span class="quadrant-dot" style="background: var(--warning)"></span> Develop: Low perf + High opp</div>
                        <div class="quadrant-item"><span class="quadrant-dot" style="background: var(--text-muted)"></span> Monitor: Low perf + Low opp</div>
                        <div class="quadrant-item"><span class="quadrant-dot" style="background: var(--accent-purple); border: 1px dashed var(--accent-purple);"></span> Prospect (not on platform)</div>
                    </div>
                </div>
                
                <!-- Right: Weight Sliders + Rankings -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Adjust Scoring Weights</div>
                    </div>
                    
                    <div class="weight-sliders">
                        <div class="slider-group">
                            <div class="slider-header">
                                <span class="slider-label" style="color: var(--success);">Performance</span>
                                <span class="slider-value" id="weight-performance-value">50%</span>
                            </div>
                            <input type="range" class="weight-slider performance" id="weight-performance" min="0" max="100" value="50">
                            <div style="font-size: 10px; color: var(--text-muted); margin-top: 4px;">Sales, ratings, satisfaction, repeat intent</div>
                        </div>
                        
                        <div class="slider-group">
                            <div class="slider-header">
                                <span class="slider-label" style="color: var(--warning);">Opportunity</span>
                                <span class="slider-value" id="weight-opportunity-value">30%</span>
                            </div>
                            <input type="range" class="weight-slider opportunity" id="weight-opportunity" min="0" max="100" value="30">
                            <div style="font-size: 10px; color: var(--text-muted); margin-top: 4px;">Suitability, open-text requests, wishlist</div>
                        </div>
                        
                        <div class="slider-group">
                            <div class="slider-header">
                                <span class="slider-label" style="color: var(--accent-blue);">Context</span>
                                <span class="slider-value" id="weight-context-value">20%</span>
                            </div>
                            <input type="range" class="weight-slider context" id="weight-context" min="0" max="100" value="20">
                            <div style="font-size: 10px; color: var(--text-muted); margin-top: 4px;">Demand strength, preference, coverage gap</div>
                        </div>
                        
                        <div class="weight-total">
                            <span class="weight-total-label">Total Weight</span>
                            <span class="weight-total-value valid" id="weight-total">100%</span>
                        </div>
                        
                        <button class="recalculate-btn" id="recalculate-btn" onclick="recalculateScores()">
                            üîÑ Recalculate Rankings
                        </button>
                    </div>
                    
                    <div class="filters" style="margin-top: 16px;">
                        <div class="filter-group">
                            <label class="filter-label">Cuisine</label>
                            <select class="filter-select" id="filter-cuisine">
                                <option value="">All Cuisines</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label class="filter-label">Status</label>
                            <select class="filter-select" id="filter-status">
                                <option value="">All</option>
                                <option value="true">On Dinneroo</option>
                                <option value="false">Prospect</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="results-count" id="dish-results-count">Showing 32 dishes</div>
                    <div style="max-height: 280px; overflow-y: auto;">
                        <table class="data-table" id="dish-table">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Dish</th>
                                    <th>Score</th>
                                    <th>Quadrant</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Dish Tooltip -->
            <div class="dish-tooltip" id="dish-tooltip">
                <div class="dish-tooltip-header" id="tooltip-dish-name"></div>
                <div class="dish-tooltip-row">
                    <span>Performance Score</span>
                    <span id="tooltip-performance"></span>
                </div>
                <div class="dish-tooltip-row">
                    <span>Opportunity Score</span>
                    <span id="tooltip-opportunity"></span>
                </div>
                <div class="dish-tooltip-row">
                    <span>Weighted Score</span>
                    <span id="tooltip-weighted"></span>
                </div>
                <div class="dish-tooltip-row">
                    <span>Rating</span>
                    <span id="tooltip-rating"></span>
                </div>
                <div class="dish-tooltip-row">
                    <span>Avg Sales</span>
                    <span id="tooltip-sales"></span>
                </div>
            </div>
        </section>
        
        <!-- Tab 3: Cuisine Gaps -->
        <section id="gaps" class="tab-content">
            <div class="filters">
                <div class="filter-group">
                    <label class="filter-label">Region</label>
                    <select class="filter-select" id="filter-region">
                        <option value="">All Regions</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">Gap Type</label>
                    <select class="filter-select" id="filter-gap-type">
                        <option value="">All Types</option>
                        <option value="SUPPLY GAP">Supply Gap</option>
                        <option value="QUALITY GAP">Quality Gap</option>
                        <option value="OK">No Gap</option>
                    </select>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <div class="card-title">Cuisine Gap Analysis</div>
                </div>
                <table class="data-table" id="cuisine-gap-table">
                    <thead>
                        <tr>
                            <th>Cuisine</th>
                            <th>Items</th>
                            <th>Brands</th>
                            <th>Orders</th>
                            <th>Avg Rating</th>
                            <th>Gap Type</th>
                            <th>Supply vs Avg</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
                <p class="source-citation">Source: Anna's Ground Truth + Snowflake Orders</p>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <div class="card-title">Zone Coverage Heatmap</div>
                </div>
                <div class="chart-container">
                    <canvas id="zone-heatmap-chart"></canvas>
                </div>
            </div>
        </section>
        
        <!-- Tab 4: Latent Demand -->
        <section id="demand" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <div class="card-title">Latent Demand Signals</div>
                </div>
                <p class="source-citation">Sources: Dropoff Survey (n=942), Post-Order Survey (n=1,599), Ratings Comments (n=10,713)</p>
                <div id="latent-demand-content"></div>
            </div>
            
            <div class="grid-2" style="margin-top: 20px;">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Top Requested Dishes</div>
                    </div>
                    <div class="chart-container" style="height: 300px;">
                        <canvas id="demand-bar-chart"></canvas>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Demand by Category</div>
                    </div>
                    <div class="chart-container" style="height: 300px;">
                        <canvas id="demand-doughnut-chart"></canvas>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Tab 5: Zone Priorities -->
        <section id="zones" class="tab-content">
            <div class="filters">
                <div class="search-box">
                    <span class="search-icon">üîç</span>
                    <input type="text" class="search-input" id="zone-search" placeholder="Search zones (e.g., Finsbury Park, Clapham...)">
                </div>
                <div class="filter-group">
                    <label class="filter-label">Region</label>
                    <select class="filter-select" id="filter-zone-region">
                        <option value="">All Regions</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">MVP Status</label>
                    <select class="filter-select" id="filter-mvp">
                        <option value="">All</option>
                        <option value="true">MVP Ready</option>
                        <option value="false">Not MVP</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">Priority</label>
                    <select class="filter-select" id="filter-zone-priority">
                        <option value="">All</option>
                        <option value="High">High</option>
                        <option value="Medium">Medium</option>
                        <option value="Low">Low</option>
                    </select>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <div class="card-title">Zone Recruitment Priorities</div>
                </div>
                <div class="results-count" id="zone-results-count">Showing 100 zones</div>
                <div style="max-height: 600px; overflow-y: auto;">
                    <table class="data-table" id="zone-table">
                        <thead>
                            <tr>
                                <th>Zone</th>
                                <th>Region</th>
                                <th>Orders</th>
                                <th>Partners</th>
                                <th>Cuisines</th>
                                <th>Rating</th>
                                <th>MVP</th>
                                <th>Priority</th>
                                <th>Action Required</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </section>
        
        <!-- Tab 6: Evidence -->
        <section id="evidence" class="tab-content">
            <div class="warning-box">
                <span class="warning-icon">‚ö†</span>
                <div class="warning-text">
                    <strong>Evidence Standards:</strong> Recommendations require triangulation from 2+ independent sources. 
                    Historical survey data (OG Survey) is flagged as "stated preference" and must be validated with behavioral data.
                </div>
            </div>
            
            <div class="grid-2">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Stated vs Revealed Preference</div>
                    </div>
                    <p style="color: var(--text-secondary); font-size: 13px; margin-bottom: 16px;">
                        Comparing what customers say they want (surveys) vs what they actually order (Snowflake)
                    </p>
                    <div class="chart-container" style="height: 300px;">
                        <canvas id="stated-revealed-chart"></canvas>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Evidence Level Distribution</div>
                    </div>
                    <div style="margin-top: 20px;">
                        <div style="margin-bottom: 16px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                                <span style="font-size: 13px;"><span class="quality-dot quality-good"></span>Validated (3+ sources)</span>
                                <span class="evidence-badge evidence-validated">12 insights</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 40%; background: var(--success);"></div>
                            </div>
                        </div>
                        <div style="margin-bottom: 16px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                                <span style="font-size: 13px;"><span class="quality-dot quality-warn"></span>Corroborated (2 sources)</span>
                                <span class="evidence-badge evidence-corroborated">18 insights</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 60%; background: var(--warning);"></div>
                            </div>
                        </div>
                        <div style="margin-bottom: 16px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                                <span style="font-size: 13px;"><span class="quality-dot quality-bad"></span>Single Source</span>
                                <span class="evidence-badge evidence-single">5 insights</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 17%; background: var(--accent-blue);"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Dish Evidence Breakdown -->
            <div class="card" style="margin-top: 20px;">
                <div class="card-header">
                    <div class="card-title">Why is Each Dish Ranked? (Top 5)</div>
                </div>
                <div id="dish-evidence-breakdown"></div>
            </div>
            
            <div class="card" style="margin-top: 20px;">
                <div class="card-header">
                    <div class="card-title">Source Confidence Matrix</div>
                </div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Insight Type</th>
                            <th>Primary Source</th>
                            <th>Triangulation</th>
                            <th>Evidence Level</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Dish Demand</td>
                            <td><span class="quality-dot quality-good"></span>Snowflake Orders (n=82,350)</td>
                            <td>Surveys + Transcripts</td>
                            <td><span class="evidence-badge evidence-validated">Validated</span></td>
                        </tr>
                        <tr>
                            <td>Customer Barriers</td>
                            <td><span class="quality-dot quality-good"></span>Dropoff Survey (n=942)</td>
                            <td>Bounce + Transcripts</td>
                            <td><span class="evidence-badge evidence-corroborated">Corroborated</span></td>
                        </tr>
                        <tr>
                            <td>Dish Preferences</td>
                            <td><span class="quality-dot quality-warn"></span>OG Survey (n=400)</td>
                            <td>Orders (validation)</td>
                            <td><span class="evidence-badge evidence-single">Single - Flagged</span></td>
                        </tr>
                        <tr>
                            <td>Zone Performance</td>
                            <td><span class="quality-dot quality-good"></span>Anna's Ground Truth</td>
                            <td>Snowflake Orders</td>
                            <td><span class="evidence-badge evidence-validated">Validated</span></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>
        
        <!-- Tab 7: Operational -->
        <section id="operational" class="tab-content">
            <div class="grid-2">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Partner Performance</div>
                    </div>
                    <div id="partner-performance-content">
                        <table class="data-table" id="partner-table">
                            <thead>
                                <tr>
                                    <th>Partner</th>
                                    <th>Orders</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                    <p class="source-citation">Source: Snowflake Orders (n=82,350)</p>
                </div>
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Rating Distribution</div>
                    </div>
                    <div class="chart-container" style="height: 300px;">
                        <canvas id="rating-dist-chart"></canvas>
                    </div>
                    <p class="source-citation">Source: DINNEROO_RATINGS.csv (n=10,713)</p>
                </div>
            </div>
            
            <div class="card" style="margin-top: 20px;">
                <div class="card-header">
                    <div class="card-title">Top Zones by Volume</div>
                </div>
                <div class="chart-container" style="height: 300px;">
                    <canvas id="zone-volume-chart"></canvas>
                </div>
            </div>
        </section>
    </main>
    
    <script>
        // Dashboard Data - Will be populated from JSON
        let DASHBOARD_DATA = null;
        
        // Load data
        async function loadData() {
            try {
                const response = await fetch('../data/dashboard_data.json');
                DASHBOARD_DATA = await response.json();
                initializeDashboard();
            } catch (error) {
                console.error('Failed to load data:', error);
                // Use embedded fallback data
                initializeWithFallback();
            }
        }
        
        function initializeWithFallback() {
            // Minimal fallback data
            DASHBOARD_DATA = {
                metadata: { generated: new Date().toISOString() },
                dishes: [],
                zones: [],
                cuisineGaps: [],
                behavioral: { orders: { topZones: [], topPartners: [] }, ratings: { ratingDistribution: {} } }
            };
            initializeDashboard();
        }
        
        function initializeDashboard() {
            setupNavigation();
            populateOverview();
            populateDishes();
            populateCuisineGaps();
            populateZones();
            populateOperational();
            populateEvidence();
            setupFilters();
            setupSearch();
        }
        
        // Navigation
        function setupNavigation() {
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    tab.classList.add('active');
                    document.getElementById(tab.dataset.tab).classList.add('active');
                });
            });
        }
        
        // Methodology toggle
        function toggleMethodology() {
            const content = document.getElementById('methodology-content');
            const toggle = document.getElementById('methodology-toggle');
            content.classList.toggle('open');
            toggle.classList.toggle('open');
        }
        
        // Overview Tab
        function populateOverview() {
            if (!DASHBOARD_DATA) return;
            
            // Update KPIs
            const meta = DASHBOARD_DATA.metadata?.sources || {};
            const behavioral = DASHBOARD_DATA.behavioral || {};
            
            document.getElementById('kpi-surveys').textContent = 
                ((meta.postOrder?.n || 0) + (meta.dropoff?.n || 0)).toLocaleString();
            document.getElementById('kpi-orders').textContent = 
                (behavioral.orders?.totalOrders || 82350).toLocaleString();
            document.getElementById('kpi-dishes').textContent = 
                (DASHBOARD_DATA.dishes?.length || 32).toString();
            document.getElementById('kpi-zones').textContent = 
                (DASHBOARD_DATA.zones?.length || 100).toString();
            document.getElementById('kpi-rating').textContent = 
                (behavioral.ratings?.avgRating || 4.4).toFixed(1);
            
            // MVP zones count
            const mvpZones = (DASHBOARD_DATA.zones || []).filter(z => z.isMvp).length;
            document.getElementById('kpi-mvp').textContent = mvpZones.toString();
            
            // Quick Wins - zones 1 partner from MVP (4 partners, need 5)
            const quickWins = (DASHBOARD_DATA.zones || [])
                .filter(z => z.partners === 4 && !z.isMvp)
                .sort((a, b) => (b.orders || 0) - (a.orders || 0))
                .slice(0, 5);
            
            const quickWinsHtml = quickWins.length > 0 
                ? quickWins.map(z => {
                    const missingCuisine = getMissingCuisine(z);
                    return `
                        <div class="quick-win-item">
                            <div>
                                <div class="quick-win-zone">${z.zone}</div>
                                <div style="font-size: 11px; color: var(--text-muted);">${z.orders?.toLocaleString() || 0} orders | ${z.partners} partners</div>
                            </div>
                            <div class="quick-win-action">+1 partner to MVP${missingCuisine ? ` (need ${missingCuisine})` : ''}</div>
                        </div>
                    `;
                }).join('')
                : '<p style="color: var(--text-muted);">No zones are 1 partner away from MVP</p>';
            
            document.getElementById('quick-wins-content').innerHTML = quickWinsHtml;
            
            // Top dishes
            const topDishes = (DASHBOARD_DATA.dishes || []).slice(0, 5);
            const dishesHtml = topDishes.map((d, i) => `
                <div class="insight-item">
                    <span>${i + 1}. ${d.dishType}</span>
                    <span class="badge badge-${getPriorityClass(d.strategicPriority)}">${d.strategicPriority}</span>
                </div>
            `).join('');
            document.getElementById('top-dishes').innerHTML = dishesHtml;
            
            // Top gaps
            const gaps = (DASHBOARD_DATA.cuisineGaps || []).filter(g => g.gapType !== 'OK').slice(0, 5);
            const gapsHtml = gaps.map(g => `
                <div class="insight-item">
                    <span>${g.cuisine}</span>
                    <span class="badge badge-${g.gapType === 'SUPPLY GAP' ? 'high' : 'medium'}">${g.gapType}</span>
                </div>
            `).join('');
            document.getElementById('top-gaps').innerHTML = gapsHtml || '<p style="color: var(--text-muted);">No significant gaps</p>';
            
            // Priority zones
            const priorityZones = (DASHBOARD_DATA.zones || [])
                .filter(z => z.recruitmentPriority === 'High')
                .slice(0, 5);
            const zonesHtml = priorityZones.map(z => `
                <div class="insight-item">
                    <span>${z.zone}</span>
                    <span class="badge badge-high">High Priority</span>
                </div>
            `).join('');
            document.getElementById('priority-zones').innerHTML = zonesHtml || '<p style="color: var(--text-muted);">No high priority zones</p>';
            
            // Sources table with quality indicators
            const sources = DASHBOARD_DATA.metadata?.sources || {};
            const sourcesBody = document.querySelector('#sources-table tbody');
            sourcesBody.innerHTML = Object.entries(sources).map(([key, src]) => {
                const quality = getQualityIndicator(src);
                return `
                    <tr>
                        <td>${src.name}</td>
                        <td><span class="badge badge-${src.type === 'behavioral' ? 'core' : src.type === 'survey' ? 'preference' : 'prospect'}">${src.type}</span></td>
                        <td>${src.n ? 'n=' + src.n.toLocaleString() : (src.dishes ? src.dishes + ' dishes' : '-')}</td>
                        <td>${src.lastUpdated || '-'}</td>
                        <td><span class="quality-dot quality-${quality.class}"></span>${quality.label}</td>
                    </tr>
                `;
            }).join('');
        }
        
        function getMissingCuisine(zone) {
            if (!zone.missingEssentialCuisines) return null;
            try {
                const missing = JSON.parse(zone.missingEssentialCuisines.replace(/'/g, '"'));
                return missing[0] || null;
            } catch {
                return null;
            }
        }
        
        function getQualityIndicator(source) {
            if (source.biasWarning) return { class: 'warn', label: 'Bias Warning' };
            if (!source.lastUpdated) return { class: 'warn', label: 'Unknown' };
            
            const lastUpdate = new Date(source.lastUpdated);
            const daysSince = Math.floor((new Date() - lastUpdate) / (1000 * 60 * 60 * 24));
            
            if (daysSince > 30) return { class: 'warn', label: 'Stale (>30d)' };
            if (daysSince > 7) return { class: 'warn', label: 'Review (>7d)' };
            return { class: 'good', label: 'Fresh' };
        }
        
        function getPriorityClass(priority) {
            const map = {
                'Core Driver': 'core',
                'Preference Driver': 'preference',
                'Demand Booster': 'demand',
                'Deprioritised': 'deprioritised',
                'Prospect': 'prospect'
            };
            return map[priority] || 'deprioritised';
        }
        
        // Dishes Tab
        function populateDishes() {
            if (!DASHBOARD_DATA?.dishes) return;
            
            const dishes = DASHBOARD_DATA.dishes;
            
            // Populate filters
            const cuisines = [...new Set(dishes.map(d => d.cuisine).filter(Boolean))];
            const priorities = [...new Set(dishes.map(d => d.strategicPriority).filter(Boolean))];
            
            const cuisineSelect = document.getElementById('filter-cuisine');
            cuisines.forEach(c => {
                const opt = document.createElement('option');
                opt.value = c;
                opt.textContent = c;
                cuisineSelect.appendChild(opt);
            });
            
            const prioritySelect = document.getElementById('filter-priority');
            priorities.forEach(p => {
                const opt = document.createElement('option');
                opt.value = p;
                opt.textContent = p;
                prioritySelect.appendChild(opt);
            });
            
            // Populate table
            renderDishTable(dishes);
            
            // Create scatter chart
            createDishScatterChart(dishes);
        }
        
        function renderDishTable(dishes) {
            const tbody = document.querySelector('#dish-table tbody');
            document.getElementById('dish-results-count').textContent = `Showing ${dishes.length} dishes`;
            
            tbody.innerHTML = dishes.map(d => {
                const sampleSize = d.performance?.avgSalesPerDish ? 'n=' + Math.round(d.performance.avgSalesPerDish * 10) : '-';
                return `
                    <tr>
                        <td>${d.rank || '-'}</td>
                        <td><strong>${d.dishType}</strong> ${!d.onDinneroo ? '<span class="badge badge-prospect">Prospect</span>' : ''}</td>
                        <td>${d.cuisine}</td>
                        <td><span class="badge badge-${getPriorityClass(d.strategicPriority)}">${d.strategicPriority}</span></td>
                        <td>${d.performance?.deliverooRating?.toFixed(1) || '-'}</td>
                        <td style="font-size: 11px; color: var(--text-muted);">${sampleSize}</td>
                    </tr>
                `;
            }).join('');
        }
        
        function createDishScatterChart(dishes) {
            const ctx = document.getElementById('dish-scatter-chart').getContext('2d');
            
            const data = dishes.filter(d => d.onDinneroo && d.context?.demandStrength).map(d => ({
                x: d.context.demandStrength || 0,
                y: d.context.consumerPreference || 0,
                label: d.dishType,
                r: Math.sqrt(d.performance?.avgSalesPerDish || 10) * 2
            }));
            
            new Chart(ctx, {
                type: 'bubble',
                data: {
                    datasets: [{
                        label: 'Dishes',
                        data: data,
                        backgroundColor: data.map(d => {
                            if (d.x >= 1.5 && d.y >= 1) return 'rgba(34, 197, 94, 0.6)';
                            if (d.x >= 1.5 && d.y < 1) return 'rgba(59, 130, 246, 0.6)';
                            if (d.x < 1.5 && d.y >= 1) return 'rgba(245, 158, 11, 0.6)';
                            return 'rgba(100, 116, 139, 0.6)';
                        }),
                        borderColor: 'rgba(255,255,255,0.3)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: (ctx) => {
                                    const d = ctx.raw;
                                    return `${d.label}: Demand ${d.x.toFixed(1)}, Preference ${d.y.toFixed(1)}`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: { display: true, text: 'Demand Strength', color: '#94a3b8' },
                            grid: { color: 'rgba(255,255,255,0.05)' },
                            ticks: { color: '#94a3b8' }
                        },
                        y: {
                            title: { display: true, text: 'Consumer Preference', color: '#94a3b8' },
                            grid: { color: 'rgba(255,255,255,0.05)' },
                            ticks: { color: '#94a3b8' }
                        }
                    }
                }
            });
        }
        
        // Cuisine Gaps Tab
        function populateCuisineGaps() {
            if (!DASHBOARD_DATA?.cuisineGaps) return;
            
            const gaps = DASHBOARD_DATA.cuisineGaps;
            const tbody = document.querySelector('#cuisine-gap-table tbody');
            
            tbody.innerHTML = gaps.map(g => `
                <tr>
                    <td><strong>${g.cuisine}</strong></td>
                    <td>${g.itemCount?.toLocaleString() || '-'}</td>
                    <td>${g.brandCount || '-'}</td>
                    <td>${g.orderCount?.toLocaleString() || '-'}</td>
                    <td>${g.avgRating?.toFixed(2) || '-'}</td>
                    <td><span class="badge badge-${g.gapType === 'SUPPLY GAP' ? 'high' : g.gapType === 'QUALITY GAP' ? 'medium' : 'low'}">${g.gapType}</span></td>
                    <td>${g.supplyVsAvg?.toFixed(1) || '-'}%</td>
                </tr>
            `).join('');
        }
        
        // Zones Tab
        function populateZones() {
            if (!DASHBOARD_DATA?.zones) return;
            
            const zones = DASHBOARD_DATA.zones;
            
            // Populate region filter
            const regions = [...new Set(zones.map(z => z.region).filter(Boolean))];
            const regionSelect = document.getElementById('filter-zone-region');
            regions.forEach(r => {
                const opt = document.createElement('option');
                opt.value = r;
                opt.textContent = r;
                regionSelect.appendChild(opt);
            });
            
            renderZoneTable(zones);
        }
        
        function renderZoneTable(zones) {
            const tbody = document.querySelector('#zone-table tbody');
            document.getElementById('zone-results-count').textContent = `Showing ${zones.length} zones`;
            
            tbody.innerHTML = zones.map(z => {
                const action = getZoneAction(z);
                return `
                    <tr>
                        <td><strong>${z.zone}</strong></td>
                        <td>${z.region || '-'}</td>
                        <td>${z.orders?.toLocaleString() || '-'}</td>
                        <td>${z.partners || '-'}</td>
                        <td>${z.cuisinesCount || '-'}</td>
                        <td>${z.avgRating?.toFixed(2) || '-'}</td>
                        <td>${z.isMvp ? '<span class="badge badge-mvp">MVP</span>' : '<span class="badge badge-deprioritised">No</span>'}</td>
                        <td><span class="badge badge-${z.recruitmentPriority?.toLowerCase() || 'low'}">${z.recruitmentPriority || '-'}</span></td>
                        <td class="action-cell">${action}</td>
                    </tr>
                `;
            }).join('');
        }
        
        function getZoneAction(zone) {
            if (zone.isMvp) return '<span style="color: var(--success);">‚úì MVP achieved</span>';
            
            const partnersNeeded = Math.max(0, 5 - (zone.partners || 0));
            const cuisinesNeeded = Math.max(0, 5 - (zone.cuisinesCount || 0));
            
            let actions = [];
            
            if (partnersNeeded > 0) {
                actions.push(`+${partnersNeeded} partner${partnersNeeded > 1 ? 's' : ''}`);
            }
            
            if (cuisinesNeeded > 0 && zone.missingEssentialCuisines) {
                try {
                    const missing = JSON.parse(zone.missingEssentialCuisines.replace(/'/g, '"'));
                    if (missing.length > 0) {
                        actions.push(`Add ${missing[0]}`);
                    }
                } catch {
                    actions.push(`+${cuisinesNeeded} cuisine${cuisinesNeeded > 1 ? 's' : ''}`);
                }
            }
            
            return actions.length > 0 ? actions.join(', ') : 'Review coverage';
        }
        
        // Evidence Tab
        function populateEvidence() {
            if (!DASHBOARD_DATA?.dishes) return;
            
            const topDishes = DASHBOARD_DATA.dishes.slice(0, 5);
            const evidenceHtml = topDishes.map((d, i) => `
                <div class="dish-evidence-card">
                    <div class="dish-evidence-header">
                        <span class="dish-evidence-title">${d.dishType}</span>
                        <span class="dish-evidence-rank">Rank #${i + 1} - ${d.strategicPriority}</span>
                    </div>
                    <div class="evidence-breakdown">
                        <div class="evidence-row">
                            <span class="evidence-source">Avg Sales/Dish (Orders)</span>
                            <span class="evidence-value">${d.performance?.avgSalesPerDish || '-'}</span>
                        </div>
                        <div class="evidence-row">
                            <span class="evidence-source">Rating (n=10,713)</span>
                            <span class="evidence-value">${d.performance?.deliverooRating?.toFixed(1) || '-'} ‚≠ê</span>
                        </div>
                        <div class="evidence-row">
                            <span class="evidence-source">Meal Satisfaction (Survey)</span>
                            <span class="evidence-value">${d.performance?.mealSatisfaction || '-'}</span>
                        </div>
                        <div class="evidence-row">
                            <span class="evidence-source">Repeat Intent (Survey)</span>
                            <span class="evidence-value">${d.performance?.repeatIntent || '-'}</span>
                        </div>
                        <div class="evidence-row">
                            <span class="evidence-source">Open-Text Requests</span>
                            <span class="evidence-value">${d.opportunity?.openTextRequests || 0} mentions</span>
                        </div>
                        <div class="evidence-row">
                            <span class="evidence-source">Demand Strength</span>
                            <span class="evidence-value">${d.context?.demandStrength?.toFixed(1) || '-'}</span>
                        </div>
                    </div>
                </div>
            `).join('');
            
            document.getElementById('dish-evidence-breakdown').innerHTML = evidenceHtml;
        }
        
        // Operational Tab
        function populateOperational() {
            if (!DASHBOARD_DATA?.behavioral) return;
            
            const behavioral = DASHBOARD_DATA.behavioral;
            
            // Top partners
            const partners = behavioral.orders?.topPartners || [];
            const partnerBody = document.querySelector('#partner-table tbody');
            partnerBody.innerHTML = partners.slice(0, 10).map(p => `
                <tr>
                    <td>${p.partner}</td>
                    <td>${p.orders?.toLocaleString() || '-'}</td>
                </tr>
            `).join('');
            
            // Rating distribution chart
            createRatingChart(behavioral.ratings?.ratingDistribution || {});
            
            // Zone volume chart
            createZoneVolumeChart(behavioral.orders?.topZones || []);
        }
        
        function createRatingChart(distribution) {
            const ctx = document.getElementById('rating-dist-chart').getContext('2d');
            const labels = Object.keys(distribution).sort();
            const data = labels.map(l => distribution[l]);
            
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels.map(l => l + ' stars'),
                    datasets: [{
                        label: 'Ratings',
                        data: data,
                        backgroundColor: labels.map(l => {
                            const v = parseInt(l);
                            if (v >= 4) return 'rgba(34, 197, 94, 0.6)';
                            if (v >= 3) return 'rgba(245, 158, 11, 0.6)';
                            return 'rgba(239, 68, 68, 0.6)';
                        }),
                        borderRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: {
                            grid: { color: 'rgba(255,255,255,0.05)' },
                            ticks: { color: '#94a3b8' }
                        },
                        x: {
                            grid: { display: false },
                            ticks: { color: '#94a3b8' }
                        }
                    }
                }
            });
        }
        
        function createZoneVolumeChart(zones) {
            const ctx = document.getElementById('zone-volume-chart').getContext('2d');
            
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: zones.slice(0, 10).map(z => z.zone),
                    datasets: [{
                        label: 'Orders',
                        data: zones.slice(0, 10).map(z => z.orders),
                        backgroundColor: 'rgba(0, 212, 170, 0.6)',
                        borderRadius: 4
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        x: {
                            grid: { color: 'rgba(255,255,255,0.05)' },
                            ticks: { color: '#94a3b8' }
                        },
                        y: {
                            grid: { display: false },
                            ticks: { color: '#94a3b8' }
                        }
                    }
                }
            });
        }
        
        // Search functionality
        function setupSearch() {
            const searchInput = document.getElementById('zone-search');
            if (searchInput) {
                searchInput.addEventListener('input', (e) => {
                    filterZones();
                });
            }
        }
        
        // Filters
        function setupFilters() {
            // Dish filters
            ['filter-cuisine', 'filter-status', 'filter-priority'].forEach(id => {
                document.getElementById(id)?.addEventListener('change', filterDishes);
            });
            
            // Zone filters
            ['filter-zone-region', 'filter-mvp', 'filter-zone-priority'].forEach(id => {
                document.getElementById(id)?.addEventListener('change', filterZones);
            });
        }
        
        function filterDishes() {
            const cuisine = document.getElementById('filter-cuisine').value;
            const status = document.getElementById('filter-status').value;
            const priority = document.getElementById('filter-priority').value;
            
            let filtered = DASHBOARD_DATA.dishes || [];
            if (cuisine) filtered = filtered.filter(d => d.cuisine === cuisine);
            if (status) filtered = filtered.filter(d => String(d.onDinneroo) === status);
            if (priority) filtered = filtered.filter(d => d.strategicPriority === priority);
            
            renderDishTable(filtered);
        }
        
        function filterZones() {
            const search = document.getElementById('zone-search')?.value?.toLowerCase() || '';
            const region = document.getElementById('filter-zone-region').value;
            const mvp = document.getElementById('filter-mvp').value;
            const priority = document.getElementById('filter-zone-priority').value;
            
            let filtered = DASHBOARD_DATA.zones || [];
            
            // Text search
            if (search) {
                filtered = filtered.filter(z => 
                    z.zone?.toLowerCase().includes(search) ||
                    z.region?.toLowerCase().includes(search)
                );
            }
            
            if (region) filtered = filtered.filter(z => z.region === region);
            if (mvp) filtered = filtered.filter(z => String(z.isMvp) === mvp);
            if (priority) filtered = filtered.filter(z => z.recruitmentPriority === priority);
            
            renderZoneTable(filtered);
        }
        
        // Export
        function exportData() {
            if (!DASHBOARD_DATA) return;
            
            const activeTab = document.querySelector('.nav-tab.active').dataset.tab;
            let data, filename;
            
            switch(activeTab) {
                case 'dishes':
                    data = DASHBOARD_DATA.dishes;
                    filename = 'dishes_export.csv';
                    break;
                case 'zones':
                    data = DASHBOARD_DATA.zones;
                    filename = 'zones_export.csv';
                    break;
                case 'gaps':
                    data = DASHBOARD_DATA.cuisineGaps;
                    filename = 'cuisine_gaps_export.csv';
                    break;
                default:
                    data = DASHBOARD_DATA.dishes;
                    filename = 'dashboard_export.csv';
            }
            
            if (!data || !data.length) return;
            
            const headers = Object.keys(flattenObject(data[0]));
            const rows = data.map(row => headers.map(h => {
                const val = getNestedValue(row, h);
                return typeof val === 'string' && val.includes(',') ? `"${val}"` : val;
            }));
            
            const csv = [headers.join(','), ...rows.map(r => r.join(','))].join('\n');
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            URL.revokeObjectURL(url);
        }
        
        function flattenObject(obj, prefix = '') {
            return Object.keys(obj).reduce((acc, k) => {
                const pre = prefix.length ? prefix + '.' : '';
                if (typeof obj[k] === 'object' && obj[k] !== null && !Array.isArray(obj[k])) {
                    Object.assign(acc, flattenObject(obj[k], pre + k));
                } else {
                    acc[pre + k] = obj[k];
                }
                return acc;
            }, {});
        }
        
        function getNestedValue(obj, path) {
            return path.split('.').reduce((o, k) => o?.[k], obj) ?? '';
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', loadData);
    </script>
</body>
</html>
